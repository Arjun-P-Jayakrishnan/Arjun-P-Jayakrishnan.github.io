{"version":3,"sources":["../src/index.ts"],"names":["references","managers","flags","preMount","getGlobalContext","createWebComponentManager","createGameManager","assetMetaData","err","loadAssets","response","mount","unmount","main"],"mappings":"s3BAaA,IAAIA,CAAAA,CACAC,EACAC,CAAQ,CAAA,CACV,aAAc,KACd,CAAA,SAAA,CAAW,KACb,CAKMC,CAAAA,CAAAA,CAAW,IAAM,CACrB,GAAI,CAIFH,CAAaI,CAAAA,CAAAA,GAIbH,CAAW,CAAA,CACT,aAAcI,GAA0B,EAAA,CACxC,WAAYC,CAAkB,CAAA,CAC5B,cAAe,CACb,cAAA,CAAgBC,IAAc,MAC9B,CAAA,WAAA,CAAaA,IAAc,GAC7B,CACF,CAAC,CACH,CAAA,CAEAN,EAAS,YAAa,CAAA,eAAA,GAEtBC,CAAM,CAAA,YAAA,CAAe,CACvB,EAAA,CAAA,MAASM,CAAK,CAAA,CACZ,QAAQ,KAAM,CAAA,CAAA,+BAAA,EAAkCA,CAAG,CAAE,CAAA,EACvD,CACF,CAEMC,CAAAA,CAAAA,CAAa,SAAY,CAC7B,GAAI,EAIgB,MAAM,OAAA,CAAQ,WAAW,CAACR,CAAAA,CAAS,WAAW,IAAK,EAAC,CAAC,CAAA,EAE7D,OAASS,CAAAA,CAAAA,EAAa,CAC1BA,CAAS,CAAA,MAAA,EAAU,YACrB,OAAQ,CAAA,KAAA,CACN,+CAA+CA,CAAS,CAAA,MAAM,EAChE,EAEJ,CAAC,EAMDT,CAAS,CAAA,UAAA,CAAW,SACtB,CAAA,MAASO,EAAK,CACZ,OAAA,CAAQ,KAAM,CAAA,CAAA,oCAAA,EAAuCA,CAAG,CAAA,CAAE,EAC5D,CACF,CAAA,CAKMG,EAAQ,SAAY,CACxB,GAAI,CACF,GAAI,CAACV,CAAU,CAAA,MAAM,IAAI,KAAM,CAAA,2BAA2B,EAI1DA,CAAS,CAAA,YAAA,CAAa,kBACtBA,CAAAA,CAAAA,CAAS,UAAW,CAAA,KAAA,EAEpB,CAAA,MAAMQ,GAENP,CAAAA,CAAAA,CAAM,UAAY,CACpB,EAAA,CAAA,MAASM,EAAK,CACZ,OAAA,CAAQ,MAAM,CAAmCA,gCAAAA,EAAAA,CAAG,EAAE,EACxD,CACF,EAKMI,CAAU,CAAA,IAAM,CACpB,GAAI,CACF,GAAI,CAACV,CAAM,CAAA,SAAA,CAAW,OACtBD,CAAS,CAAA,YAAA,CAAa,mBACtBA,CAAAA,CAAAA,CAAS,WAAW,OAAQ,GAC9B,OAASO,CAAK,CAAA,CACZ,QAAQ,KAAM,CAAA,CAAA,kCAAA,EAAqCA,CAAG,CAAE,CAAA,EAC1D,CACF,CAKMK,CAAAA,CAAAA,CAAO,IAAM,CACjBV,CAAS,EAAA,CAKT,SAAS,gBAAiB,CAAA,kBAAA,CAAoB,IAAM,CAC9CD,CAAAA,CAAM,cACRS,CAAM,EAAA,CAKR,OAAO,gBAAiB,CAAA,cAAA,CAAgB,IAAM,CACxCT,CAAAA,CAAM,WACRU,CAAQ,GAEZ,CAAC,EACH,CAAC,EACH,CAAA,CAOEC,CAAK,EAAA","file":"index.js","sourcesContent":["import {\n  createWebComponentManager,\n  WebComponentManager,\n} from \"@components/main\";\nimport { getGlobalContext, References } from \"@utils/globalContext\";\nimport { assetMetaData } from \"config/assetMetaData\";\nimport { createGameManager, GameEngineManager } from \"graphics/main\";\n\ninterface Managers {\n  webComponent: WebComponentManager;\n  gameEngine: GameEngineManager;\n}\n\nlet references: References;\nlet managers: Managers;\nlet flags = {\n  isPreMounted: false,\n  isMounted: false,\n};\n\n/**\n * Pre-mount setup: Initialize references and managers\n */\nconst preMount = () => {\n  try {\n    /**\n     * References for global access\n     */\n    references = getGlobalContext();\n    /**\n     * Managers for web components and game engine\n     */\n    managers = {\n      webComponent: createWebComponentManager(),\n      gameEngine: createGameManager({\n        loaderOptions: {\n          meshesMetaData: assetMetaData.meshes,\n          hdrMetaData: assetMetaData.hdr,\n        },\n      }),\n    };\n\n    managers.webComponent.mountComponents();\n\n    flags.isPreMounted = true;\n  } catch (err) {\n    console.error(`Error during pre-mount setup : ${err}`);\n  }\n};\n\nconst loadAssets = async () => {\n  try {\n    /**\n     * Loads all models , HDR  etc\n     */\n    const responses = await Promise.allSettled([managers.gameEngine.load()]);\n\n    responses.forEach((response) => {\n      if (response.status == \"rejected\") {\n        console.error(\n          `Failed to load models and mount game engine ${response.reason}`\n        );\n      }\n    });\n\n    /**\n     * @description update the game engine\n     * (uses self recursion method for rendering so only need to call once)\n     */\n    managers.gameEngine.update();\n  } catch (err) {\n    console.error(`Error while trying to load assets : ${err}`);\n  }\n};\n\n/**\n * helps to add all necessary mounting function\n */\nconst mount = async () => {\n  try {\n    if (!managers) throw new Error(`Error while pre-mounting.`);\n    /**\n     * Attach references to components and then mount tha game engine\n     */\n    managers.webComponent.attachReferences();\n    managers.gameEngine.mount();\n\n    await loadAssets();\n\n    flags.isMounted = true;\n  } catch (err) {\n    console.error(`Error while main mount due to : ${err}`);\n  }\n};\n\n/**\n * helps to clear any unmounted objects\n */\nconst unmount = () => {\n  try {\n    if (!flags.isMounted) return;\n    managers.webComponent.unmountComponents();\n    managers.gameEngine.unmount();\n  } catch (err) {\n    console.error(`Error while main unmount due to : ${err}`);\n  }\n};\n\n/**\n * entry point for the whole app\n */\nconst main = () => {\n  preMount();\n\n  /**\n   * Mounts the components when dom is fully loaded\n   */\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    if (flags.isPreMounted) {\n      mount();\n    }\n    /**\n     * Unmounts everything when the window is going to unload\n     */\n    window.addEventListener(\"beforeunload\", () => {\n      if (flags.isMounted) {\n        unmount();\n      }\n    });\n  });\n};\n\n/**\n * IIFE function\n * (Immediately Invoked Function Expression)\n */\n(() => {\n  main();\n})();\n"]}