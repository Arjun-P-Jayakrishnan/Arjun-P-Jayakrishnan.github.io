{"version":3,"sources":["../src/index.ts"],"names":["references","managers","flags","preMount","getGlobalContext","createWebComponentManager","createGameManager","assetMetaData","err","loadAssets","response","mount","unmount","main"],"mappings":"s3BAaA,IAAIA,CAAAA,CACAC,EACAC,CAAQ,CAAA,CACV,aAAc,KACd,CAAA,SAAA,CAAW,KACb,CAAA,CAKMC,CAAW,CAAA,IAAM,CACrB,GAAI,CAIFH,CAAaI,CAAAA,CAAAA,EAIbH,CAAAA,CAAAA,CAAW,CACT,YAAcI,CAAAA,GAAAA,EACd,CAAA,UAAA,CAAYC,CAAkB,CAAA,CAC5B,cAAe,CACb,cAAA,CAAgBC,IAAc,MAC9B,CAAA,WAAA,CAAaA,IAAc,GAC7B,CACF,CAAC,CACH,CAEAN,CAAAA,CAAAA,CAAS,aAAa,eAAgB,EAAA,CACtCA,CAAS,CAAA,UAAA,CAAW,KAAM,EAAA,CAE1BC,EAAM,YAAe,CAAA,CAAA,EACvB,CAASM,MAAAA,CAAAA,CAAK,CACZ,OAAA,CAAQ,MAAM,CAAkCA,+BAAAA,EAAAA,CAAG,EAAE,EACvD,CACF,EAEMC,CAAa,CAAA,SAAY,CAC7B,GAAI,CAIgB,CAAA,MAAM,QAAQ,UAAW,CAAA,CAACR,CAAS,CAAA,UAAA,CAAW,IAAK,EAAC,CAAC,CAE7D,EAAA,OAAA,CAASS,CAAa,EAAA,CAC1BA,CAAS,CAAA,MAAA,EAAU,YACrB,OAAQ,CAAA,KAAA,CACN,+CAA+CA,CAAS,CAAA,MAAM,EAChE,EAEJ,CAAC,CAMDT,CAAAA,CAAAA,CAAS,UAAW,CAAA,MAAA,GACtB,CAASO,MAAAA,CAAAA,CAAK,CACZ,OAAA,CAAQ,KAAM,CAAA,CAAA,oCAAA,EAAuCA,CAAG,CAAE,CAAA,EAC5D,CACF,CAAA,CAKMG,CAAQ,CAAA,IAAM,CAClB,GAAI,CACF,GAAI,CAACV,CAAAA,CAAU,MAAM,IAAI,KAAA,CAAM,2BAA2B,CAAA,CAI1DA,CAAS,CAAA,YAAA,CAAa,kBAElB,CAAA,qBAAA,GAAyB,MAC3B,CAAA,MAAA,CAAO,mBAAoB,CAAA,SAAY,CACrC,MAAMQ,CAAAA,GACR,CAAC,CAED,CAAA,UAAA,CAAW,SAAY,CACrB,MAAMA,IACR,CAAA,CAAG,GAAG,CAGRP,CAAAA,CAAAA,CAAM,SAAY,CAAA,CAAA,EACpB,CAASM,MAAAA,CAAAA,CAAK,CACZ,OAAQ,CAAA,KAAA,CAAM,CAAmCA,gCAAAA,EAAAA,CAAG,CAAE,CAAA,EACxD,CACF,CAKMI,CAAAA,CAAAA,CAAU,IAAM,CACpB,GAAI,CACF,GAAI,CAACV,CAAAA,CAAM,UAAW,OACtBD,CAAAA,CAAS,aAAa,iBAAkB,EAAA,CACxCA,CAAS,CAAA,UAAA,CAAW,OAAQ,GAC9B,OAASO,CAAK,CAAA,CACZ,OAAQ,CAAA,KAAA,CAAM,CAAqCA,kCAAAA,EAAAA,CAAG,EAAE,EAC1D,CACF,CAKMK,CAAAA,CAAAA,CAAO,IAAM,CACjBV,GAKA,CAAA,QAAA,CAAS,iBAAiB,kBAAoB,CAAA,IAAM,CAC9CD,CAAM,CAAA,YAAA,EACRS,CAAM,EAAA,CAKR,MAAO,CAAA,gBAAA,CAAiB,eAAgB,IAAM,CACxCT,CAAM,CAAA,SAAA,EACRU,CAAQ,GAEZ,CAAC,EACH,CAAC,EACH,CAAA,CAOEC,CAAK,EAAA","file":"index.js","sourcesContent":["import {\n  createWebComponentManager,\n  WebComponentManager,\n} from \"@components/main\";\nimport { getGlobalContext, References } from \"@utils/globalContext\";\nimport { assetMetaData } from \"config/assetMetaData\";\nimport { createGameManager, GameEngineManager } from \"graphics/main\";\n\ninterface Managers {\n  webComponent: WebComponentManager;\n  gameEngine: GameEngineManager;\n}\n\nlet references: References;\nlet managers: Managers;\nlet flags = {\n  isPreMounted: false,\n  isMounted: false,\n};\n\n/**\n * Pre-mount setup: Initialize references and managers\n */\nconst preMount = () => {\n  try {\n    /**\n     * References for global access\n     */\n    references = getGlobalContext();\n    /**\n     * Managers for web components and game engine\n     */\n    managers = {\n      webComponent: createWebComponentManager(),\n      gameEngine: createGameManager({\n        loaderOptions: {\n          meshesMetaData: assetMetaData.meshes,\n          hdrMetaData: assetMetaData.hdr,\n        },\n      }),\n    };\n\n    managers.webComponent.mountComponents();\n    managers.gameEngine.mount();\n\n    flags.isPreMounted = true;\n  } catch (err) {\n    console.error(`Error during pre-mount setup : ${err}`);\n  }\n};\n\nconst loadAssets = async () => {\n  try {\n    /**\n     * Loads all models , HDR  etc\n     */\n    const responses = await Promise.allSettled([managers.gameEngine.load()]);\n\n    responses.forEach((response) => {\n      if (response.status == \"rejected\") {\n        console.error(\n          `Failed to load models and mount game engine ${response.reason}`\n        );\n      }\n    });\n\n    /**\n     * @description update the game engine\n     * (uses self recursion method for rendering so only need to call once)\n     */\n    managers.gameEngine.update();\n  } catch (err) {\n    console.error(`Error while trying to load assets : ${err}`);\n  }\n};\n\n/**\n * helps to add all necessary mounting function\n */\nconst mount = () => {\n  try {\n    if (!managers) throw new Error(`Error while pre-mounting.`);\n    /**\n     * Attach references to components and then mount tha game engine\n     */\n    managers.webComponent.attachReferences();\n\n    if (\"requestIdleCallback\" in window) {\n      window.requestIdleCallback(async () => {\n        await loadAssets();\n      });\n    } else {\n      setTimeout(async () => {\n        await loadAssets();\n      }, 200);\n    }\n\n    flags.isMounted = true;\n  } catch (err) {\n    console.error(`Error while main mount due to : ${err}`);\n  }\n};\n\n/**\n * helps to clear any unmounted objects\n */\nconst unmount = () => {\n  try {\n    if (!flags.isMounted) return;\n    managers.webComponent.unmountComponents();\n    managers.gameEngine.unmount();\n  } catch (err) {\n    console.error(`Error while main unmount due to : ${err}`);\n  }\n};\n\n/**\n * entry point for the whole app\n */\nconst main = () => {\n  preMount();\n\n  /**\n   * Mounts the components when dom is fully loaded\n   */\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    if (flags.isPreMounted) {\n      mount();\n    }\n    /**\n     * Unmounts everything when the window is going to unload\n     */\n    window.addEventListener(\"beforeunload\", () => {\n      if (flags.isMounted) {\n        unmount();\n      }\n    });\n  });\n};\n\n/**\n * IIFE function\n * (Immediately Invoked Function Expression)\n */\n(() => {\n  main();\n})();\n"]}