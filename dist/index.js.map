{"version":3,"sources":["../src/index.ts"],"names":["references","managers","flags","preMount","getGlobalContext","createWebComponentManager","createGameManager","GAME_MANAGER_PROPS","err","loadAssets","response","mount","unmount","main"],"mappings":"k5BAaA,IAAIA,CAAAA,CACAC,EACAC,CAAQ,CAAA,CACV,aAAc,KACd,CAAA,SAAA,CAAW,KACb,CAKMC,CAAAA,CAAAA,CAAW,IAAM,CACrB,GAAI,CAIFH,CAAaI,CAAAA,CAAAA,GAIbH,CAAW,CAAA,CACT,YAAcI,CAAAA,GAAAA,EACd,CAAA,UAAA,CAAYC,EAAkBC,GAAkB,CAClD,EAEAN,CAAS,CAAA,YAAA,CAAa,iBACtBA,CAAAA,CAAAA,CAAS,UAAW,CAAA,KAAA,EAEpBC,CAAAA,CAAAA,CAAM,aAAe,CACvB,EAAA,CAAA,MAASM,EAAK,CACZ,OAAA,CAAQ,MAAM,CAAkCA,+BAAAA,EAAAA,CAAG,CAAE,CAAA,EACvD,CACF,CAAA,CAEMC,EAAa,SAAY,CAC7B,GAAI,CAIgB,CAAA,MAAM,QAAQ,UAAW,CAAA,CAACR,CAAS,CAAA,UAAA,CAAW,IAAK,EAAC,CAAC,CAE7D,EAAA,OAAA,CAASS,GAAa,CAC1BA,CAAAA,CAAS,QAAU,UACrB,EAAA,OAAA,CAAQ,KACN,CAAA,CAAA,4CAAA,EAA+CA,CAAS,CAAA,MAAM,EAChE,EAEJ,CAAC,EAMDT,CAAS,CAAA,UAAA,CAAW,SACtB,CAAA,MAASO,CAAK,CAAA,CACZ,OAAQ,CAAA,KAAA,CAAM,uCAAuCA,CAAG,CAAA,CAAE,EAC5D,CACF,CAAA,CAKMG,EAAQ,IAAM,CAClB,GAAI,CACF,GAAI,CAACV,EAAU,MAAM,IAAI,MAAM,2BAA2B,CAAA,CAI1DA,EAAS,YAAa,CAAA,gBAAA,GAElB,qBAAyB,GAAA,MAAA,CAC3B,OAAO,mBAAoB,CAAA,SAAY,CACrC,MAAMQ,CAAAA,GACR,CAAC,CAAA,CAED,UAAW,CAAA,SAAY,CACrB,MAAMA,IACR,CAAA,CAAG,GAAG,CAGRP,CAAAA,CAAAA,CAAM,UAAY,CACpB,EAAA,CAAA,MAASM,CAAK,CAAA,CACZ,OAAQ,CAAA,KAAA,CAAM,mCAAmCA,CAAG,CAAA,CAAE,EACxD,CACF,CAAA,CAKMI,EAAU,IAAM,CACpB,GAAI,CACF,GAAI,CAACV,EAAM,SAAW,CAAA,OACtBD,EAAS,YAAa,CAAA,iBAAA,GACtBA,CAAS,CAAA,UAAA,CAAW,OAAQ,GAC9B,CAASO,MAAAA,CAAAA,CAAK,CACZ,OAAQ,CAAA,KAAA,CAAM,qCAAqCA,CAAG,CAAA,CAAE,EAC1D,CACF,CAAA,CAKMK,CAAO,CAAA,IAAM,CACjBV,CAAAA,GAKA,QAAS,CAAA,gBAAA,CAAiB,mBAAoB,IAAM,CAC9CD,EAAM,YACRS,EAAAA,CAAAA,EAKF,CAAA,MAAA,CAAO,gBAAiB,CAAA,cAAA,CAAgB,IAAM,CACxCT,CAAAA,CAAM,WACRU,CAAQ,GAEZ,CAAC,EACH,CAAC,EACH,CAAA,CAOEC,CAAK,EAAA","file":"index.js","sourcesContent":["import {\n  createWebComponentManager,\n  WebComponentManager,\n} from \"@components/main\";\nimport { getGlobalContext, References } from \"@utils/globalContext\";\nimport { GAME_MANAGER_PROPS } from \"config/assets\";\nimport { createGameManager, GameEngineManager } from \"graphics/main\";\n\ninterface Managers {\n  webComponent: WebComponentManager;\n  gameEngine: GameEngineManager;\n}\n\nlet references: References;\nlet managers: Managers;\nlet flags = {\n  isPreMounted: false,\n  isMounted: false,\n};\n\n/**\n * Pre-mount setup: Initialize references and managers\n */\nconst preMount = () => {\n  try {\n    /**\n     * References for global access\n     */\n    references = getGlobalContext();\n    /**\n     * Managers for web components and game engine\n     */\n    managers = {\n      webComponent: createWebComponentManager(),\n      gameEngine: createGameManager(GAME_MANAGER_PROPS),\n    };\n\n    managers.webComponent.mountComponents();\n    managers.gameEngine.mount();\n\n    flags.isPreMounted = true;\n  } catch (err) {\n    console.error(`Error during pre-mount setup : ${err}`);\n  }\n};\n\nconst loadAssets = async () => {\n  try {\n    /**\n     * Loads all models , HDR  etc\n     */\n    const responses = await Promise.allSettled([managers.gameEngine.load()]);\n\n    responses.forEach((response) => {\n      if (response.status == \"rejected\") {\n        console.error(\n          `Failed to load models and mount game engine ${response.reason}`\n        );\n      }\n    });\n\n    /**\n     * @description update the game engine\n     * (uses self recursion method for rendering so only need to call once)\n     */\n    managers.gameEngine.update();\n  } catch (err) {\n    console.error(`Error while trying to load assets : ${err}`);\n  }\n};\n\n/**\n * helps to add all necessary mounting function\n */\nconst mount = () => {\n  try {\n    if (!managers) throw new Error(`Error while pre-mounting.`);\n    /**\n     * Attach references to components and then mount tha game engine\n     */\n    managers.webComponent.attachReferences();\n\n    if (\"requestIdleCallback\" in window) {\n      window.requestIdleCallback(async () => {\n        await loadAssets();\n      });\n    } else {\n      setTimeout(async () => {\n        await loadAssets();\n      }, 200);\n    }\n\n    flags.isMounted = true;\n  } catch (err) {\n    console.error(`Error while main mount due to : ${err}`);\n  }\n};\n\n/**\n * helps to clear any unmounted objects\n */\nconst unmount = () => {\n  try {\n    if (!flags.isMounted) return;\n    managers.webComponent.unmountComponents();\n    managers.gameEngine.unmount();\n  } catch (err) {\n    console.error(`Error while main unmount due to : ${err}`);\n  }\n};\n\n/**\n * entry point for the whole app\n */\nconst main = () => {\n  preMount();\n\n  /**\n   * Mounts the components when dom is fully loaded\n   */\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    if (flags.isPreMounted) {\n      mount();\n    }\n    /**\n     * Unmounts everything when the window is going to unload\n     */\n    window.addEventListener(\"beforeunload\", () => {\n      if (flags.isMounted) {\n        unmount();\n      }\n    });\n  });\n};\n\n/**\n * IIFE function\n * (Immediately Invoked Function Expression)\n */\n(() => {\n  main();\n})();\n"]}