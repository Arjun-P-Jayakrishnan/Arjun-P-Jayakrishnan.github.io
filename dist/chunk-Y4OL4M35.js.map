{"version":3,"sources":["../src/gameplay/GameplayManager.ts"],"names":["createGameplayManager","serviceRegistry","getServiceRegistry","eventBusManager","clock","Clock","state","tempData","isMounted","roomController","createRoomController","bind","mount","e","updateDeltaTime","update"],"mappings":"6GAkBaA,CAAAA,CAAwB,IAAuB,CAC1D,IAAMC,GAAAA,CAAkBC,CAAAA,EAAmB,CAGrC,CAACC,CAA8B,CAAA,CAAI,CACvCF,IAAgB,GAAA,CAAI,iBAAiB,CAAA,CACrCA,GAAAA,CAAgB,IAAI,QAAQ,CAAA,CAC5BA,IAAgB,GAAA,CAAI,cAAc,CACpC,CAAA,CACMG,CAAAA,CAAe,IAAIC,KAAAA,CAGrBC,EAAe,CAAE,SAAA,CAAW,CAAE,CAAA,CAC9BC,CAAAA,CAAqB,CAAE,SAAA,CAAW,CAAE,CAAA,CACpCC,CAAAA,CAAqB,MAGrBC,CAAAA,CAAiCC,GAAAA,GAE/BC,CAAAA,CAAO,IAAM,CACjBR,CAAAA,CAAgB,UAAA,CAAW,EAAA,CACzB,YAAA,CACAM,EAAe,UAAA,CAAW,KAC5B,EACAN,CAAAA,CAAgB,UAAA,CAAW,GACzB,YAAA,CACAM,CAAAA,CAAe,UAAA,CAAW,OAC5B,EAEAN,CAAAA,CAAgB,UAAA,CAAW,GACzB,eAAA,CACAM,CAAAA,CAAe,WAAW,QAC5B,CAAA,CACAN,CAAAA,CAAgB,UAAA,CAAW,GACzB,eAAA,CACAM,CAAAA,CAAe,WAAW,OAC5B,CAAA,CAEAN,EAAgB,UAAA,CAAW,EAAA,CACzB,WAAA,CACAM,CAAAA,CAAe,WAAW,UAC5B,CAAA,CACAN,EAAgB,UAAA,CAAW,EAAA,CACzB,YACAM,CAAAA,CAAe,UAAA,CAAW,OAC5B,EACF,EAEMG,CAAAA,CAAQ,SAA2B,CACnCJ,CAAAA,GAEJ,MAAMC,EAAe,KAAA,EAAM,CAC3BE,CAAAA,EAAK,CACLH,EAAY,IAAA,CAEZ,MAAA,CAAO,iBAAiB,OAAA,CAAUK,CAAAA,EAAM,CACtC,OAAA,CAAQ,GAAA,CAAIA,CAAC,EACf,CAAC,CAAA,EACH,CAAA,CAEMC,EAAkB,IAAY,CAClCP,EAAS,SAAA,CAAYH,CAAAA,CAAM,QAAA,EAAS,CAEhC,CAAC,KAAA,CAAMG,CAAAA,CAAS,SAAS,CAAA,EAAKA,CAAAA,CAAS,YAAc,MAAA,GACvDD,CAAAA,CAAM,SAAA,CAAYC,CAAAA,CAAS,WAE/B,CAAA,CAEMQ,CAAAA,CAAS,IAAM,CACnBD,CAAAA,GAEAL,CAAAA,CAAe,MAAA,CAAOH,CAAAA,CAAM,SAAA,EAAa,CAAC,EAC5C,CAAA,CAWA,OAAO,CACL,QAASM,CAAAA,CACT,MAAA,CAAQG,EACR,SAAA,CAPc,IAAM,CAEtB,CAMA,CACF","file":"chunk-Y4OL4M35.js","sourcesContent":["import { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { Clock } from \"three\";\nimport { createRoomController, RoomController } from \"./RoomManager\";\n\nexport interface GameplayManager {\n  onMount: () => Promise<void>;\n  update: () => void;\n  onUnmount: () => void;\n}\n\ninterface State {\n  deltaTime: number;\n}\n\ninterface TempData {\n  deltaTime: number;\n}\n\nexport const createGameplayManager = (): GameplayManager => {\n  const serviceRegistry = getServiceRegistry();\n\n  //Global properties\n  const [eventBusManager, logger, input] = [\n    serviceRegistry.get(\"EventBusManager\"),\n    serviceRegistry.get(\"Logger\"),\n    serviceRegistry.get(\"InputManager\"),\n  ];\n  const clock: Clock = new Clock();\n\n  //Re usable state (no re-allocation)\n  let state: State = { deltaTime: 0 };\n  let tempData: TempData = { deltaTime: 0 };\n  let isMounted: boolean = false;\n\n  //Controllers\n  let roomController: RoomController = createRoomController();\n\n  const bind = () => {\n    eventBusManager.displayBus.on(\n      \"about:show\",\n      roomController.switchRoom[\"about\"]\n    );\n    eventBusManager.displayBus.on(\n      \"about:hide\",\n      roomController.switchRoom[\"default\"]\n    );\n\n    eventBusManager.displayBus.on(\n      \"projects:show\",\n      roomController.switchRoom[\"projects\"]\n    );\n    eventBusManager.displayBus.on(\n      \"projects:hide\",\n      roomController.switchRoom[\"default\"]\n    );\n\n    eventBusManager.displayBus.on(\n      \"home:show\",\n      roomController.switchRoom[\"navigation\"]\n    );\n    eventBusManager.displayBus.on(\n      \"home:hide\",\n      roomController.switchRoom[\"default\"]\n    );\n  };\n\n  const mount = async (): Promise<void> => {\n    if (isMounted) return;\n\n    await roomController.mount();\n    bind();\n    isMounted = true;\n\n    window.addEventListener(\"keyup\", (e) => {\n      console.log(e);\n    });\n  };\n\n  const updateDeltaTime = (): void => {\n    tempData.deltaTime = clock.getDelta();\n\n    if (!isNaN(tempData.deltaTime) && tempData.deltaTime !== undefined) {\n      state.deltaTime = tempData.deltaTime;\n    }\n  };\n\n  const update = () => {\n    updateDeltaTime();\n\n    roomController.update(state.deltaTime ?? 0);\n  };\n\n  const unbind = () => {\n    // eventBusManager.displayBus.off(\"about:show\", rooms.navigation.setActive);\n    // eventBusManager.displayBus.off(\"about:hide\", rooms.navigation.setDeactive);\n  };\n\n  const unmount = () => {\n    unbind();\n  };\n\n  return {\n    onMount: mount,\n    update: update,\n    onUnmount: unmount,\n  };\n};\n"]}