import{a as m}from"./chunk-AEEBPYE3.js";import{a as y}from"./chunk-NAQJJEVU.js";import{b as p}from"./chunk-P5V7ULDZ.js";import{AnimationMixer as A,Vector3 as l}from"three";var c={MOVEMENT_ACCELERATION:.05,MAX_VELOCITY:.05},D=s=>{let{eventBusManager:C,globalState:x,globalStorage:P}=p(),d=y(),r={direction:new l(0,0,-1),velocity:new l(0,0,0),rotationApplied:{pitch:0,yaw:0}},u={inputDirection:new l(0,0,0)},n=m(),o,a,b=()=>{try{let e=d.getProperty("scene").getObjectByName(s.ids.rootMesh);if(!e)throw new Error(`player doesn't exist for the id ${s.ids.rootMesh}`);o={playerRoot:e},a={mixer:new A(e)}}catch(e){console.error(`Player mesh cant be obtained :${e}`)}},f=(e,t)=>{r.rotationApplied=e,o.playerRoot.rotation.y+=r.rotationApplied.yaw},E=e=>{let{inputDirection:t}=u;t.set(0,0,0),n.getController("keyboard").isKeyPressed("w")&&(t.z+=1),n.getController("keyboard").isKeyPressed("s")&&(t.z-=1),n.getController("keyboard").isKeyPressed("a")&&(t.x+=1),n.getController("keyboard").isKeyPressed("d")&&(t.x-=1),t.length()>0&&t.normalize(),t.length()>0?(r.velocity.add(t.multiplyScalar(c.MOVEMENT_ACCELERATION*e)),r.velocity.clampLength(0,c.MAX_VELOCITY)):r.velocity.length()>0&&r.velocity.multiplyScalar(1-c.MOVEMENT_ACCELERATION*e),o.playerRoot.position.add(r.velocity)},h=(e,t,i)=>{f(t,i),E(e)},g=e=>{a.mixer.update(e)};return{create:b,update:(e,t,i)=>(a.mixer&&g(e),h(e,t,i),{position:o.playerRoot.position,rotation:o.playerRoot.rotation}),destroy:()=>{try{o.playerRoot.clear()}catch(e){console.error(`Error while destroy player ${e}`)}}}};export{D as a};
//# sourceMappingURL=chunk-QN6TAM35.js.map