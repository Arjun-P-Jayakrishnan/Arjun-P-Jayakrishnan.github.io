import {a as a$1}from'./chunk-AEEBPYE3.js';import {a}from'./chunk-NAQJJEVU.js';import {b}from'./chunk-P5V7ULDZ.js';import {Vector3,AnimationMixer}from'three';var c={MOVEMENT_ACCELERATION:.05,MAX_VELOCITY:.05},D=s=>{let{eventBusManager:C,globalState:x,globalStorage:P}=b(),d=a(),r={direction:new Vector3(0,0,-1),velocity:new Vector3(0,0,0),rotationApplied:{yaw:0}},u={inputDirection:new Vector3(0,0,0)},n=a$1(),o,a$2,b$1=()=>{try{let e=d.getProperty("scene").getObjectByName(s.ids.rootMesh);if(!e)throw new Error(`player doesn't exist for the id ${s.ids.rootMesh}`);o={playerRoot:e},a$2={mixer:new AnimationMixer(e)};}catch(e){console.error(`Player mesh cant be obtained :${e}`);}},f=(e,t)=>{r.rotationApplied=e,o.playerRoot.rotation.y+=r.rotationApplied.yaw;},E=e=>{let{inputDirection:t}=u;t.set(0,0,0),n.getController("keyboard").isKeyPressed("w")&&(t.z+=1),n.getController("keyboard").isKeyPressed("s")&&(t.z-=1),n.getController("keyboard").isKeyPressed("a")&&(t.x+=1),n.getController("keyboard").isKeyPressed("d")&&(t.x-=1),t.length()>0&&t.normalize(),t.length()>0?(r.velocity.add(t.multiplyScalar(c.MOVEMENT_ACCELERATION*e)),r.velocity.clampLength(0,c.MAX_VELOCITY)):r.velocity.length()>0&&r.velocity.multiplyScalar(1-c.MOVEMENT_ACCELERATION*e),o.playerRoot.position.add(r.velocity);},h=(e,t,i)=>{f(t),E(e);},g=e=>{a$2.mixer.update(e);};return {create:b$1,update:(e,t,i)=>(a$2.mixer&&g(e),h(e,t),{position:o.playerRoot.position,rotation:o.playerRoot.rotation}),destroy:()=>{try{o.playerRoot.clear();}catch(e){console.error(`Error while destroy player ${e}`);}}}};export{D as a};//# sourceMappingURL=chunk-QN6TAM35.js.map
//# sourceMappingURL=chunk-QN6TAM35.js.map