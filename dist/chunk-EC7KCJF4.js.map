{"version":3,"sources":["../src/gameplay/player/playerMovementController.ts"],"names":["MOVEMENT","createPlayerMovementController","object","keyboard","mouse","yaw","BASE_FORWARD","Vector3","BASE_RIGHT","forward","right","moveDir","currentTilt","initialize","initialForward","f","updateMouse","yawDelta","updateKeyboard","deltaTime","lateral","isRunning","speed","targetTilt","tilt","isMoving"],"mappings":"4BAkBA,IAAMA,EAAW,CACf,UAAA,CAAY,GAAA,CACZ,SAAA,CAAW,GACX,QAAA,CAAU,IAAA,CACV,UAAA,CAAY,GAAA,CACZ,WAAY,CACd,CAAA,CAEaC,CAAAA,CAAiC,CAAC,CAC7C,MAAA,CAAAC,CAAAA,CACA,QAAA,CAAAC,EACA,KAAA,CAAAC,CACF,CAAA,GAIgC,CAC9B,IAAIC,CAAAA,CAAM,CAAA,CAEJC,CAAAA,CAAe,IAAIC,QAAQ,CAAA,CAAG,CAAA,CAAG,EAAE,CAAA,CACnCC,CAAAA,CAAa,IAAID,OAAAA,CAAQ,CAAA,CAAG,EAAG,CAAC,CAAA,CAEhCE,CAAAA,CAAU,IAAIF,QACdG,CAAAA,CAAQ,IAAIH,OAAAA,CACZI,CAAAA,CAAU,IAAIJ,OAAAA,CAEhBK,CAAAA,CAAc,CAAA,CAEZC,CAAAA,CAAcC,CAAAA,EAA4B,CAC9C,IAAMC,CAAAA,CAAID,EAAe,KAAA,EAAM,CAAE,IAAA,CAAK,CAAC,EAAE,SAAA,EAAU,CACnDL,CAAAA,CAAQ,IAAA,CAAKM,CAAC,CAAA,CACdL,CAAAA,CAAM,YAAA,CAAaR,CAAAA,CAAO,EAAA,CAAIO,CAAO,CAAA,CAAE,SAAA,GACvCJ,CAAAA,CAAM,IAAA,CAAK,KAAA,CAAMI,CAAAA,CAAQ,EAAG,CAACA,CAAAA,CAAQ,CAAC,CAAA,CACtCP,EAAO,QAAA,CAAS,GAAA,CAAI,CAAA,CAAGG,CAAAA,CAAK,CAAC,EAC/B,CAAA,CAEMW,CAAAA,CAAc,IAAc,CAChC,GAAI,CAACZ,CAAAA,CAAO,OAAO,CAAA,CACnB,IAAMa,CAAAA,CAAWb,CAAAA,CAAM,aAAY,CAAE,GAAA,CACrC,OAAAC,CAAAA,EAAOY,CAAAA,CAEPf,CAAAA,CAAO,QAAA,CAAS,GAAA,CAAI,EAAGG,CAAAA,CAAK,CAAC,CAAA,CAE7BI,CAAAA,CAAQ,KAAKH,CAAY,CAAA,CAAE,cAAA,CAAe,IAAIC,QAAQ,CAAA,CAAG,CAAA,CAAG,CAAC,CAAA,CAAGF,CAAG,CAAA,CACnEK,CAAAA,CAAM,IAAA,CAAKF,CAAU,EAAE,cAAA,CAAe,IAAID,OAAAA,CAAQ,CAAA,CAAG,EAAG,CAAC,CAAA,CAAGF,CAAG,CAAA,CAExDY,CACT,CAAA,CAEMC,CAAAA,CACJC,CAAAA,EACwD,CACxDR,CAAAA,CAAQ,GAAA,CAAI,CAAA,CAAG,CAAA,CAAG,CAAC,CAAA,CACnB,IAAIS,CAAAA,CAAU,CAAA,CAEVjB,GAAU,YAAA,CAAa,GAAG,CAAA,EAAGQ,CAAAA,CAAQ,IAAIF,CAAO,CAAA,CAChDN,CAAAA,EAAU,YAAA,CAAa,GAAG,CAAA,EAAGQ,CAAAA,CAAQ,GAAA,CAAIF,CAAO,CAAA,CAChDN,CAAAA,EAAU,YAAA,CAAa,GAAG,IAC5BQ,CAAAA,CAAQ,GAAA,CAAID,CAAK,CAAA,CACjBU,EAAU,CAAA,CAAA,CAERjB,CAAAA,EAAU,YAAA,CAAa,GAAG,CAAA,GAC5BQ,CAAAA,CAAQ,GAAA,CAAID,CAAK,EACjBU,CAAAA,CAAU,EAAA,CAAA,CAGRT,CAAAA,CAAQ,QAAA,GAAa,CAAA,EAAGA,CAAAA,CAAQ,SAAA,EAAU,CAE9C,IAAMU,CAAAA,CAAYlB,CAAAA,EAAU,YAAA,CAAa,OAAO,GAAK,KAAA,CAC/CmB,CAAAA,CACJX,CAAAA,CAAQ,QAAA,GAAa,CAAA,CACjBU,CAAAA,CACErB,CAAAA,CAAS,SAAA,CACTA,EAAS,UAAA,CACX,CAAA,CAGFW,CAAAA,CAAQ,QAAA,GAAa,CAAA,EACvBT,CAAAA,CAAO,QAAA,CAAS,eAAA,CAAgBS,CAAAA,CAASW,CAAK,CAAA,CAIhD,IAAMC,EAAaH,CAAAA,CAAUpB,CAAAA,CAAS,UAAA,CAEtC,OAAAY,IACGW,CAAAA,CAAaX,CAAAA,EAAe,IAAA,CAAK,GAAA,CAAIO,EAAYnB,CAAAA,CAAS,UAAA,CAAY,CAAC,CAAA,CAC1EE,CAAAA,CAAO,QAAA,CAAS,CAAA,CAAIU,CAAAA,CAEb,CAAE,KAAA,CAAAU,CAAAA,CAAO,SAAA,CAAAD,CAAAA,CAAW,KAAMT,CAAY,CAC/C,CAAA,CAgBA,OAAO,CAAE,UAAA,CAAAC,CAAAA,CAAY,MAAA,CAdLM,CAAAA,EAAqC,CACnD,IAAMF,CAAAA,CAAWD,CAAAA,GACX,CAAE,KAAA,CAAAM,CAAAA,CAAO,SAAA,CAAAD,EAAW,IAAA,CAAAG,CAAK,CAAA,CAAIN,CAAAA,CAAeC,CAAS,CAAA,CACrDM,CAAAA,CAAWH,CAAAA,CAAQtB,CAAAA,CAAS,SAElC,OAAO,CACL,KAAA,CAAAsB,CAAAA,CACA,SAAAG,CAAAA,CACA,SAAA,CAAWJ,CAAAA,EAAaI,CAAAA,CACxB,SAAAR,CAAAA,CACA,IAAA,CAAAO,CACF,CACF,CAE4B,CAC9B","file":"chunk-EC7KCJF4.js","sourcesContent":["import { KeyboardInput } from \"plugins/input/keyboard\";\nimport { MouseInput } from \"plugins/input/mouse\";\nimport { Object3D, Vector3 } from \"three\";\nimport { Nullable } from \"types/generic.types\";\n\nexport interface MovementFrame {\n  speed: number;\n  isMoving: boolean;\n  isRunning: boolean;\n  yawDelta: number;\n  tilt: number; // current tilt applied\n}\n\nexport interface PlayerMovementController {\n  initialize: (forward: Vector3) => void;\n  update: (deltaTime: number) => MovementFrame;\n}\n\nconst MOVEMENT = {\n  WALK_SPEED: 0.05,\n  RUN_SPEED: 0.1,\n  DEADZONE: 0.001,\n  TILT_ANGLE: 0.25, // radians max tilt\n  TILT_SPEED: 8.0, // how fast tilt interpolates\n};\n\nexport const createPlayerMovementController = ({\n  object,\n  keyboard,\n  mouse,\n}: {\n  object: Object3D;\n  keyboard: Nullable<KeyboardInput>;\n  mouse: Nullable<MouseInput>;\n}): PlayerMovementController => {\n  let yaw = 0;\n\n  const BASE_FORWARD = new Vector3(0, 0, -1);\n  const BASE_RIGHT = new Vector3(1, 0, 0);\n\n  const forward = new Vector3();\n  const right = new Vector3();\n  const moveDir = new Vector3();\n\n  let currentTilt = 0;\n\n  const initialize = (initialForward: Vector3) => {\n    const f = initialForward.clone().setY(0).normalize();\n    forward.copy(f);\n    right.crossVectors(object.up, forward).normalize();\n    yaw = Math.atan2(forward.x, -forward.z);\n    object.rotation.set(0, yaw, 0);\n  };\n\n  const updateMouse = (): number => {\n    if (!mouse) return 0;\n    const yawDelta = mouse.getRotation().yaw;\n    yaw += yawDelta;\n\n    object.rotation.set(0, yaw, 0);\n\n    forward.copy(BASE_FORWARD).applyAxisAngle(new Vector3(0, 1, 0), yaw);\n    right.copy(BASE_RIGHT).applyAxisAngle(new Vector3(0, 1, 0), yaw);\n\n    return yawDelta;\n  };\n\n  const updateKeyboard = (\n    deltaTime: number\n  ): { speed: number; isRunning: boolean; tilt: number } => {\n    moveDir.set(0, 0, 0);\n    let lateral = 0;\n\n    if (keyboard?.isKeyPressed(\"w\")) moveDir.add(forward);\n    if (keyboard?.isKeyPressed(\"s\")) moveDir.sub(forward);\n    if (keyboard?.isKeyPressed(\"d\")) {\n      moveDir.add(right);\n      lateral = 1;\n    }\n    if (keyboard?.isKeyPressed(\"a\")) {\n      moveDir.sub(right);\n      lateral = -1;\n    }\n\n    if (moveDir.lengthSq() > 0) moveDir.normalize();\n\n    const isRunning = keyboard?.isKeyPressed(\"shift\") ?? false;\n    const speed =\n      moveDir.lengthSq() > 0\n        ? isRunning\n          ? MOVEMENT.RUN_SPEED\n          : MOVEMENT.WALK_SPEED\n        : 0;\n\n    // ----------------- Apply movement -----------------\n    if (moveDir.lengthSq() > 0) {\n      object.position.addScaledVector(moveDir, speed);\n    }\n\n    // ----------------- Apply tilt -----------------\n    const targetTilt = lateral * MOVEMENT.TILT_ANGLE; // tilt toward left/right\n    // smooth interpolation toward target (0 if no lateral input)\n    currentTilt +=\n      (targetTilt - currentTilt) * Math.min(deltaTime * MOVEMENT.TILT_SPEED, 1);\n    object.rotation.x = currentTilt;\n\n    return { speed, isRunning, tilt: currentTilt };\n  };\n\n  const update = (deltaTime: number): MovementFrame => {\n    const yawDelta = updateMouse();\n    const { speed, isRunning, tilt } = updateKeyboard(deltaTime);\n    const isMoving = speed > MOVEMENT.DEADZONE;\n\n    return {\n      speed,\n      isMoving,\n      isRunning: isRunning && isMoving,\n      yawDelta,\n      tilt,\n    };\n  };\n\n  return { initialize, update };\n};\n"]}