import {a as a$1}from'./chunk-RL44DP43.js';import {a}from'./chunk-IIRPHTAK.js';import {Vector3,Euler,AnimationMixer}from'three';var d={MOVEMENT_ACCELERATION:.05,MAX_VELOCITY:.05},V=({reference:u,storage:f,InputManager:s})=>{let l,o={direction:new Vector3(0,0,-1),velocity:new Vector3(0,0,0),rotationApplied:{pitch:0,yaw:0}},b={inputDirection:new Vector3(0,0,0)},r={player:null},C=()=>{try{let e=f.getStorage("model").retrieve(u.storageId);if(!e)throw new Error(`player doesn't exist for the id ${u.storageId}`);let a$2=e?.groups,i=e?.animations,n=new AnimationMixer(a$2),t=a({mixer:n,actions:{Idle:n.clipAction(i[0]),Walk:n.clipAction(i[3]),Run:n.clipAction(i[1])},crossFadeDuration:.3}),c=a$1({animationController:t,inputs:s});c.mount(),r={player:a$2},l={input:{mouse:s.getController("mouse"),keyboard:s.getController("keyboard")},animation:t,fsm:c};}catch(e){console.error(`Player mesh cant be obtained :${e}`);}},A=e=>{!e||!r.player||(o.rotationApplied=e.getRotation(),r.player.rotation.y+=o.rotationApplied.yaw);},M=(e,a)=>{if(!e||!r.player)return;let n=.001,{inputDirection:t}=b;if(t.set(0,0,0),e.isKeyPressed("w")&&(t.z-=1),e.isKeyPressed("s")&&(t.z+=1),e.isKeyPressed("a")&&(t.x-=1),e.isKeyPressed("d")&&(t.x+=1),t.length()>0)t.applyQuaternion(r.player.quaternion),t.normalize(),o.velocity.add(t.multiplyScalar(d.MOVEMENT_ACCELERATION*a)),o.velocity.clampLength(0,d.MAX_VELOCITY);else if(t.length()==0&&o.velocity.length()>0){let c=Math.exp(-5*a);o.velocity.multiplyScalar(c),o.velocity.lengthSq()<n*n&&o.velocity.set(0,0,0);}r.player.position.add(o.velocity);},g=e=>{A(l.input.mouse),M(l.input.keyboard,e);};return {mount:C,activate:()=>{},deactivate:()=>{},update:e=>(g(e),l.fsm.update(e),{position:r.player?.position??new Vector3(0,0,0),rotation:r.player?.rotation??new Euler(0,0,0,"XYZ"),rotationDelta:o.rotationApplied}),unmount:()=>{}}};export{V as a};//# sourceMappingURL=chunk-N2KZDBMS.js.map
//# sourceMappingURL=chunk-N2KZDBMS.js.map