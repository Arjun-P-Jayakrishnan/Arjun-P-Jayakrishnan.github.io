{"version":3,"sources":["../src/engine/managers/animation/AnimationUnit.ts"],"names":["createAnimationUnit","root","clips","crossfadeDuration","mixer","actions","currentAnimation","currentAction","play","animationName","blendDuration","nextAction","stop","deltaTime","mountedMixer","AnimationMixer","clip","action","speed","direction"],"mappings":"mCAyEO,IAAMA,CAAAA,CAAsB,CAA4B,CAC7D,IAAA,CAAAC,CAAAA,CACA,KAAA,CAAAC,EACA,iBAAA,CAAAC,CACF,CAAA,GAIwB,CAEtB,IAAIC,CAAAA,CAA+B,IAAA,CAG7BC,CAAAA,CAAU,IAAI,IAGhBC,CAAAA,CAAgC,IAAA,CAGhCC,CAAAA,CAA2C,IAAA,CAMzCC,EAAO,CAACC,CAAAA,CAAkBC,CAAAA,GAA2B,CAEzD,GADI,CAACN,CAAAA,EACDE,CAAAA,GAAqBG,CAAAA,CAAe,OAExC,IAAME,CAAAA,CAAaN,CAAAA,CAAQ,GAAA,CAAII,EAAc,WAAA,EAAkB,CAAA,CAC1DE,CAAAA,GAELA,EAAW,KAAA,EAAM,CAAE,IAAA,EAAK,CAEpBJ,GACFA,CAAAA,CAAc,WAAA,CACZI,CAAAA,CACAD,CAAAA,EAAiBP,EACjB,KACF,CAAA,CAGFI,CAAAA,CAAgBI,CAAAA,CAChBL,EAAmBG,CAAAA,EACrB,CAAA,CAGMG,CAAAA,CAAO,IAAM,CACjBL,CAAAA,EAAe,IAAA,EAAK,CACpBA,CAAAA,CAAgB,KAChBD,CAAAA,CAAmB,KACrB,EA8CA,OAAO,CACL,KAAAE,CAAAA,CACA,IAAA,CAAAI,CAAAA,CACA,mBAAA,CAAqB,IAAMN,CAAAA,CAC3B,MAAA,CA5CcO,CAAAA,EAAsB,CACpCT,GAAO,MAAA,CAAOS,CAAS,EACzB,CAAA,CA2CE,QArCeC,CAAAA,EAAkC,CACjDV,CAAAA,CAAQU,CAAAA,EAAgB,IAAIC,cAAAA,CAAed,CAAI,CAAA,CAG/CC,CAAAA,CAAM,QAASc,CAAAA,EAAS,CACtBX,CAAAA,CAAQ,GAAA,CAAIW,EAAK,IAAA,CAAK,WAAA,EAAY,CAAQZ,CAAAA,CAAO,WAAWY,CAAI,CAAC,EACnE,CAAC,EACH,CAAA,CA+BE,SAAA,CA5BgB,IAAM,CACtBJ,GAAK,CACLP,CAAAA,CAAQ,OAAA,CAASY,CAAAA,EAAWA,EAAO,IAAA,EAAM,CAAA,CACzCZ,CAAAA,CAAQ,OAAM,CACdD,CAAAA,CAAQ,KACV,CAAA,CAwBE,SAnBgBc,CAAAA,EAAkB,CAC9BX,CAAAA,EAAeA,CAAAA,CAAc,sBAAsBW,CAAK,EAC9D,CAAA,CAkBE,YAAA,CAboBC,GAAsB,CACrCZ,CAAAA,GACLA,CAAAA,CAAc,SAAA,CAAY,KAAK,GAAA,CAAIA,CAAAA,CAAc,SAAS,CAAA,CAAIY,CAAAA,EAChE,CAWA,CACF","file":"chunk-CNBMV74T.js","sourcesContent":["import {\n  AnimationAction,\n  AnimationClip,\n  AnimationMixer,\n  Object3D,\n} from \"three\";\nimport { Nullable } from \"types/generic.types\";\n\n/**\n * Interface for a generic animation unit controlling Three.js animations.\n *\n * @template T - String literal type representing animation names\n */\nexport interface AnimationUnit<T extends string = string> {\n  /**\n   * Play a specific animation by name.\n   * Crossfades from the current animation if any.\n   *\n   * @param animationName - Name of the animation to play\n   * @param blendDuration - Optional crossfade duration (seconds)\n   */\n  play(animationName: T, blendDuration?: number): void;\n\n  /** Stop the currently playing animation */\n  stop(): void;\n\n  /** Get the currently playing animation name */\n  getCurrentAnimation(): T | null;\n\n  /**\n   * Update the animation mixer with delta time.\n   * Should be called every frame.\n   *\n   * @param deltaTime - Time elapsed since last update (in seconds)\n   */\n  update(deltaTime: number): void;\n\n  /**\n   * Called when the unit is mounted or initialized.\n   * Initializes the AnimationMixer and all actions.\n   *\n   * @param mixer - Optional externally provided AnimationMixer\n   */\n  onMount(mixer?: AnimationMixer): void;\n\n  /** Called when the unit is unmounted, cleans up actions and mixer */\n  onUnmount(): void;\n\n  /**\n   * Set playback speed of the current animation.\n   *\n   * @param speed - Speed multiplier (1 = normal, 0.5 = half speed, etc.)\n   */\n  setSpeed(speed: number): void;\n\n  /**\n   * Set playback direction of the current animation.\n   *\n   * @param direction - 1 = forward, -1 = backward\n   */\n  setDirection(direction: 1 | -1): void;\n}\n\n/**\n * Factory function to create a reusable AnimationUnit.\n * Handles mixer, actions, crossfading, speed, and direction.\n *\n * @template T - String literal type representing animation names\n * @param root - Root Object3D to animate\n * @param clips - Array of AnimationClips available for this unit\n * @param crossfadeDuration - Default crossfade duration (seconds)\n * @returns A fully initialized AnimationUnit\n */\nexport const createAnimationUnit = <T extends string = string>({\n  root,\n  clips,\n  crossfadeDuration,\n}: {\n  root: Object3D;\n  clips: AnimationClip[];\n  crossfadeDuration: number;\n}): AnimationUnit<T> => {\n  /** Three.js animation mixer, initialized on mount */\n  let mixer: AnimationMixer | null = null;\n\n  /** Map of animation name -> action */\n  const actions = new Map<T, AnimationAction>();\n\n  /** Currently playing animation name */\n  let currentAnimation: Nullable<T> = null;\n\n  /** Currently active animation action */\n  let currentAction: Nullable<AnimationAction> = null;\n\n  /**\n   * Play an animation by name.\n   * Crossfades from the current action if present.\n   */\n  const play = (animationName: T, blendDuration?: number) => {\n    if (!mixer) return; // mixer not initialized yet\n    if (currentAnimation === animationName) return; // already playing\n\n    const nextAction = actions.get(animationName.toLowerCase() as T);\n    if (!nextAction) return;\n\n    nextAction.reset().play();\n\n    if (currentAction) {\n      currentAction.crossFadeTo(\n        nextAction,\n        blendDuration ?? crossfadeDuration,\n        false\n      );\n    }\n\n    currentAction = nextAction;\n    currentAnimation = animationName;\n  };\n\n  /** Stop the current animation */\n  const stop = () => {\n    currentAction?.stop();\n    currentAction = null;\n    currentAnimation = null;\n  };\n\n  /**\n   * Update mixer on each frame.\n   * Should be called in the animation loop.\n   */\n  const update = (deltaTime: number) => {\n    mixer?.update(deltaTime);\n  };\n\n  /**\n   * Mount the unit.\n   * Initializes the AnimationMixer and sets up all actions.\n   */\n  const onMount = (mountedMixer?: AnimationMixer) => {\n    mixer = mountedMixer ?? new AnimationMixer(root);\n\n    // Create actions for each clip\n    clips.forEach((clip) => {\n      actions.set(clip.name.toLowerCase() as T, mixer!.clipAction(clip));\n    });\n  };\n\n  /** Unmount the unit and clean up resources */\n  const onUnmount = () => {\n    stop();\n    actions.forEach((action) => action.stop());\n    actions.clear();\n    mixer = null;\n  };\n\n  /**\n   * Set playback speed for the current animation.\n   */\n  const setSpeed = (speed: number) => {\n    if (currentAction) currentAction.setEffectiveTimeScale(speed);\n  };\n\n  /**\n   * Set playback direction for the current animation.\n   */\n  const setDirection = (direction: 1 | -1) => {\n    if (!currentAction) return;\n    currentAction.timeScale = Math.abs(currentAction.timeScale) * direction;\n  };\n\n  return {\n    play,\n    stop,\n    getCurrentAnimation: () => currentAnimation,\n    update,\n    onMount,\n    onUnmount,\n    setSpeed,\n    setDirection,\n  };\n};\n"]}