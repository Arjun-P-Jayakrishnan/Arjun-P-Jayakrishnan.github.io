import {a}from'./chunk-5PDCNHTA.js';import {a as a$2}from'./chunk-MWU7DWMH.js';import {a as a$3}from'./chunk-MK2JNO5U.js';import {a as a$1}from'./chunk-BFK572KU.js';import {b}from'./chunk-ML4JF6YZ.js';import {Vector3,Euler,AnimationMixer}from'three';var f={MOVEMENT_ACCELERATION:.05,MAX_VELOCITY:.05},$=b$1=>{let {eventBusManager:x,globalState:N,globalStorage:g}=b();a();let i,o={direction:new Vector3(0,0,-1),velocity:new Vector3(0,0,0),rotationApplied:{pitch:0,yaw:0}},A={inputDirection:new Vector3(0,0,0)},r={player:null},M=()=>{try{let e=g.getStorage("player").retrieve("player");if(!e)throw new Error(`player doesn't exist for the id ${b$1.rootMeshId}`);let n=e?.groups,l=e?.animations,a=a$1(),t=new AnimationMixer(n),c=a$2({mixer:t,actions:{Idle:t.clipAction(l[0]),Walk:t.clipAction(l[3]),Run:t.clipAction(l[1])},crossFadeDuration:.3}),p=a$3({animationController:c});p.mount(),r={player:n},i={input:{mouse:a.getController("mouse"),keyboard:a.getController("keyboard")},animation:c,fsm:p};}catch(e){console.error(`Player mesh cant be obtained :${e}`);}},h=e=>{!e||!r.player||(o.rotationApplied=e.getRotation(),r.player.rotation.y+=o.rotationApplied.yaw);},E=(e,n)=>{if(!e||!r.player)return;let a=.001,{inputDirection:t}=A;if(t.set(0,0,0),e.isKeyPressed("w")&&(t.z-=1),e.isKeyPressed("s")&&(t.z+=1),e.isKeyPressed("a")&&(t.x-=1),e.isKeyPressed("d")&&(t.x+=1),t.length()>0)t.applyQuaternion(r.player.quaternion),t.normalize(),o.velocity.add(t.multiplyScalar(f.MOVEMENT_ACCELERATION*n)),o.velocity.clampLength(0,f.MAX_VELOCITY);else if(t.length()==0&&o.velocity.length()>0){let c=Math.exp(-5*n);o.velocity.multiplyScalar(c),o.velocity.lengthSq()<a*a&&o.velocity.set(0,0,0);}r.player.position.add(o.velocity);},v=e=>{h(i.input.mouse),E(i.input.keyboard,e);};return {mount:M,activate:()=>{},deactivate:()=>{},update:e=>(v(e),i.fsm.update(e),{position:r.player?.position??new Vector3(0,0,0),rotation:r.player?.rotation??new Euler(0,0,0,"XYZ"),rotationDelta:o.rotationApplied}),unmount:()=>{}}};export{$ as a};//# sourceMappingURL=chunk-ISUFU6NS.js.map
//# sourceMappingURL=chunk-ISUFU6NS.js.map