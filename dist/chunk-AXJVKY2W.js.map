{"version":3,"sources":["../src/graphics/loader/file_type_plugins/hdr_loader.ts"],"sourcesContent":["import { createEventBus } from \"@utils/event_management/eventBus\";\r\nimport type { LoadingEvents } from \"@utils/event_management/eventType\";\r\nimport { RGBELoader } from \"three/examples/jsm/loaders/RGBELoader.js\";\r\nimport type { AssetMetaData, LoaderPlugin } from \"../loaderPlugins\";\r\nimport { DataTexture, LoadingManager, PMREMGenerator, Scene, WebGLRenderer } from \"three\";\r\n\r\nexport interface HDRTextureLoaderProps {\r\n  asset: AssetMetaData;\r\n  scene: Scene;\r\n  renderer: WebGLRenderer;\r\n  loadingManager: LoadingManager;\r\n  loadingEventBus: ReturnType<typeof createEventBus<LoadingEvents>>;\r\n}\r\n\r\n/**\r\n * @description loads .hdr files and illuminates scene\r\n * @param props hdr loading properties\r\n * @returns HDR loader plugin\r\n */\r\nexport const createHDRLoader = (props: HDRTextureLoaderProps): LoaderPlugin => {\r\n  const { asset, scene, renderer, loadingManager, loadingEventBus } = props;\r\n\r\n  const pmremGenerator: PMREMGenerator = new PMREMGenerator(renderer);\r\n  const rgbeLoader: RGBELoader = new RGBELoader(loadingManager);\r\n\r\n  /**\r\n   * @description loads a hdr file\r\n   * @param metaData meta-data for loading hdr\r\n   */\r\n  const _loadHDRTexture = async (metaData: AssetMetaData): Promise<void> => {\r\n    return new Promise((reject, resolve) => {\r\n      rgbeLoader.load(\r\n        metaData.path,\r\n        (data: DataTexture, texData: object) => {\r\n          const envMap = pmremGenerator.fromEquirectangular(data).texture;\r\n          data.dispose();\r\n          scene.environment = envMap;\r\n          metaData.onSuccess?.();\r\n          resolve();\r\n        },\r\n        undefined,\r\n        (err) => {\r\n          metaData.onError?.(err as Error);\r\n          loadingEventBus.emit({ type: \"load:error\", url: metaData.path });\r\n          reject();\r\n        }\r\n      );\r\n    });\r\n  };\r\n\r\n  const load = async () => {\r\n    await _loadHDRTexture(asset);\r\n  };\r\n\r\n  const dispose = () => {\r\n    pmremGenerator.dispose();\r\n  };\r\n\r\n  return {\r\n    load: load,\r\n    dispose: dispose,\r\n  };\r\n};\r\n"],"mappings":";AAEA,SAAS,kBAAkB;AAE3B,SAAsC,sBAA4C;AAe3E,IAAM,kBAAkB,CAAC,UAA+C;AAC7E,QAAM,EAAE,OAAO,OAAO,UAAU,gBAAgB,gBAAgB,IAAI;AAEpE,QAAM,iBAAiC,IAAI,eAAe,QAAQ;AAClE,QAAM,aAAyB,IAAI,WAAW,cAAc;AAM5D,QAAM,kBAAkB,OAAO,aAA2C;AACxE,WAAO,IAAI,QAAQ,CAAC,QAAQ,YAAY;AACtC,iBAAW;AAAA,QACT,SAAS;AAAA,QACT,CAAC,MAAmB,YAAoB;AACtC,gBAAM,SAAS,eAAe,oBAAoB,IAAI,EAAE;AACxD,eAAK,QAAQ;AACb,gBAAM,cAAc;AACpB,mBAAS,YAAY;AACrB,kBAAQ;AAAA,QACV;AAAA,QACA;AAAA,QACA,CAAC,QAAQ;AACP,mBAAS,UAAU,GAAY;AAC/B,0BAAgB,KAAK,EAAE,MAAM,cAAc,KAAK,SAAS,KAAK,CAAC;AAC/D,iBAAO;AAAA,QACT;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH;AAEA,QAAM,OAAO,YAAY;AACvB,UAAM,gBAAgB,KAAK;AAAA,EAC7B;AAEA,QAAM,UAAU,MAAM;AACpB,mBAAe,QAAQ;AAAA,EACzB;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,EACF;AACF;","names":[]}