import{a as p}from"./chunk-AEEBPYE3.js";import{b as s}from"./chunk-P5V7ULDZ.js";import{AnimationMixer as E,Vector3 as a}from"three";var l={MOVEMENT_ACCELERATION:.05,MAX_VELOCITY:.05},V=(c,y)=>{let{scene:d}=y,{eventBusManager:C,globalState:P,globalStorage:g}=s(),r={direction:new a(0,0,-1),velocity:new a(0,0,0),rotationApplied:{pitch:0,yaw:0}},m={inputDirection:new a(0,0,0)},n=p(),o,i,u=()=>{try{let e=d.getObjectByName(c.ids.rootMesh);if(!e)throw new Error(`player doesn't exist for the id ${c.ids.rootMesh}`);o={playerRoot:e},i={mixer:new E(e)}}catch(e){console.error(`Player mesh cant be obtained :${e}`)}},b=e=>{r.rotationApplied=e,o.playerRoot.rotation.y+=r.rotationApplied.yaw},f=e=>{let{inputDirection:t}=m;t.set(0,0,0),n.getController("keyboard").isKeyPressed("w")&&(t.z+=1),n.getController("keyboard").isKeyPressed("s")&&(t.z-=1),n.getController("keyboard").isKeyPressed("a")&&(t.x+=1),n.getController("keyboard").isKeyPressed("d")&&(t.x-=1),t.length()>0&&t.normalize(),t.length()>0?(r.velocity.add(t.multiplyScalar(l.MOVEMENT_ACCELERATION*e)),r.velocity.clampLength(0,l.MAX_VELOCITY)):r.velocity.length()>0&&r.velocity.multiplyScalar(1-l.MOVEMENT_ACCELERATION*e),o.playerRoot.position.add(r.velocity)},h=(e,t)=>{b(t),f(e)},A=e=>{i.mixer.update(e)};return{create:u,update:(e,t)=>(i.mixer&&A(e),h(e,t),{position:o.playerRoot.position,rotation:o.playerRoot.rotation}),destroy:()=>{try{o.playerRoot.clear()}catch(e){console.error(`Error while destroy player ${e}`)}}}};export{V as a};
//# sourceMappingURL=chunk-2HIMYHYT.js.map