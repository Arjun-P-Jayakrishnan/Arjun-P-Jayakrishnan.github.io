import {a as a$1}from'./chunk-AEEBPYE3.js';import {a}from'./chunk-NAQJJEVU.js';import {b}from'./chunk-P5V7ULDZ.js';import {Vector3,AnimationMixer}from'three';var m={MOVEMENT_ACCELERATION:.05,MAX_VELOCITY:.05},I=y=>{let{eventBusManager:M,globalState:P,globalStorage:w}=b(),d=a(),o={direction:new Vector3(0,0,-1),velocity:new Vector3(0,0,0),rotationApplied:{yaw:0}},b$1={inputDirection:new Vector3(0,0,0)},n={mouse:null,keyboard:null},r,l,f=()=>{try{let e=d.getProperty("scene").getObjectByName(y.ids.rootMesh);if(!e)throw new Error(`player doesn't exist for the id ${y.ids.rootMesh}`);r={playerRoot:e},l={mixer:new AnimationMixer(e)},n={mouse:a$1().getController("mouse"),keyboard:a$1().getController("keyboard")};}catch(e){console.error(`Player mesh cant be obtained :${e}`);}},h=(e,a)=>{o.rotationApplied=e,r.playerRoot.rotation.y+=o.rotationApplied.yaw;},E=e=>{if(!n.keyboard)return;let i=.001,{inputDirection:t}=b$1;if(t.set(0,0,0),n.keyboard.isKeyPressed("w")&&(t.z-=1),n.keyboard.isKeyPressed("s")&&(t.z+=1),n.keyboard.isKeyPressed("a")&&(t.x-=1),n.keyboard.isKeyPressed("d")&&(t.x+=1),t.length()>0)t.applyQuaternion(r.playerRoot.quaternion),t.normalize(),o.velocity.add(t.multiplyScalar(m.MOVEMENT_ACCELERATION*e)),o.velocity.clampLength(0,m.MAX_VELOCITY);else if(t.length()==0&&o.velocity.length()>0){let x=Math.exp(-5*e);o.velocity.multiplyScalar(x),o.velocity.lengthSq()<i*i&&o.velocity.set(0,0,0);}r.playerRoot.position.add(o.velocity);},C=(e,a,i)=>{h(a),E(e);},g=e=>{l.mixer.update(e);};return {create:f,update:(e,a,i)=>(l.mixer&&g(e),C(e,a),{position:r.playerRoot.position,rotation:r.playerRoot.rotation}),destroy:()=>{try{r.playerRoot.clear();}catch(e){console.error(`Error while destroy player ${e}`);}}}};export{I as a};//# sourceMappingURL=chunk-UW2YBRFK.js.map
//# sourceMappingURL=chunk-UW2YBRFK.js.map