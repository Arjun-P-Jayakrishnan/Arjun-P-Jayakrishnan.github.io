{"version":3,"sources":["../src/gameplay/rooms/projects/room.ts"],"names":["createProjectRoom","player","ground","serviceRegistry","getServiceRegistry","storage","context","eventBusManager","logger","scene","camera","orbit","renderer","components","createCameraManager","createPlayer","createGround","createLighting","group","deltaTime"],"mappings":"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","file":"chunk-AXBI24QS.js","sourcesContent":["import { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { Group, Object3DEventMap } from \"three\";\nimport { ModelIdentifier, Room, RoomProps } from \"types/rooms.types\";\nimport { CameraManager, createCameraManager } from \"./camera\";\nimport { createGround, Ground } from \"./ground\";\nimport { createLighting, Lighting } from \"./lights\";\nimport { createPlayer, Player } from \"./player\";\n\nexport interface ProjectRoomProps extends RoomProps {\n  player: ModelIdentifier;\n  ground: ModelIdentifier;\n}\n\ninterface Components {\n  camera: CameraManager;\n  player: Player;\n  ground: Ground;\n  lighting: Lighting;\n}\n\nexport const createProjectRoom = ({\n  player,\n  ground,\n}: ProjectRoomProps): Room => {\n  //====References===\n  const serviceRegistry = getServiceRegistry();\n  const [storage, context, eventBusManager, logger] = [\n    serviceRegistry.get(\"GlobalStorageManager\"),\n    serviceRegistry.get(\"ThreeJSContextManager\"),\n    serviceRegistry.get(\"EventBusManager\"),\n    serviceRegistry.get(\"Logger\"),\n  ];\n\n  const { scene, camera, orbit, renderer } = {\n    scene: context.get(\"scene\")!,\n    camera: context.get(\"camera\")!,\n    orbit: context.get(\"orbit\")!,\n    renderer: context.get(\"renderer\")!,\n  };\n\n  //===Local===\n  const components: Components = {\n    camera: createCameraManager({\n      camera,\n      eventBusManager,\n      orbit,\n      scene,\n    }),\n    player: createPlayer({ logger, reference: player, storage }),\n    ground: createGround({ logger, reference: ground, storage }),\n    lighting: createLighting({ renderer, scene }),\n  };\n  let group: Nullable<Group<Object3DEventMap>> = null;\n\n  const mount = () => {\n    components.ground.mount();\n    components.player.mount();\n    components.camera.mount();\n    components.lighting.mount();\n\n    group =\n      storage.getStorage(\"model\").retrieve(ground.storageId)?.groups ?? null;\n\n    logger.onMount({ origin: \"Projects-Room\" });\n  };\n\n  const activate = () => {\n    if (group) group.visible = true;\n\n    components.camera.activate();\n    components.ground.actiavte();\n    components.lighting.activate();\n    components.player.activate();\n\n    logger.onActivate({ origin: \"Projects-Room\" });\n  };\n\n  const update = (deltaTime: number) => {\n    components.player.update(deltaTime);\n    components.camera.update(deltaTime);\n  };\n\n  const deactivate = () => {\n    if (group) group.visible = false;\n\n    components.camera.deactivate();\n    components.ground.deactivate();\n    components.lighting.deactivate();\n    components.player.deactiavte();\n\n    logger.onDeactivate({ origin: \"Projects-Room\" });\n  };\n\n  const unmount = () => {\n    components.camera.unmount();\n    components.ground.unmount();\n    components.lighting.unmount();\n    components.player.unmount();\n\n    logger.onUnmount({ origin: \"Projects-Room\" });\n  };\n\n  return {\n    mount: mount,\n    setActive: activate,\n    update: update,\n    setDeactive: deactivate,\n    unmount: unmount,\n    isLoaded: false,\n  };\n};\n"]}