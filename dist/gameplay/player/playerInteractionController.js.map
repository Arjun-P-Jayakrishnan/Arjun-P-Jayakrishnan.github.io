{"version":3,"sources":["../../../src/gameplay/player/playerInteractionController.ts"],"names":["createPlayerInteractionController","playerObject","keyboard","forwardVector","raycaster","Raycaster","interactiveObjects","_deltaTime","nearbyObjects","obj","intersects","o","targetObj","index"],"mappings":"8BA2CO,IAAMA,EAAoC,CAAC,CAChD,YAAA,CAAAC,CAAAA,CACA,QAAA,CAAAC,CAAAA,CACA,aAAA,CAAAC,CACF,IASmC,CACjC,IAAMC,CAAAA,CAAY,IAAIC,SAAAA,CAChBC,CAAAA,CAA0C,EAAC,CAwDjD,OAAO,CACL,MAAA,CAvDcC,CAAAA,EAAuB,CACrC,GAAI,CAACN,CAAAA,CAAc,OAGnB,IAAMO,CAAAA,CAAgBF,CAAAA,CAAmB,MAAA,CAAQG,CAAAA,EAE7CR,CAAAA,CAAa,QAAA,CAAS,UAAA,CAAWQ,CAAAA,CAAI,OAAO,QAAQ,CAAA,EAAKA,CAAAA,CAAI,MAEhE,CAAA,CAED,GAAID,CAAAA,CAAc,MAAA,GAAW,EAAG,OAGhCJ,CAAAA,CAAU,GAAA,CAAIH,CAAAA,CAAa,QAAA,CAAUE,CAAAA,CAAc,KAAA,EAAM,CAAE,WAAW,CAAA,CAEtE,IAAMO,CAAAA,CAAaN,EAAU,gBAAA,CAC3BI,CAAAA,CAAc,GAAA,CAAKG,CAAAA,EAAMA,EAAE,MAAM,CAAA,CACjC,IACF,CAAA,CAEA,GAAID,CAAAA,CAAW,MAAA,CAAS,CAAA,CAAG,CACzB,IAAME,CAAAA,CAAYJ,CAAAA,CAAc,IAAA,CAC7BC,CAAAA,EAAQA,CAAAA,CAAI,MAAA,GAAWC,CAAAA,CAAW,CAAC,CAAA,CAAE,MACxC,CAAA,CAEIE,CAAAA,GAEF,OAAA,CAAQ,GAAA,CAAI,gCAAA,CAAkCA,CAAAA,CAAU,OAAO,IAAI,CAAA,CAG/DV,CAAAA,EAAU,YAAA,CAAa,GAAG,CAAA,EAC5BU,CAAAA,CAAU,UAAA,EAAW,EAG3B,CACF,CAAA,CAqBE,yBAAA,CAnBiCH,CAAAA,EAA2B,CACvDH,CAAAA,CAAmB,QAAA,CAASG,CAAG,CAAA,EAClCH,EAAmB,IAAA,CAAKG,CAAG,EAE/B,CAAA,CAgBE,uBAAA,CAd+BA,CAAAA,EAA2B,CAC1D,IAAMI,EAAQP,CAAAA,CAAmB,OAAA,CAAQG,CAAG,CAAA,CACxCI,CAAAA,GAAU,EAAA,EACZP,CAAAA,CAAmB,MAAA,CAAOO,EAAO,CAAC,EAEtC,CAAA,CAUE,uBAAA,CAR8B,IAAM,CACpCP,CAAAA,CAAmB,MAAA,CAAS,EAC9B,CAOA,CACF","file":"playerInteractionController.js","sourcesContent":["import { KeyboardInput } from \"plugins/input/keyboard\";\nimport { Object3D, Raycaster, Vector3 } from \"three\";\nimport { Nullable } from \"types/generic.types\";\n\n/* -------------------------------------------------------------------------- */\n/*                             Interaction Types                               */\n/* -------------------------------------------------------------------------- */\n\nexport interface InteractiveObject {\n  object: Object3D;\n  radius: number; // proximity radius\n  onInteract: () => void;\n}\n\nexport interface PlayerInteractionController {\n  /**\n   * Call each frame to update interaction logic\n   * @param deltaTime Time elapsed since last frame\n   */\n  update: (deltaTime: number) => void;\n\n  /** Registers an interactive object */\n  registerInteractiveObject: (obj: InteractiveObject) => void;\n\n  /** Removes a specific interactive object */\n  removeInteractiveObject: (obj: InteractiveObject) => void;\n\n  /** Clears all interactive objects */\n  clearInteractiveObjects: () => void;\n}\n\n/* -------------------------------------------------------------------------- */\n/*                               Constants                                      */\n/* -------------------------------------------------------------------------- */\n\nconst INTERACTION = {\n  MAX_DISTANCE: 3.0, // max distance to detect objects\n};\n\n/* -------------------------------------------------------------------------- */\n/*                       Factory: Interaction Controller                       */\n/* -------------------------------------------------------------------------- */\n\nexport const createPlayerInteractionController = ({\n  playerObject,\n  keyboard,\n  forwardVector,\n}: {\n  /** Root object of the player */\n  playerObject: Object3D;\n\n  /** Keyboard controller to detect interaction input */\n  keyboard: Nullable<KeyboardInput>;\n\n  /** Current forward direction of player (unit vector) */\n  forwardVector: Vector3;\n}): PlayerInteractionController => {\n  const raycaster = new Raycaster();\n  const interactiveObjects: InteractiveObject[] = [];\n\n  const update = (_deltaTime: number) => {\n    if (!playerObject) return;\n\n    // 1️⃣ Filter objects by distance (proximity)\n    const nearbyObjects = interactiveObjects.filter((obj) => {\n      return (\n        playerObject.position.distanceTo(obj.object.position) <= obj.radius\n      );\n    });\n\n    if (nearbyObjects.length === 0) return;\n\n    // 2️⃣ Raycast from player forward to detect what the player is looking at\n    raycaster.set(playerObject.position, forwardVector.clone().normalize());\n\n    const intersects = raycaster.intersectObjects(\n      nearbyObjects.map((o) => o.object),\n      true\n    );\n\n    if (intersects.length > 0) {\n      const targetObj = nearbyObjects.find(\n        (obj) => obj.object === intersects[0].object\n      );\n\n      if (targetObj) {\n        // Highlight or show \"Press E\" prompt here\n        console.log(\"Looking at interactive object:\", targetObj.object.name);\n\n        // Interaction input\n        if (keyboard?.isKeyPressed(\"e\")) {\n          targetObj.onInteract();\n        }\n      }\n    }\n  };\n\n  const registerInteractiveObject = (obj: InteractiveObject) => {\n    if (!interactiveObjects.includes(obj)) {\n      interactiveObjects.push(obj);\n    }\n  };\n\n  const removeInteractiveObject = (obj: InteractiveObject) => {\n    const index = interactiveObjects.indexOf(obj);\n    if (index !== -1) {\n      interactiveObjects.splice(index, 1);\n    }\n  };\n\n  const clearInteractiveObjects = () => {\n    interactiveObjects.length = 0;\n  };\n\n  return {\n    update,\n    registerInteractiveObject,\n    removeInteractiveObject,\n    clearInteractiveObjects,\n  };\n};\n"]}