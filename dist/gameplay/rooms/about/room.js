import {Vector3,AnimationMixer,DirectionalLight,AmbientLight,PCFShadowMap}from'three';var M=()=>{let n=new Map;return {register:(t,i)=>{if(n.has(t))throw new Error(`Error : Redefining the service [${t}]`);n.set(t,i);},get:t=>{let i=n.get(t);if(!i)throw new Error(`Error : Trying to obtain value of an unregistered service ${t}`);return i},has:t=>n.has(t)}},u,p=()=>(u||(u=M()),u);var v=n=>{let{camera:a}=n,r=new Vector3(0,1,2);return {mount:()=>{},activate:()=>{a.position.set(r.x,1,r.z),a.rotation.set(0,0,0,"XYZ");},deactivate:()=>{},unmount:()=>{}}};var f=({logger:n,reference:a,storage:e})=>{let r=null;return {mount:()=>{if(r=e.getStorage("model").retrieve(a.storageId)?.groups.getObjectByName(a.id),!r){console.error(`Cant get ground mesh from the id : ${a.id}`);return}r.material=r.material.clone(),r.receiveShadow=true,r.material.needsUpdate=true,r.material.opacity=.15,r.material.transparent=true,n.onMount({origin:"about-ground"});},actiavte:()=>{},deactivate:()=>{},unmount:()=>{}}};var h=({renderer:n,scene:a})=>{let e,r;return {mount:()=>{e=new DirectionalLight(16777215,5),e.castShadow=true,e.position.set(0,2,0),e.target.position.set(0,1,0),e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.camera.near=.1,e.shadow.camera.far=50,e.shadow.camera.left=-10,e.shadow.camera.right=10,e.shadow.camera.top=10,e.shadow.camera.bottom=-10,r=new AmbientLight(16777215),n.shadowMap.enabled=true,n.shadowMap.type=PCFShadowMap;},activate:()=>{e&&a.add(e),r&&a.add(r);},deactivate:()=>{e&&a.remove(e),r&&a.remove(r);},unmount:()=>{}}};var y=({logger:n,reference:a,scene:e,storage:r})=>{let t,i,s=c=>{c.traverse(l=>{l.castShadow=true;});};return {mount:()=>{try{n.onMount({origin:"about-room-player"});let c=e.getObjectByName(a.id);if(!c)throw new Error(`player doesn't exist for the id ${a.id}`);t={playerRoot:c},i={mixer:new AnimationMixer(c)};}catch(c){console.error(`Player mesh cant be obtained :${c}`);}},activate:()=>{t.playerRoot&&(t.playerRoot.rotation.set(0,-Math.PI/4,0,"XYZ"),t.playerRoot.castShadow=true,s(t.playerRoot),t.playerRoot.position.set(1.5,0,0));},deactiavte:()=>{},unmount:()=>{t.playerRoot&&t.playerRoot.position.set(1.5,0,0);}}};var te=({ground:n,player:a})=>{let e=p(),[r,t,i]=[e.get("GlobalStorageManager"),e.get("Logger"),e.get("ThreeJSContextManager")],{scene:s,camera:m,orbit:d,renderer:g}={scene:i.get("scene"),camera:i.get("camera"),orbit:i.get("orbit"),renderer:i.get("renderer")},o={camera:v({camera:m}),player:y({logger:t,reference:a,scene:s,storage:r}),ground:f({logger:t,reference:n,storage:r}),lighting:h({renderer:g,scene:s})},c=null;return {mount:()=>{t.onMount({origin:"about-room"}),o.ground.mount(),o.player.mount(),o.lighting.mount(),c=r.getStorage("model").retrieve(n.storageId)?.groups??null;},setActive:()=>{c&&(c.visible=true),d.enabled=false,o.camera.activate(),o.lighting.activate(),o.player.activate();},update:A=>{},setDeactive:()=>{c&&(c.visible=false),o.lighting.deactivate();},unmount:()=>{o.player.unmount();},isLoaded:false}};export{te as createAboutRoom};//# sourceMappingURL=room.js.map
//# sourceMappingURL=room.js.map