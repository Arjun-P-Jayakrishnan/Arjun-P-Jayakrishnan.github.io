{"version":3,"sources":["../../src/config/asset_manifest.ts","../../src/config/rooms.ts","../../src/plugins/loader/fbx_loader.ts","../../src/plugins/loader/glb_loader.ts","../../src/plugins/loader/hdr_loader.ts","../../src/engine/core/LoadingManager.ts","../../src/engine/core/ServiceRegistry.ts","../../src/gameplay/rooms/about/camera.ts","../../src/gameplay/rooms/about/ground.ts","../../src/gameplay/rooms/about/lights.ts","../../src/gameplay/rooms/about/player.ts","../../src/gameplay/rooms/about/room.ts","../../src/gameplay/rooms/navigation/camera.ts","../../src/materials/grid/grid-material.ts","../../src/materials/grid/grid-fragment.ts","../../src/materials/grid/grid-vertex.ts","../../src/gameplay/rooms/navigation/ground.ts","../../src/gameplay/modules/animation.ts","../../src/gameplay/modules/fsm/player.ts","../../src/gameplay/rooms/navigation/player.ts","../../src/gameplay/rooms/navigation/room.ts","../../src/gameplay/rooms/projects/camera.ts","../../src/gameplay/rooms/projects/ground.ts","../../src/gameplay/rooms/projects/lights.ts","../../src/gameplay/rooms/projects/player.ts","../../src/gameplay/rooms/projects/room.ts","../../src/gameplay/RoomManager.ts"],"names":["FILE_CONSTANTS","PLAYER_ASSET","NAVIGATION_ROOM_ASSETS","ABOUT_ROOM_ASSETS","PROJECTS_ROOM_ASSETS","NAVIGATION_ROOM_OPTIONS","ABOUT_ROOM_OPTIONS","PROJECTS_ROOM_OPTIONS","createFBXLoader","loadingManager","scene","storageManager","fbxLoader","FBXLoader","_loadMesh","metaData","model","err","assets","promises","asset","createGLBLoader","gltfLoader","GLTFLoader","dracoLoader","DRACOLoader","createHDRLoader","renderer","pmremGenerator","PMREMGenerator","rgbeLoader","RGBELoader","_loadHDRTexture","reject","resolve","data","texData","envMap","load","createLoader","loaderEventBus","stateManager","manager","LoadingManager","isConfigured","glbLoader","hdrLoader","assetQueue","_configureLoadingManager","url","itemsLoaded","itemsTotal","pushToRespectiveLoaderQueue","_configurePlugins","createServiceRegistry","services","name","service","serviceRegistry","getServiceRegistry","createCameraManager","props","camera","target","Vector3","createGround","logger","reference","storage","ground","createLighting","dirLight","ambientLight","DirectionalLight","AmbientLight","PCFShadowMap","createPlayer","objects","animations","castShadow","player","child","playerRoot","AnimationMixer","createAboutRoom","context","orbit","components","group","deltaTime","TPV_CONFIG","tempPosition","tempOffset","tempLookTarget","clampRotation","yaw","pitch","MathUtils","computeThirdPersonOffset","spherical","lerpVector","from","to","alpha","state","Spherical","setCamera","mode","mount","activate","updateRotation","delta","clamped","updateThirdPerson","info","updateFirstPerson","playerPos","GridFragment","GridVertex","createGridMaterial","mat","ShaderMaterial","cameraPos","references","gridMat","createAnimationController","mixer","actions","crossFadeDuration","currentAnimation","blendTime","currentAction","animationName","blendDuration","nextAction","Idle","Walk","Run","createFSMController","inputs","animationController","keyboard","idle","walk","run","currentState","update","playerFSM","isMoving","isShiftPressed","_getState","newState","changeState","PLAYER_CONSTANTS","InputManager","controllers","tempData","fsmController","updateMouse","mouse","updateKeyboard","VELOCITY_DEADZONE","inputDirection","decay","FRICTION","updateControllers","Euler","createNavigationRoom","eventBusManager","contextManager","room","isMounted","points","camPath","CatmullRomCurve3","t","isComplete","position","lookAt","groups","excludeShadow","mixers","createProjectRoom","createRoomController","loader","rooms","roomAssets","activeRoom","activeRoomKey","initializeLoader","instantiateRoom","key","loadRoom","loadItems","switchRoom","unmount","transitionRooms","deactivateRoom"],"mappings":"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","file":"RoomManager.js","sourcesContent":["import { ModelAssetDescriptor } from \"types/loader.types\";\nimport { RoomAsset } from \"types/rooms.types\";\n\nconst FILE_CONSTANTS = {\n  PATH_TO_MODELS: \"/assets/Models/\",\n  PATH_TO_HDR: \"/assets/HDR/\",\n  PATH_TO_ANIMATIONS: \"../../assets/Animations/\",\n};\n\nexport const PLAYER_ASSET: ModelAssetDescriptor = {\n  id: \"player\",\n  path: FILE_CONSTANTS.PATH_TO_MODELS + \"player.glb\",\n  type: \"glb\",\n};\n\nexport const NAVIGATION_ROOM_ASSETS: RoomAsset = {\n  meshes: [\n    {\n      id: \"navigation\",\n      path: FILE_CONSTANTS.PATH_TO_MODELS + \"room.glb\",\n      type: \"glb\",\n    },\n  ],\n  hdr: {\n    id: \"environment_hdr\",\n    path: FILE_CONSTANTS.PATH_TO_HDR + \"environment.hdr\",\n    type: \"hdr\",\n  },\n};\n\nexport const ABOUT_ROOM_ASSETS: RoomAsset = {\n  meshes: [\n    {\n      id: \"about\",\n      path: FILE_CONSTANTS.PATH_TO_MODELS + \"about.glb\",\n      type: \"glb\",\n    },\n  ],\n};\n\nexport const PROJECTS_ROOM_ASSETS: RoomAsset = {\n  meshes: [\n    {\n      id: \"projects\",\n      path: FILE_CONSTANTS.PATH_TO_MODELS + \"projects.glb\",\n      type: \"glb\",\n    },\n  ],\n};\n","import { AboutRoomProps } from \"gameplay/rooms/about/room\";\nimport { NavigationRoomProps } from \"gameplay/rooms/navigation/room\";\nimport { ProjectRoomProps } from \"gameplay/rooms/projects/room\";\n\nexport const NAVIGATION_ROOM_OPTIONS: NavigationRoomProps = {\n  player: {\n    id: \"RootNode\",\n    storageId: \"player\",\n  },\n  ground: {\n    id: \"ground\",\n    storageId: \"navigation\",\n  },\n};\n\nexport const ABOUT_ROOM_OPTIONS: AboutRoomProps = {\n  player: {\n    id: \"RootNode\",\n    storageId: \"player\",\n  },\n  ground: {\n    id: \"ground\",\n    storageId: \"about\",\n  },\n};\n\nexport const PROJECTS_ROOM_OPTIONS: ProjectRoomProps = {\n  player: {\n    id: \"RootNode\",\n    storageId: \"player\",\n  },\n  ground: {\n    id: \"ground\",\n    storageId: \"projects\",\n  },\n};\n","import { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport { Scene } from \"three\";\nimport { FBXLoader } from \"three/examples/jsm/loaders/FBXLoader.js\";\nimport type { LoadingManager } from \"three/src/loaders/LoadingManager.js\";\nimport { ModelAssetDescriptor } from \"types/loader.types\";\nimport { LoaderPlugin } from \"types/plugin.types\";\n\nexport interface FBXLoaderProps {\n  scene: Scene;\n  loadingManager: LoadingManager;\n  storageManager: GlobalStorageManager;\n}\n\nexport const createFBXLoader = ({\n  loadingManager,\n  scene,\n  storageManager,\n}: FBXLoaderProps): LoaderPlugin => {\n  const fbxLoader: FBXLoader = new FBXLoader(loadingManager);\n\n  /**\n   * @description load the mesh\n   * @param metaData meta-data for loading the mesh\n   */\n  const _loadMesh = async (metaData: ModelAssetDescriptor) => {\n    try {\n      const model = await fbxLoader.loadAsync(metaData.path);\n      storageManager.getStorage(\"model\").store(metaData.id, {\n        animations: model.animations,\n        groups: model,\n      });\n      scene.add(model);\n    } catch (err) {\n      throw new Error(`Error while loading fbx file : ${err}`);\n    }\n  };\n\n  const load = async (assets: ModelAssetDescriptor[]) => {\n    const promises: Promise<void>[] = [];\n    assets.forEach((asset) => {\n      promises.push(_loadMesh(asset));\n    });\n\n    await Promise.allSettled(promises);\n  };\n\n  return {\n    load: load,\n  };\n};\n","import { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport { LoadingManager, Scene } from \"three\";\nimport { DRACOLoader } from \"three/examples/jsm/loaders/DRACOLoader.js\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader.js\";\nimport { ModelAssetDescriptor } from \"types/loader.types\";\nimport { LoaderPlugin } from \"types/plugin.types\";\n\nexport interface GLBLoaderProps {\n  scene: Scene;\n  loadingManager: LoadingManager;\n  storageManager: GlobalStorageManager;\n}\n\nexport const createGLBLoader = ({\n  scene,\n  loadingManager,\n  storageManager,\n}: GLBLoaderProps): LoaderPlugin => {\n  const gltfLoader: GLTFLoader = new GLTFLoader(loadingManager);\n  const dracoLoader = new DRACOLoader();\n  dracoLoader.setDecoderPath(\"/public/draco/\");\n  gltfLoader.setDRACOLoader(dracoLoader);\n\n  /**\n   * @description load the mesh\n   * @param metaData meta-data for loading the mesh\n   */\n  const _loadMesh = async (metaData: ModelAssetDescriptor) => {\n    try {\n      const model = await gltfLoader.loadAsync(metaData.path);\n      storageManager.getStorage(\"model\").store(metaData.id, {\n        animations: model.animations,\n        groups: model.scene,\n      });\n      scene.add(model.scene);\n    } catch (err) {\n      throw new Error(`Errr occuerd while loading a glb file : ${err}`);\n    }\n  };\n\n  const load = async (assets: ModelAssetDescriptor[]) => {\n    const promises: Promise<void>[] = [];\n    assets.forEach((asset) => {\n      promises.push(_loadMesh(asset));\n    });\n\n    await Promise.allSettled(promises);\n  };\n\n  return {\n    load: load,\n  };\n};\n","import { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport {\n  DataTexture,\n  LoadingManager,\n  PMREMGenerator,\n  Scene,\n  WebGLRenderer,\n} from \"three\";\nimport { RGBELoader } from \"three/examples/jsm/loaders/RGBELoader.js\";\nimport { ModelAssetDescriptor } from \"types/loader.types\";\nimport { LoaderPlugin } from \"types/plugin.types\";\n\nexport interface HDRTextureLoaderProps {\n  scene: Scene;\n  renderer: WebGLRenderer;\n  loadingManager: LoadingManager;\n  storageManager: GlobalStorageManager;\n}\n\n/**\n * @description loads .hdr files and illuminates scene\n * @param props hdr loading properties\n * @returns HDR loader plugin\n */\nexport const createHDRLoader = ({\n  loadingManager,\n  renderer,\n  scene,\n}: HDRTextureLoaderProps): LoaderPlugin => {\n  const pmremGenerator: PMREMGenerator = new PMREMGenerator(renderer);\n  const rgbeLoader: RGBELoader = new RGBELoader(loadingManager);\n\n  /**\n   * @description loads a hdr file\n   * @param metaData meta-data for loading hdr\n   */\n  const _loadHDRTexture = async (\n    metaData: ModelAssetDescriptor\n  ): Promise<void> => {\n    return new Promise((reject, resolve) => {\n      console.log(\"path\", metaData.path);\n      rgbeLoader.load(\n        metaData.path,\n        (data: DataTexture, texData: object) => {\n          const envMap = pmremGenerator.fromEquirectangular(data).texture;\n          data.dispose();\n          scene.environment = envMap;\n          resolve();\n        },\n        undefined,\n        (err) => {\n          reject();\n        }\n      );\n    });\n  };\n\n  const load = async (assets: ModelAssetDescriptor[]) => {\n    const promises: Promise<void>[] = [];\n\n    assets.forEach(async (asset) => {\n      promises.push(_loadHDRTexture(asset));\n    });\n\n    await Promise.allSettled(promises);\n  };\n\n  const dispose = () => {\n    pmremGenerator.dispose();\n  };\n\n  return {\n    load: load,\n  };\n};\n","import { EventBus } from \"@events/eventBus\";\nimport { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport { LoadingManager, Scene, WebGLRenderer } from \"three\";\nimport { LoadingEvents } from \"types/eventType\";\nimport { LoadOptions, ModelAssetDescriptor } from \"types/loader.types\";\nimport { createFBXLoader } from \"../../plugins/loader/fbx_loader\";\nimport { createGLBLoader } from \"../../plugins/loader/glb_loader\";\nimport { createHDRLoader } from \"../../plugins/loader/hdr_loader\";\nimport { GlobalStateManager, LoadingContext } from \"./state/stateType\";\n\nexport interface LoaderProps {\n  scene: Scene;\n  renderer: WebGLRenderer;\n  loaderEventBus: EventBus<LoadingEvents>;\n  stateManager: GlobalStateManager;\n  storageManager: GlobalStorageManager;\n}\n\nexport interface Loader {\n  configure: () => void;\n  load: (assets: ModelAssetDescriptor[]) => Promise<{\n    success: string[];\n    error: string[];\n  }>;\n  dispose: () => void;\n}\n/**\n * @description creates a loader with the given settings\n * @param options options to change loader settings\n * @param context global context with references\n * @returns Loader\n */\nexport const createLoader = ({\n  scene,\n  renderer,\n  loaderEventBus,\n  stateManager,\n  storageManager,\n}: LoaderProps): Loader => {\n  const manager: LoadingManager = new LoadingManager();\n  let isConfigured: boolean = false;\n  const [glbLoader, fbxLoader, hdrLoader] = [\n    createGLBLoader({\n      scene,\n      loadingManager: manager,\n      storageManager,\n    }),\n    createFBXLoader({\n      scene,\n      loadingManager: manager,\n      storageManager,\n    }),\n    createHDRLoader({\n      scene,\n      loadingManager: manager,\n      renderer,\n      storageManager,\n    }),\n  ];\n  const assetQueue: {\n    glb: ModelAssetDescriptor[];\n    fbx: ModelAssetDescriptor[];\n    hdr: ModelAssetDescriptor[];\n  } = {\n    glb: [],\n    fbx: [],\n    hdr: [],\n  };\n\n  /**\n   * @description attaches the event bus for listening to loading changes\n   */\n  const _configureLoadingManager = () => {\n    manager.onStart = (url, itemsLoaded, itemsTotal) => {\n      loaderEventBus.emit({\n        type: \"load:start\",\n        url: url,\n        loaded: itemsLoaded,\n        total: itemsTotal,\n      });\n      stateManager.loading.setState({\n        loading: { active: true, progress: 0 } as LoadingContext,\n      });\n    };\n\n    manager.onProgress = (url, itemsLoaded, itemsTotal) => {\n      loaderEventBus.emit({\n        type: \"load:progress\",\n        url: url,\n        loaded: itemsLoaded,\n        total: itemsTotal,\n      });\n      stateManager.loading.setState({\n        loading: {\n          active: true,\n          progress: itemsLoaded / itemsTotal,\n        } as LoadingContext,\n      });\n    };\n\n    manager.onLoad = () => {\n      loaderEventBus.emit({\n        type: \"load:complete\",\n      });\n    };\n\n    manager.onError = (url) => {\n      loaderEventBus.emit({\n        type: \"load:error\",\n        url: url,\n      });\n    };\n\n    isConfigured = true;\n  };\n\n  const pushToRespectiveLoaderQueue = (model: ModelAssetDescriptor) => {\n    switch (model.type) {\n      case \"glb\":\n        assetQueue.glb.push(model);\n        break;\n      case \"fbx\":\n        assetQueue.fbx.push(model);\n        break;\n      case \"hdr\":\n        assetQueue.hdr.push(model);\n        break;\n      default:\n        break;\n    }\n  };\n\n  /**\n   * @description create necessary loaders\n   */\n  const _configurePlugins = (assets: ModelAssetDescriptor[]) => {\n    assets.forEach((asset) => {\n      pushToRespectiveLoaderQueue(asset);\n    });\n  };\n\n  /**\n   * @description configuration\n   */\n  const _configure = () => {\n    _configureLoadingManager();\n  };\n\n  /**\n   * @description load all types of assets\n   */\n  const load = async (\n    assets: LoadOptions\n  ): Promise<{ success: []; error: [] }> => {\n    if (!isConfigured)\n      throw new Error(\n        `Error: Trying to load from loader before configuring it`\n      );\n\n    const promises: Promise<void>[] = [];\n    _configurePlugins(assets);\n\n    promises.push(glbLoader.load(assetQueue.glb));\n    promises.push(fbxLoader.load(assetQueue.fbx));\n    promises.push(hdrLoader.load(assetQueue.hdr));\n\n    await Promise.allSettled(promises);\n    assetQueue.fbx = [];\n    assetQueue.glb = [];\n    assetQueue.hdr = [];\n\n    return {\n      success: [],\n      error: [],\n    };\n  };\n\n  const dispose = () => {};\n\n  return {\n    configure: _configure,\n    load: load,\n    dispose: dispose,\n  };\n};\n","import {\n  ServiceKey,\n  ServiceMap,\n  ServiceRegistry,\n  ServiceType,\n} from \"types/service.types\";\n\nconst createServiceRegistry = (): ServiceRegistry => {\n  const services: Map<ServiceKey, ServiceType> = new Map<\n    ServiceKey,\n    ServiceType\n  >();\n\n  const register = <K extends ServiceKey>(\n    name: K,\n    service: ServiceMap[K]\n  ): void => {\n    if (services.has(name)) {\n      throw new Error(`Error : Redefining the service [${name}]`);\n    }\n    services.set(name, service);\n  };\n\n  const get = <K extends ServiceKey>(name: K): ServiceMap[K] => {\n    const service = services.get(name);\n    if (!service) {\n      throw new Error(\n        `Error : Trying to obtain value of an unregistered service ${name}`\n      );\n    }\n    return service as ServiceMap[K];\n  };\n\n  const has = (name: ServiceKey): boolean => {\n    return services.has(name);\n  };\n\n  return {\n    register: register,\n    get: get,\n    has: has,\n  };\n};\n\nlet serviceRegistry: ServiceRegistry | undefined = undefined;\n\nconst getServiceRegistry = () => {\n  if (!serviceRegistry) {\n    serviceRegistry = createServiceRegistry();\n  }\n\n  return serviceRegistry;\n};\n\nexport { getServiceRegistry };\n","import { PerspectiveCamera, Scene, Vector3 } from \"three\";\n\nexport interface CameraProps {\n  camera: PerspectiveCamera;\n  scene: Scene;\n}\n\nexport interface CameraManager {\n  mount: () => void;\n  activate: () => void;\n  deactivate: () => void;\n  unmount: () => void;\n}\n\nexport const createCameraManager = (props: CameraProps): CameraManager => {\n  const { camera, scene } = props;\n  const target = new Vector3(0, 1, 2);\n  const mount = () => {};\n\n  const activate = () => {\n    camera.position.set(target.x, 1, target.z);\n    camera.rotation.set(0, 0, 0, \"XYZ\");\n  };\n\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    activate: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n","import { Logger } from \"@utils/Logger\";\nimport { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport { Material, Mesh, MeshStandardMaterial } from \"three\";\nimport { ModelIdentifier } from \"types/rooms.types\";\n\nexport interface GroundProps {\n  reference: ModelIdentifier;\n  storage: GlobalStorageManager;\n  logger: Logger;\n}\n\nexport interface Ground {\n  mount: () => void;\n  actiavte: () => void;\n  deactivate: () => void;\n  unmount: () => void;\n}\n\nexport const createGround = ({\n  logger,\n  reference,\n  storage,\n}: GroundProps): Ground => {\n  let ground: Nullable<Mesh> = null;\n\n  const mount = () => {\n    ground = storage\n      .getStorage(\"model\")\n      .retrieve(reference.storageId)\n      ?.groups.getObjectByName(reference.id) as Mesh;\n\n    if (!ground) {\n      console.error(`Cant get ground mesh from the id : ${reference.id}`);\n      return;\n    }\n    ground.material = (ground.material as Material).clone();\n    ground.receiveShadow = true;\n\n    (ground.material as Material).needsUpdate = true;\n    (ground.material as MeshStandardMaterial).opacity = 0.15;\n    (ground.material as MeshStandardMaterial).transparent = true;\n\n    logger.onMount({ origin: \"about-ground\" });\n  };\n\n  const activate = () => {};\n\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    actiavte: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n","import {\n  AmbientLight,\n  DirectionalLight,\n  PCFShadowMap,\n  Scene,\n  WebGLRenderer,\n} from \"three\";\n\nexport interface LightingProps {\n  scene: Scene;\n  renderer: WebGLRenderer;\n}\n\nexport interface Lighting {\n  mount: () => void;\n  activate: () => void;\n  deactivate: () => void;\n  unmount: () => void;\n}\n\nexport const createLighting = ({\n  renderer,\n  scene,\n}: LightingProps): Lighting => {\n  let dirLight: Nullable<DirectionalLight>;\n  let ambientLight: Nullable<AmbientLight>;\n\n  const mount = () => {\n    dirLight = new DirectionalLight(0xffffff, 5);\n    dirLight.castShadow = true;\n    dirLight.position.set(0, 2, 0);\n    dirLight.target.position.set(0, 1, 0);\n\n    dirLight.shadow.mapSize.width = 1024;\n    dirLight.shadow.mapSize.height = 1024;\n    dirLight.shadow.camera.near = 0.1;\n    dirLight.shadow.camera.far = 50;\n    dirLight.shadow.camera.left = -10;\n    dirLight.shadow.camera.right = 10;\n    dirLight.shadow.camera.top = 10;\n    dirLight.shadow.camera.bottom = -10;\n\n    ambientLight = new AmbientLight(0xffffff);\n\n    renderer.shadowMap.enabled = true;\n    renderer.shadowMap.type = PCFShadowMap;\n  };\n\n  const activate = () => {\n    if (dirLight) scene.add(dirLight);\n    if (ambientLight) scene.add(ambientLight);\n  };\n\n  const deactivate = () => {\n    if (dirLight) scene.remove(dirLight);\n    if (ambientLight) scene.remove(ambientLight);\n  };\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    activate: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n","import { Logger } from \"@utils/Logger\";\nimport { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport {\n  AnimationMixer,\n  Object3D,\n  Object3DEventMap,\n  Scene,\n  Vector3,\n} from \"three\";\nimport { ModelIdentifier } from \"types/rooms.types\";\n\nexport interface PlayerProps {\n  reference: ModelIdentifier;\n  logger: Logger;\n  storage: GlobalStorageManager;\n  scene: Scene;\n}\n\nexport interface PlayerContext {\n  scene: Scene;\n}\n\nexport interface Player {\n  mount: () => void;\n  activate: () => void;\n  deactiavte: () => void;\n  unmount: () => void;\n}\n\ninterface PlayerState {}\n\ninterface ObjectReferences {\n  playerRoot: Object3D;\n}\n\ninterface Animation {\n  mixer: AnimationMixer | null;\n}\n\nconst PLAYER_CONSTANTS = {\n  MOVEMENT_ACCELERATION: 0.05,\n  MAX_VELOCITY: 0.05,\n};\n\ninterface TempData {\n  inputDirection: Vector3;\n}\n\nexport const createPlayer = ({\n  logger,\n  reference,\n  scene,\n  storage,\n}: PlayerProps): Player => {\n  let objects: ObjectReferences;\n  let animations: Animation;\n\n  const castShadow = (player: Object3D<Object3DEventMap>) => {\n    player.traverse((child) => {\n      child.castShadow = true;\n    });\n  };\n\n  const mount = () => {\n    try {\n      logger.onMount({ origin: \"about-room-player\" });\n      let playerRoot = scene.getObjectByName(reference.id);\n\n      if (!playerRoot) {\n        throw new Error(`player doesn't exist for the id ${reference.id}`);\n      }\n\n      //Local References\n      objects = {\n        playerRoot: playerRoot,\n      };\n\n      animations = {\n        mixer: new AnimationMixer(playerRoot),\n      };\n    } catch (err) {\n      console.error(`Player mesh cant be obtained :${err}`);\n    }\n  };\n\n  const activate = () => {\n    if (objects.playerRoot) {\n      objects.playerRoot.rotation.set(0, -Math.PI / 4, 0, \"XYZ\");\n      objects.playerRoot.castShadow = true;\n      castShadow(objects.playerRoot);\n\n      objects.playerRoot.position.set(1.5, 0, 0);\n    }\n  };\n\n  const deactivate = () => {};\n\n  const unmount = () => {\n    if (objects.playerRoot) {\n      objects.playerRoot.position.set(1.5, 0, 0);\n    }\n  };\n\n  return {\n    mount: mount,\n    activate: activate,\n    deactiavte: deactivate,\n    unmount: unmount,\n  };\n};\n","import { Group, Object3DEventMap } from \"three\";\n\nimport { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { ModelIdentifier, Room } from \"types/rooms.types\";\nimport { CameraManager, createCameraManager } from \"./camera\";\nimport { createGround, Ground } from \"./ground\";\nimport { createLighting, Lighting } from \"./lights\";\nimport { createPlayer, Player } from \"./player\";\n\nexport interface AboutRoomProps {\n  player: ModelIdentifier;\n  ground: ModelIdentifier;\n}\n\ninterface Components {\n  camera: CameraManager;\n  player: Player;\n  ground: Ground;\n  lighting: Lighting;\n}\n\nexport const createAboutRoom = ({ ground, player }: AboutRoomProps): Room => {\n  //====References====\n  const serviceRegistry = getServiceRegistry();\n  const [storage, logger, context] = [\n    serviceRegistry.get(\"GlobalStorageManager\"),\n    serviceRegistry.get(\"Logger\"),\n    serviceRegistry.get(\"ThreeJSContextManager\"),\n  ];\n\n  const { scene, camera, orbit, renderer } = {\n    scene: context.get(\"scene\")!,\n    camera: context.get(\"camera\")!,\n    orbit: context.get(\"orbit\")!,\n    renderer: context.get(\"renderer\")!,\n  };\n\n  //===Local===\n  const components: Components = {\n    camera: createCameraManager({ camera: camera, scene: scene }),\n    player: createPlayer({ logger, reference: player, scene, storage }),\n    ground: createGround({ logger, reference: ground, storage }),\n    lighting: createLighting({ renderer, scene }),\n  };\n\n  let group: Nullable<Group<Object3DEventMap>> = null;\n\n  const mount = () => {\n    logger.onMount({ origin: \"about-room\" });\n    components.ground.mount();\n    components.player.mount();\n    components.camera.mount();\n    components.lighting.mount();\n    group =\n      storage.getStorage(\"model\").retrieve(ground.storageId)?.groups ?? null;\n  };\n\n  const activate = () => {\n    if (group) group.visible = true;\n\n    orbit.enabled = false;\n    components.camera.activate();\n    components.ground.actiavte();\n    components.lighting.activate();\n    components.player.activate();\n  };\n\n  const update = (deltaTime: number) => {\n    // components.camera.update(deltaTime);\n  };\n\n  const deactivate = () => {\n    if (group) group.visible = false;\n\n    components.camera.deactivate();\n    components.ground.deactivate();\n    components.lighting.deactivate();\n    components.player.deactiavte();\n  };\n\n  const unmount = () => {\n    components.camera.unmount();\n    components.ground.unmount();\n    components.lighting.unmount();\n    components.player.unmount();\n  };\n\n  return {\n    mount: mount,\n    setActive: activate,\n    update: update,\n    setDeactive: deactivate,\n    unmount: unmount,\n    isLoaded: false,\n  };\n};\n","import { Euler, MathUtils, PerspectiveCamera, Spherical, Vector3 } from \"three\";\nimport { GenericLifeCycle } from \"types/rooms.types\";\n\nexport type CameraMode = \"firstPerson\" | \"thirdPerson\";\n\nexport interface CameraProps {\n  /**Main Camera */\n  camera: PerspectiveCamera;\n}\n\n/** Contains the Updated info about player */\nexport type UpdatedInfo = {\n  playerPosition: Vector3;\n  rotationDelta: { yaw: number; pitch: number };\n};\n\n/** Controls to manage camera */\nexport interface CameraManager extends GenericLifeCycle {\n  /** Updates the camera to look the player */\n  update: (info: UpdatedInfo) => { rotation: Euler };\n\n  /**sets the mode of camera */\n  setMode: (mode: CameraMode) => void;\n}\n\n//Third Person Config\nconst TPV_CONFIG = {\n  DISTANCE: 3,\n  HEIGHT_OFFSET: 2,\n  PITCH_MIN: 0,\n  PITH_MAX: Math.PI / 2,\n  SMOOTHING: 0.1,\n} as const;\n\n//Temporary Variables\n\nlet tempPosition = new Vector3(0, 0, 0);\nlet tempOffset = new Vector3(0, 0, 0);\nlet tempLookTarget = new Vector3(0, 0, 0);\n\n/**\n *\n * @param yaw the yaw angle\n * @param pitch the pitch angle\n * @returns restricted angles\n */\nfunction clampRotation(\n  yaw: number,\n  pitch: number\n): { yaw: number; pitch: number } {\n  return {\n    yaw: MathUtils.euclideanModulo(yaw, Math.PI * 2),\n    pitch: MathUtils.clamp(pitch, TPV_CONFIG.PITCH_MIN, TPV_CONFIG.PITH_MAX),\n  };\n}\n\n/**\n *\n * @param spherical the spherical coordinates\n * @returns the Vector based on spherical coordinates\n */\nfunction computeThirdPersonOffset(spherical: Spherical): Vector3 {\n  tempOffset.set(0, 0, 0);\n  tempOffset.setFromSpherical(spherical);\n  tempOffset.y += TPV_CONFIG.HEIGHT_OFFSET;\n\n  return tempOffset;\n}\n\n/**\n * Smoothly interpolate value between from and to vectors based on alpha\n */\nfunction lerpVector(from: Vector3, to: Vector3, alpha: number) {\n  return from.lerp(to, alpha);\n}\n\ninterface InternalState {\n  mode: CameraMode;\n  rotation: { yaw: number; pitch: number };\n  spherical: Spherical;\n}\n\nexport const createCameraManager = ({ camera }: CameraProps): CameraManager => {\n  let isThirdPerson: boolean = true;\n  let state: InternalState = {\n    mode: \"thirdPerson\",\n    rotation: { pitch: Math.PI / 2, yaw: 0 },\n    spherical: new Spherical(TPV_CONFIG.DISTANCE, Math.PI / 2, 0),\n  };\n\n  const setCamera = (mode: CameraMode) => {\n    state.mode = mode;\n  };\n\n  const mount = () => {};\n\n  const activate = () => {\n    camera.position.set(1, 2, 3);\n  };\n\n  /**\n   *\n   * @param yaw\n   * @param pitch\n   */\n  const updateRotation = (delta: { yaw: number; pitch: number }) => {\n    state.rotation.yaw += delta.yaw;\n    state.rotation.pitch += delta.pitch;\n\n    const clamped = clampRotation(state.rotation.yaw, state.rotation.pitch);\n    state.rotation.yaw = clamped.yaw;\n    state.rotation.pitch = clamped.pitch;\n  };\n\n  const updateThirdPerson = (info: UpdatedInfo) => {\n    state.spherical.theta = state.rotation.yaw;\n    state.spherical.phi = state.rotation.pitch;\n\n    //Calculate offset\n    tempOffset.copy(computeThirdPersonOffset(state.spherical));\n\n    //Calculate target position and camera lerp smoothly\n    tempPosition.copy(info.playerPosition).add(tempOffset);\n    camera.position.copy(\n      lerpVector(camera.position, tempPosition, TPV_CONFIG.SMOOTHING)\n    );\n\n    tempLookTarget.copy(info.playerPosition);\n    tempLookTarget.y += TPV_CONFIG.HEIGHT_OFFSET;\n    camera.lookAt(tempLookTarget);\n  };\n\n  const updateFirstPerson = (playerPos: Vector3) => {\n    camera.position.copy(playerPos);\n    camera.rotation.set(state.rotation.pitch, state.rotation.yaw, 0);\n  };\n\n  const update = (info: UpdatedInfo): { rotation: Euler } => {\n    updateRotation(info.rotationDelta);\n\n    if (state.mode === \"thirdPerson\") {\n      updateThirdPerson(info);\n    } else {\n      updateFirstPerson(info.playerPosition);\n    }\n\n    return {\n      rotation: camera.rotation,\n    };\n  };\n\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    setMode: setCamera,\n    update: update,\n    mount: mount,\n    activate: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n","import { PerspectiveCamera, ShaderMaterial, Vector3 } from \"three\";\nimport { GridFragment } from \"./grid-fragment\";\nimport { GridVertex } from \"./grid-vertex\";\n\nexport interface GridMaterialProps {\n  camera: PerspectiveCamera;\n  fadeNear: number;\n  fadeFar: number;\n}\n\nexport interface GridMaterial {\n  mat: ShaderMaterial;\n  update: (cameraPos: Vector3) => void;\n}\n\nexport const createGridMaterial = (props: GridMaterialProps) => {\n  const mat: ShaderMaterial = new ShaderMaterial({\n    uniforms: {\n      time: { value: 1 },\n      cameraPos: { value: props.camera.position },\n      fadeNear: { value: props.fadeNear },\n      fadeFar: { value: props.fadeFar },\n    },\n    vertexShader: GridVertex,\n    fragmentShader: GridFragment,\n  });\n\n  const update = (cameraPos: Vector3) => {\n    mat.uniforms.cameraPos.value = cameraPos;\n  };\n\n  return {\n    mat: mat,\n    update: update,\n  };\n};\n","export const GridFragment = `\n    precision highp float;\n\n    varying vec2 vUV;\n\n    float line(vec2 uv,float lineWidth){\n\n       \n        float lineAA=fwidth(uv.x);\n \n        float lineUV=1.0-abs(fract(uv.x)*2.0-1.0);\n\n        return smoothstep(lineWidth+lineAA,lineWidth-lineAA,lineUV);\n    }  \n\n    float grid(vec2 uv,float lineWidth){\n\n        vec2 uvDeriv=fwidth(uv);\n        vec2 drawWidth=max(vec2(lineWidth),uvDeriv);\n        vec2 lineAA=uvDeriv*1.5;\n \n        vec2 gridUV=1.0-abs(fract(uv)*2.0-1.0);\n\n        vec2 gridLines=smoothstep(drawWidth+lineAA,drawWidth-lineAA,gridUV);\n        gridLines*=clamp(lineWidth/drawWidth,0.0,1.0);\n\n        return mix(gridLines.x,1.0,gridLines.y);\n    } \n\n    void main(){\n        vec2 st=vUV*1500.0;\n       \n        gl_FragColor = vec4(vec3(grid(st,0.01)),1.0);\n    }\n\n`;\n","export const GridVertex = `\n    precision highp float;\n\n    \n\n    varying vec2 vUV;\n    varying vec4 vWorldPos; \n\n    void main(){\n        vUV=uv;\n        vWorldPos=modelViewMatrix*vec4(position,1.0);\n\n        gl_Position = projectionMatrix*modelViewMatrix*vec4(position,1.0);\n    }\n\n`;\n","import { Logger } from \"@utils/Logger\";\nimport { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport { createGridMaterial, GridMaterial } from \"materials/grid/grid-material\";\nimport { Mesh, PerspectiveCamera } from \"three\";\nimport { ModelIdentifier } from \"types/rooms.types\";\n\nexport interface GroundProps {\n  references: ModelIdentifier;\n  storage: GlobalStorageManager;\n  logger: Logger;\n  camera: PerspectiveCamera;\n}\n\nexport interface Ground {\n  mount: () => void;\n  update: () => void;\n  activate: () => void;\n  deactivate: () => void;\n  unmount: () => void;\n}\n\nexport const createGround = ({\n  logger,\n  references,\n  storage,\n  camera,\n}: GroundProps): Ground => {\n  let ground: Nullable<Mesh> = null;\n  let gridMat: Nullable<GridMaterial> = null;\n\n  const mount = () => {\n    ground =\n      (storage\n        .getStorage(\"model\")\n        .retrieve(references.storageId)\n        ?.groups.getObjectByName(references.id) as Mesh) ?? null;\n\n    if (!ground) {\n      console.error(\n        `Cant get ground mesh from the id : ${references.id} ${references.storageId}`\n      );\n      return;\n    }\n\n    gridMat = createGridMaterial({\n      camera: camera,\n      fadeNear: 0.1,\n      fadeFar: 1,\n    });\n\n    ground.material = gridMat.mat;\n    logger.onMount({ origin: \"Navigation-Ground\" });\n  };\n\n  const update = () => {\n    gridMat?.update(camera.position);\n  };\n\n  const activate = () => {};\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    update: update,\n    activate: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n","import { AnimationAction, AnimationMixer } from \"three\";\n\nexport interface AnimationControllerProps {\n  mixer: AnimationMixer;\n  actions: Record<string, AnimationAction>;\n  crossFadeDuration: 0.3;\n}\n\nexport interface AnimationController {\n  play: (animationName: string, blendDuration?: number) => void;\n  stop: () => void;\n  getCurrentAnimation: () => string | null;\n  update: (deltaTime: number) => void;\n}\n\nexport const createAnimationController = ({\n  mixer,\n  actions,\n  crossFadeDuration = 0.3,\n}: AnimationControllerProps): AnimationController => {\n  let currentAnimation: Nullable<string> = null;\n  let blendTime: number = 0;\n  let currentAction: Nullable<AnimationAction> = null;\n\n  const play = (animationName: string, blendDuration = 0) => {\n    if (currentAnimation === animationName) return;\n\n    const nextAction = actions[animationName];\n    if (!nextAction) return;\n    nextAction.reset();\n    nextAction.play();\n\n    if (currentAction != null) {\n      (currentAction as AnimationAction).crossFadeTo(\n        nextAction,\n        crossFadeDuration,\n        false\n      );\n    }\n\n    currentAction = nextAction;\n    currentAnimation = animationName;\n  };\n\n  const stop = () => {};\n\n  const getCurrentAnimation = () => {\n    return currentAnimation;\n  };\n\n  const update = (deltaTime: number) => {\n    if (deltaTime !== undefined) mixer.update(deltaTime);\n  };\n\n  return {\n    play: play,\n    getCurrentAnimation: getCurrentAnimation,\n    stop: stop,\n    update: update,\n  };\n};\n","import { InputManager } from \"engine/managers/InputManager\";\nimport { AnimationController } from \"../animation\";\n\ntype States = \"Idle\" | \"Walk\" | \"Run\";\n\ninterface PlayerFSM {\n  changeState: (state: States) => void;\n  isMoving: () => boolean;\n  isShiftPressed: () => boolean;\n}\n\ninterface StateProps {\n  animationId: string;\n  animationController: AnimationController;\n}\n\ninterface State {\n  enter: (player: PlayerFSM) => void;\n  execute: (player: PlayerFSM) => void;\n  exit: (player: PlayerFSM) => void;\n}\n\nconst Idle = (props: StateProps): State => {\n  const enter = (player: PlayerFSM) => {\n    console.log(\"enter idle\");\n    props.animationController.play(props.animationId);\n  };\n\n  const execute = (player: PlayerFSM) => {\n    if (player.isMoving()) {\n      if (player.isShiftPressed()) {\n        player.changeState(\"Run\");\n      } else {\n        player.changeState(\"Walk\");\n      }\n    }\n  };\n\n  const exit = (player: PlayerFSM) => {\n    console.log(\"exit idle\");\n  };\n\n  return {\n    enter: enter,\n    execute: execute,\n    exit: exit,\n  };\n};\n\nconst Walk = (props: StateProps): State => {\n  const enter = (player: PlayerFSM) => {\n    console.log(\"enter walk\");\n    props.animationController.play(props.animationId);\n  };\n\n  const execute = (player: PlayerFSM) => {\n    if (!player.isMoving()) {\n      player.changeState(\"Idle\");\n    } else if (player.isShiftPressed()) {\n      player.changeState(\"Run\");\n    }\n  };\n\n  const exit = (player: PlayerFSM) => {\n    console.log(\"exit walk\");\n  };\n\n  return {\n    enter: enter,\n    execute: execute,\n    exit: exit,\n  };\n};\n\nconst Run = (props: StateProps): State => {\n  const enter = (player: PlayerFSM) => {\n    console.log(\"enter run\");\n    props.animationController.play(props.animationId);\n  };\n\n  const execute = (player: PlayerFSM) => {\n    if (!player.isMoving()) {\n      player.changeState(\"Idle\");\n    } else if (!player.isShiftPressed()) {\n      player.changeState(\"Walk\");\n    }\n  };\n\n  const exit = (player: PlayerFSM) => {\n    console.log(\"exit run\");\n  };\n\n  return {\n    enter: enter,\n    execute: execute,\n    exit: exit,\n  };\n};\n\nexport interface FSMOptions {\n  inputs: InputManager;\n  animationController: AnimationController;\n}\n\nexport interface FSMController {\n  mount: () => void;\n  update: (deltaTime: number) => void;\n  unmount: () => void;\n}\n\nexport const createFSMController = ({\n  inputs,\n  animationController,\n}: FSMOptions): FSMController => {\n  const { mouse, keyboard } = {\n    mouse: inputs.getController(\"mouse\"),\n    keyboard: inputs.getController(\"keyboard\"),\n  };\n\n  let shiftPressed: boolean;\n  const { idle, walk, run } = {\n    idle: Idle({\n      animationController: animationController,\n      animationId: \"Idle\",\n    }),\n    walk: Walk({\n      animationController: animationController,\n      animationId: \"Walk\",\n    }),\n    run: Run({\n      animationController: animationController,\n      animationId: \"Run\",\n    }),\n  };\n  let state: State = idle;\n  let currentState: States = \"Idle\";\n\n  const update = (deltaTime: number) => {\n    state.execute(playerFSM);\n    animationController.update(deltaTime);\n  };\n\n  const isMoving = () => {\n    if (\n      keyboard?.isKeyPressed(\"w\") ||\n      keyboard?.isKeyPressed(\"a\") ||\n      keyboard?.isKeyPressed(\"s\") ||\n      keyboard?.isKeyPressed(\"d\")\n    ) {\n      return true;\n    }\n\n    return false;\n  };\n\n  const isShiftPressed = () => {\n    return keyboard?.isKeyPressed(\"shift\") ?? false;\n  };\n\n  const _getState = (newState: States) => {\n    switch (newState) {\n      case \"Idle\":\n        return idle;\n      case \"Walk\":\n        return walk;\n      case \"Run\":\n        return run;\n      default:\n        return idle;\n    }\n  };\n\n  const changeState = (newState: States) => {\n    if (currentState !== newState) {\n      currentState = newState;\n      state.exit(playerFSM);\n      state = _getState(newState);\n      state.enter(playerFSM);\n    }\n  };\n\n  const mount = () => {\n    state.enter(playerFSM);\n  };\n\n  const playerFSM: PlayerFSM = {\n    changeState: changeState,\n    isMoving: isMoving,\n    isShiftPressed: isShiftPressed,\n  };\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    update: update,\n    unmount: unmount,\n  };\n};\n","import { InputManager } from \"engine/managers/InputManager\";\nimport { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport {\n  AnimationController,\n  createAnimationController,\n} from \"gameplay/modules/animation\";\nimport {\n  createFSMController,\n  FSMController,\n} from \"gameplay/modules/fsm/player\";\nimport { KeyboardInput } from \"plugins/input/keyboard\";\nimport { MouseInput } from \"plugins/input/mouse\";\nimport { AnimationMixer, Euler, Object3D, Vector3 } from \"three\";\nimport { GenericLifeCycle, ModelIdentifier } from \"types/rooms.types\";\n\nexport interface PlayerProps {\n  reference: ModelIdentifier;\n  storage: GlobalStorageManager;\n  InputManager: InputManager;\n}\n\nexport interface Player extends GenericLifeCycle {\n  /** Update based on controller input */\n  update: (deltaTime: number) => {\n    position: Vector3;\n    rotation: Euler;\n    rotationDelta: { yaw: number; pitch: number };\n  };\n}\n\ninterface PlayerState {\n  direction: Vector3;\n  velocity: Vector3;\n  rotationApplied: {\n    yaw: number;\n    pitch: number;\n  };\n}\n\ninterface Controllers {\n  input: {\n    mouse: Nullable<MouseInput>;\n    keyboard: Nullable<KeyboardInput>;\n  };\n  animation: AnimationController;\n  fsm: FSMController;\n}\n\ninterface ObjectReferences {\n  player: Nullable<Object3D>;\n}\n\nconst PLAYER_CONSTANTS = {\n  MOVEMENT_ACCELERATION: 0.05,\n  MAX_VELOCITY: 0.05,\n};\n\ninterface TempData {\n  inputDirection: Vector3;\n}\n\nexport const createPlayer = ({\n  reference,\n  storage,\n  InputManager,\n}: PlayerProps): Player => {\n  let controllers: Controllers;\n\n  let state: PlayerState = {\n    direction: new Vector3(0, 0, -1),\n    velocity: new Vector3(0, 0, 0),\n    rotationApplied: {\n      pitch: 0,\n      yaw: 0,\n    },\n  };\n  let tempData: TempData = {\n    inputDirection: new Vector3(0, 0, 0),\n  };\n\n  let objects: ObjectReferences = { player: null };\n\n  const mount = () => {\n    try {\n      const playerRoot = storage\n        .getStorage(\"model\")\n        .retrieve(reference.storageId);\n\n      if (!playerRoot) {\n        throw new Error(\n          `player doesn't exist for the id ${reference.storageId}`\n        );\n      }\n      const player = playerRoot?.groups;\n      const animations = playerRoot?.animations;\n\n      /**Animation */\n      const mixer = new AnimationMixer(player);\n      const animationController = createAnimationController({\n        mixer: mixer,\n        actions: {\n          Idle: mixer.clipAction(animations[0]),\n          Walk: mixer.clipAction(animations[3]),\n          Run: mixer.clipAction(animations[1]),\n        },\n        crossFadeDuration: 0.3,\n      });\n\n      const fsmController = createFSMController({\n        animationController: animationController,\n        inputs: InputManager,\n      });\n      fsmController.mount();\n\n      objects = {\n        player: player,\n      };\n\n      controllers = {\n        input: {\n          mouse: InputManager.getController(\"mouse\"),\n          keyboard: InputManager.getController(\"keyboard\"),\n        },\n        animation: animationController,\n        fsm: fsmController,\n      };\n    } catch (err) {\n      console.error(`Player mesh cant be obtained :${err}`);\n    }\n  };\n\n  const updateMouse = (mouse: Nullable<MouseInput>) => {\n    if (!mouse || !objects.player!) return;\n\n    state.rotationApplied = mouse.getRotation();\n    objects.player.rotation.y += state.rotationApplied.yaw;\n  };\n\n  const updateKeyboard = (\n    keyboard: Nullable<KeyboardInput>,\n    deltaTime: number\n  ) => {\n    if (!keyboard || !objects.player) return;\n    const FRICTION = 5.0;\n    const VELOCITY_DEADZONE = 0.001;\n\n    const { inputDirection } = tempData;\n    inputDirection.set(0, 0, 0);\n\n    if (keyboard.isKeyPressed(\"w\")) inputDirection.z -= 1;\n    if (keyboard.isKeyPressed(\"s\")) inputDirection.z += 1;\n    if (keyboard.isKeyPressed(\"a\")) inputDirection.x -= 1;\n    if (keyboard.isKeyPressed(\"d\")) inputDirection.x += 1;\n\n    if (inputDirection.length() > 0) {\n      //normalize direction\n      inputDirection.applyQuaternion(objects.player.quaternion);\n      inputDirection.normalize();\n\n      //accelerate towards the direction\n      state.velocity.add(\n        inputDirection.multiplyScalar(\n          PLAYER_CONSTANTS.MOVEMENT_ACCELERATION * deltaTime\n        )\n      );\n      //ensure the velocity doesn't go over the threshold\n      state.velocity.clampLength(0, PLAYER_CONSTANTS.MAX_VELOCITY);\n    } else if (inputDirection.length() == 0 && state.velocity.length() > 0) {\n      const decay = Math.exp(-FRICTION * deltaTime);\n      state.velocity.multiplyScalar(decay);\n\n      if (state.velocity.lengthSq() < VELOCITY_DEADZONE * VELOCITY_DEADZONE) {\n        state.velocity.set(0, 0, 0);\n      }\n    }\n\n    objects.player.position.add(state.velocity);\n  };\n\n  const updateControllers = (deltaTime: number) => {\n    updateMouse(controllers.input.mouse);\n    updateKeyboard(controllers.input.keyboard, deltaTime);\n  };\n\n  const update = (deltaTime: number) => {\n    updateControllers(deltaTime);\n\n    controllers.fsm.update(deltaTime);\n\n    return {\n      position: objects.player?.position ?? new Vector3(0, 0, 0),\n      rotation: objects.player?.rotation ?? new Euler(0, 0, 0, \"XYZ\"),\n      rotationDelta: state.rotationApplied,\n    };\n  };\n\n  const activate = () => {\n    // objects.playerRoot.rotation.set(0,0,0,'XYZ')\n  };\n\n  const deactivate = () => {};\n\n  const unmount = () => {\n    try {\n      //objects.playerRoot.clear();\n    } catch (err) {\n      console.error(`Error while destroy player ${err}`);\n    }\n  };\n\n  return {\n    mount: mount,\n    activate: activate,\n    deactivate: deactivate,\n    update: update,\n    unmount: unmount,\n  };\n};\n","import { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { InputManager } from \"engine/managers/InputManager\";\nimport { Euler, Vector3 } from \"three\";\nimport { ObjectStorageUnit } from \"types/managers.types\";\nimport { ModelIdentifier, Room } from \"types/rooms.types\";\nimport { CameraManager, createCameraManager } from \"./camera\";\nimport { createGround, Ground } from \"./ground\";\nimport { createPlayer, Player } from \"./player\";\n\nexport interface NavigationRoomProps {\n  player: ModelIdentifier;\n  ground: ModelIdentifier;\n}\n\ninterface Entities {\n  player: Player;\n  ground: Ground;\n  camera: CameraManager;\n  inputs: InputManager;\n}\n\ninterface InternalState {\n  player: {\n    position: Vector3;\n    rotation: Euler;\n    rotationDelta: { yaw: number; pitch: number };\n  };\n}\n\ninterface TempData {}\n\nexport const createNavigationRoom = ({\n  player,\n  ground,\n}: NavigationRoomProps): Room => {\n  //External dependencies\n  const serviceRegistry = getServiceRegistry();\n\n  const [logger, storage, eventBusManager, InputManager, contextManager] = [\n    serviceRegistry.get(\"Logger\"),\n    serviceRegistry.get(\"GlobalStorageManager\"),\n    serviceRegistry.get(\"EventBusManager\"),\n    serviceRegistry.get(\"InputManager\"),\n    serviceRegistry.get(\"ThreeJSContextManager\"),\n  ];\n\n  //Internal\n  let components: Nullable<Entities> = {\n    camera: createCameraManager({ camera: contextManager.get(\"camera\")! }),\n    player: createPlayer({\n      reference: player,\n      InputManager: InputManager,\n      storage: storage,\n    }),\n    ground: createGround({\n      camera: contextManager.get(\"camera\")!,\n      logger: logger,\n      references: ground,\n      storage: storage,\n    }),\n    inputs: InputManager,\n  };\n\n  //TODO:no idea on what to add yet\n  let state: Nullable<InternalState> = null;\n  //TODO: no idea what temporary data to add yet\n  let tempData: Nullable<TempData> = null;\n\n  let room: Nullable<ObjectStorageUnit> = null;\n  let isMounted: boolean = false;\n\n  const activate = () => {\n    if (!room || !components) return;\n    room.groups.visible = true;\n    contextManager.get(\"orbit\")!.enabled = false;\n\n    components.camera.activate();\n    components.ground.activate();\n    components.player.activate();\n  };\n\n  const deactivate = () => {\n    if (!room || !components) return;\n    room.groups.visible = false;\n\n    components.camera.deactivate();\n    components.ground.deactivate();\n    components.player.deactivate();\n  };\n\n  const mount = () => {\n    if (isMounted || !components) return;\n\n    logger.onMount({ origin: \"Navigation Room\" });\n    state = {\n      player: {\n        position: new Vector3(0, 0, 0),\n        rotation: new Euler(0, 0, 0),\n        rotationDelta: { yaw: 0, pitch: 0 },\n      },\n    };\n\n    //get base root i.e group so that it can be used to toggle visibility\n    room = storage.getStorage(\"model\").retrieve(ground.storageId) ?? null;\n\n    components.player.mount();\n    components.ground.mount();\n    components.camera.mount();\n\n    isMounted = true;\n  };\n\n  const update = (deltaTime: number) => {\n    if (!isMounted || !components || !state) return;\n    contextManager.get(\"orbit\")!.update();\n    state.player = components.player.update(deltaTime);\n    components.camera.update({\n      playerPosition: state.player.position,\n      rotationDelta: state.player.rotationDelta,\n    });\n\n    //entities.ground.update();\n  };\n\n  const unmount = () => {\n    if (!isMounted || !components) return;\n\n    logger.onUnmount({ origin: \"Navigation Room\" });\n\n    components.player.unmount();\n    components.ground.unmount();\n\n    components = null;\n    room = null;\n  };\n\n  return {\n    mount: mount,\n    update: update,\n    unmount: unmount,\n    setActive: activate,\n    setDeactive: deactivate,\n    isLoaded: false,\n  };\n};\n","import { EventBusManager } from \"@events/EventBusManager\";\nimport { CatmullRomCurve3, PerspectiveCamera, Scene, Vector3 } from \"three\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\n\nexport interface CameraProps {\n  camera: PerspectiveCamera;\n  scene: Scene;\n  orbit: OrbitControls;\n  eventBusManager: EventBusManager;\n}\n\nexport interface CameraManager {\n  mount: () => void;\n  activate: () => void;\n  update: (deltaTime: number) => void;\n  deactivate: () => void;\n  unmount: () => void;\n}\n\nexport const createCameraManager = ({\n  camera,\n  eventBusManager,\n  orbit,\n  scene,\n}: CameraProps): CameraManager => {\n  const points: Vector3[] = [\n    new Vector3(0, 2, 10),\n    new Vector3(0, 2, 5),\n    new Vector3(0, 2, 3),\n    new Vector3(0, 2, 2),\n    new Vector3(0, 2, 1),\n    new Vector3(0, 2, 0),\n    new Vector3(0, 2, -1),\n    new Vector3(0, 1, -1),\n    new Vector3(0, 1, -1.5),\n    new Vector3(0, 1, -2),\n  ];\n\n  const camPath = new CatmullRomCurve3(points);\n  let t = 0;\n  let isComplete: boolean = false;\n\n  const mount = () => {\n    t = 0;\n  };\n\n  const activate = () => {\n    orbit.enabled = false;\n    camera.position.set(0, 2.5, 10);\n    camera.near = 0.001;\n    camera.far = 1000;\n  };\n\n  const update = (deltaTime: number) => {\n    if (!isComplete && t > 1) {\n      isComplete = true;\n      orbit.enabled = true;\n      eventBusManager.viewBus.emit({\n        type: \"project-screen:show\",\n        elementId: \"project-screen\",\n      });\n      console.log(\"event emitted view event\");\n    }\n\n    if (!isComplete) {\n      t += deltaTime * 0.1;\n\n      if (t <= 0.9) {\n        const position = camPath.getPointAt(t);\n        const lookAt = camPath.getPointAt(t + 0.1);\n        lookAt.z -= 0.1;\n        camera.position.copy(position);\n        camera.lookAt(lookAt);\n      }\n    }\n  };\n\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    activate: activate,\n    update: update,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n","import { Logger } from \"@utils/Logger\";\nimport { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport { Material, Mesh, MeshStandardMaterial } from \"three\";\nimport { ModelIdentifier } from \"types/rooms.types\";\n\nexport interface GroundProps {\n  reference: ModelIdentifier;\n  logger: Logger;\n  storage: GlobalStorageManager;\n}\n\nexport interface Ground {\n  mount: () => void;\n  actiavte: () => void;\n  deactivate: () => void;\n  unmount: () => void;\n}\n\nexport const createGround = ({\n  reference,\n  logger,\n  storage,\n}: GroundProps): Ground => {\n  let ground: Nullable<Mesh> = null;\n\n  const mount = () => {\n    const groups = storage\n      .getStorage(\"model\")\n      .retrieve(reference.storageId)?.groups;\n    ground = groups?.getObjectByName(reference.id) as Mesh;\n\n    if (!ground) {\n      console.error(`Cant get ground mesh from the id : ${reference.id}`);\n      return;\n    }\n    ground.material = (ground.material as Material).clone();\n    ground.receiveShadow = true;\n\n    (ground.material as Material).needsUpdate = true;\n    (ground.material as MeshStandardMaterial).opacity = 1;\n    (ground.material as MeshStandardMaterial).transparent = true;\n    const excludeShadow = [\"sky\", \"ground\"];\n\n    groups?.traverse((child) => {\n      if (!excludeShadow.includes(child.name)) {\n        child.castShadow = true;\n      }\n    });\n\n    logger.onMount({ origin: \"about-ground\" });\n  };\n\n  const activate = () => {};\n\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    actiavte: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n","import {\n  AmbientLight,\n  DirectionalLight,\n  PCFShadowMap,\n  Scene,\n  WebGLRenderer,\n} from \"three\";\n\nexport interface LightingProps {\n  scene: Scene;\n  renderer: WebGLRenderer;\n}\n\nexport interface Lighting {\n  mount: () => void;\n  activate: () => void;\n  deactivate: () => void;\n  unmount: () => void;\n}\n\nexport const createLighting = ({\n  renderer,\n  scene,\n}: LightingProps): Lighting => {\n  let dirLight: Nullable<DirectionalLight>;\n  let ambientLight: Nullable<AmbientLight>;\n\n  const mount = () => {\n    dirLight = new DirectionalLight(0xffffff, 5);\n    dirLight.castShadow = true;\n    dirLight.position.set(0, 1, 0.5);\n    dirLight.target.position.set(0, 0, 0);\n\n    dirLight.shadow.mapSize.width = 1024;\n    dirLight.shadow.mapSize.height = 1024;\n    dirLight.shadow.camera.near = 0.1;\n    dirLight.shadow.camera.far = 50;\n    dirLight.shadow.camera.left = -10;\n    dirLight.shadow.camera.right = 10;\n    dirLight.shadow.camera.top = 10;\n    dirLight.shadow.camera.bottom = -10;\n\n    ambientLight = new AmbientLight(0xffffff);\n\n    renderer.shadowMap.enabled = true;\n    renderer.shadowMap.type = PCFShadowMap;\n  };\n\n  const activate = () => {\n    if (dirLight) scene.add(dirLight);\n    if (ambientLight) scene.add(ambientLight);\n  };\n\n  const deactivate = () => {\n    if (dirLight) scene.remove(dirLight);\n    if (ambientLight) scene.remove(ambientLight);\n  };\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    activate: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n","import { Logger } from \"@utils/Logger\";\nimport { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport { AnimationMixer, Object3D, Object3DEventMap, Scene } from \"three\";\nimport { ModelIdentifier } from \"types/rooms.types\";\n\nexport interface PlayerProps {\n  reference: ModelIdentifier;\n  storage: GlobalStorageManager;\n  logger: Logger;\n}\n\nexport interface PlayerContext {\n  scene: Scene;\n}\n\nexport interface Player {\n  mount: () => void;\n  activate: () => void;\n  update: (deltaTime: number) => void;\n  deactiavte: () => void;\n  unmount: () => void;\n}\n\ninterface ObjectReferences {\n  playerRoot: Object3D;\n}\n\nexport const createPlayer = ({\n  logger,\n  reference,\n  storage,\n}: PlayerProps): Player => {\n  let objects: ObjectReferences;\n  let mixers: AnimationMixer[] = [];\n\n  const castShadow = (player: Object3D<Object3DEventMap>) => {\n    player.traverse((child) => {\n      child.castShadow = true;\n    });\n  };\n\n  const mount = () => {\n    try {\n      let playerRoot = storage\n        .getStorage(\"model\")\n        .retrieve(reference.storageId)?.groups;\n      let animations =\n        storage.getStorage(\"model\").retrieve(reference.storageId)?.animations ??\n        [];\n\n      if (!playerRoot) {\n        throw new Error(\n          `player doesn't exist for the id ${reference.storageId}`\n        );\n      }\n\n      //Local References\n      objects = {\n        playerRoot: playerRoot,\n      };\n\n      // console.log('armature',armature)\n      const mixer = new AnimationMixer(playerRoot);\n      mixer.clipAction(animations[2]).play();\n\n      mixers.push(mixer);\n      logger.onMount({ origin: \"Project-Room-Player\" });\n    } catch (err) {\n      console.error(`Player mesh cant be obtained :${err}`);\n    }\n  };\n\n  const activate = () => {\n    if (objects.playerRoot) {\n      objects.playerRoot.rotation.set(0, 0, 0, \"XYZ\");\n      objects.playerRoot.castShadow = true;\n      castShadow(objects.playerRoot);\n    }\n  };\n\n  const update = (deltaTime: number) => {\n    mixers.forEach((mixer) => {\n      mixer.update(deltaTime);\n    });\n  };\n\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    activate: activate,\n    update: update,\n    deactiavte: deactivate,\n    unmount: unmount,\n  };\n};\n","import { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { Group, Object3DEventMap } from \"three\";\nimport { ModelIdentifier, Room, RoomProps } from \"types/rooms.types\";\nimport { CameraManager, createCameraManager } from \"./camera\";\nimport { createGround, Ground } from \"./ground\";\nimport { createLighting, Lighting } from \"./lights\";\nimport { createPlayer, Player } from \"./player\";\n\nexport interface ProjectRoomProps extends RoomProps {\n  player: ModelIdentifier;\n  ground: ModelIdentifier;\n}\n\ninterface Components {\n  camera: CameraManager;\n  player: Player;\n  ground: Ground;\n  lighting: Lighting;\n}\n\nexport const createProjectRoom = ({\n  player,\n  ground,\n}: ProjectRoomProps): Room => {\n  //====References===\n  const serviceRegistry = getServiceRegistry();\n  const [storage, context, eventBusManager, logger] = [\n    serviceRegistry.get(\"GlobalStorageManager\"),\n    serviceRegistry.get(\"ThreeJSContextManager\"),\n    serviceRegistry.get(\"EventBusManager\"),\n    serviceRegistry.get(\"Logger\"),\n  ];\n\n  const { scene, camera, orbit, renderer } = {\n    scene: context.get(\"scene\")!,\n    camera: context.get(\"camera\")!,\n    orbit: context.get(\"orbit\")!,\n    renderer: context.get(\"renderer\")!,\n  };\n\n  //===Local===\n  const components: Components = {\n    camera: createCameraManager({\n      camera,\n      eventBusManager,\n      orbit,\n      scene,\n    }),\n    player: createPlayer({ logger, reference: player, storage }),\n    ground: createGround({ logger, reference: ground, storage }),\n    lighting: createLighting({ renderer, scene }),\n  };\n  let group: Nullable<Group<Object3DEventMap>> = null;\n\n  const mount = () => {\n    components.ground.mount();\n    components.player.mount();\n    components.camera.mount();\n    components.lighting.mount();\n\n    group =\n      storage.getStorage(\"model\").retrieve(ground.storageId)?.groups ?? null;\n\n    logger.onMount({ origin: \"Projects\" });\n  };\n\n  const activate = () => {\n    if (group) group.visible = true;\n\n    components.camera.activate();\n    components.ground.actiavte();\n    components.lighting.activate();\n    components.player.activate();\n  };\n\n  const update = (deltaTime: number) => {\n    components.player.update(deltaTime);\n    components.camera.update(deltaTime);\n  };\n\n  const deactivate = () => {\n    if (group) group.visible = false;\n\n    components.camera.deactivate();\n    components.ground.deactivate();\n    components.lighting.deactivate();\n    components.player.deactiavte();\n  };\n\n  const unmount = () => {\n    components.camera.unmount();\n    components.ground.unmount();\n    components.lighting.unmount();\n    components.player.unmount();\n  };\n\n  return {\n    mount: mount,\n    setActive: activate,\n    update: update,\n    setDeactive: deactivate,\n    unmount: unmount,\n    isLoaded: false,\n  };\n};\n","import {\n  ABOUT_ROOM_ASSETS,\n  NAVIGATION_ROOM_ASSETS,\n  PLAYER_ASSET,\n  PROJECTS_ROOM_ASSETS,\n} from \"config/asset_manifest\";\nimport {\n  ABOUT_ROOM_OPTIONS,\n  NAVIGATION_ROOM_OPTIONS,\n  PROJECTS_ROOM_OPTIONS,\n} from \"config/rooms\";\nimport { createLoader, Loader } from \"engine/core/LoadingManager\";\nimport { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { createAboutRoom } from \"gameplay/rooms/about/room\";\nimport { createNavigationRoom } from \"gameplay/rooms/navigation/room\";\nimport { createProjectRoom } from \"gameplay/rooms/projects/room\";\nimport { Room, RoomAsset } from \"types/rooms.types\";\n\nexport interface RoomController {\n  mount: () => Promise<void>;\n  switchRoom: Record<RoomKey | \"default\", () => void>;\n  update: (deltaTime: number) => void;\n  unmount: () => void;\n}\n\ntype RoomKey = \"navigation\" | \"about\" | \"projects\";\n\ntype RoomMap = {\n  [key in RoomKey]: Nullable<Room>;\n};\n\ntype RoomAssetsMap = {\n  [key in RoomKey]: RoomAsset;\n};\n\nexport const createRoomController = (): RoomController => {\n  const serviceRegistry = getServiceRegistry();\n  const [storage, logger, eventBusManager, contextManager, stateManager] = [\n    serviceRegistry.get(\"GlobalStorageManager\"),\n    serviceRegistry.get(\"Logger\"),\n    serviceRegistry.get(\"EventBusManager\"),\n    serviceRegistry.get(\"ThreeJSContextManager\"),\n    serviceRegistry.get(\"GlobalStateManager\"),\n  ];\n\n  let loader: Nullable<Loader> = null;\n  let rooms: RoomMap = { navigation: null, about: null, projects: null };\n  let roomAssets: RoomAssetsMap = {\n    navigation: NAVIGATION_ROOM_ASSETS,\n    about: ABOUT_ROOM_ASSETS,\n    projects: PROJECTS_ROOM_ASSETS,\n  };\n  let activeRoom: Nullable<Room> = null;\n  let activeRoomKey: Nullable<RoomKey> = null;\n\n  const initializeLoader = (): void => {\n    try {\n      loader = createLoader({\n        storageManager: storage,\n        stateManager: stateManager,\n        loaderEventBus: eventBusManager.loadingBus,\n        renderer: contextManager.get(\"renderer\")!,\n        scene: contextManager.get(\"scene\")!,\n      });\n      loader?.configure();\n    } catch (err) {\n      throw new Error(\n        `[Gameplay] Couldnt create and initailize the loader due to ${err}`\n      );\n    }\n  };\n\n  const instantiateRoom = (key: RoomKey): Room => {\n    switch (key) {\n      case \"navigation\":\n        rooms[key] = createNavigationRoom(NAVIGATION_ROOM_OPTIONS);\n        return rooms[key]!;\n      case \"about\":\n        rooms[key] = createAboutRoom(ABOUT_ROOM_OPTIONS);\n        return rooms[key]!;\n      case \"projects\":\n        rooms[key] = createProjectRoom(PROJECTS_ROOM_OPTIONS);\n        return rooms[key]!;\n      default:\n        throw new Error(`Unknown Room key ${key}`);\n    }\n  };\n\n  const loadRoom = async (key: RoomKey) => {\n    if (!loader) return;\n\n    const assets = roomAssets[key];\n    if (!assets)\n      throw new Error(\n        \"[Room Controller] sufficient asset meta data is not given.\"\n      );\n\n    if (!rooms[key]) {\n      const room: Room = instantiateRoom(key);\n\n      console.log(\"load room\", roomAssets[key]);\n\n      const loadItems = [...roomAssets[key].meshes];\n      if (roomAssets[key].hdr) loadItems.push(roomAssets[key].hdr);\n\n      //Load only once\n      await loader.load(loadItems);\n\n      if (room) {\n        room.mount();\n        room.isLoaded = true;\n        activeRoom = room;\n      }\n    }\n  };\n\n  const switchRoom = async (key: RoomKey): Promise<void> => {\n    if (activeRoomKey === key) return;\n\n    if (activeRoomKey != null) {\n      if (rooms[activeRoomKey] != null) rooms[activeRoomKey]!.setDeactive();\n    }\n\n    await loadRoom(key);\n\n    if (rooms[key]) rooms[key].setActive();\n    activeRoomKey = key;\n  };\n\n  const mount = async (): Promise<void> => {\n    logger.onMount({ origin: \"Room Controller\" });\n    initializeLoader();\n    await loader?.load([PLAYER_ASSET]);\n    await loadRoom(\"navigation\");\n    await switchRoom(\"navigation\");\n  };\n\n  const update = (deltaTime: number) => {\n    activeRoom?.update(deltaTime);\n  };\n\n  const unmount = (): void => {\n    loader?.dispose();\n\n    Object.values(rooms).forEach((room) => {\n      room?.unmount();\n    });\n\n    logger.onUnmount({ origin: \"room-controller\" });\n  };\n\n  const transitionRooms = (key: RoomKey) => {\n    eventBusManager.loadingBus.emit({\n      type: \"load:start\",\n      loaded: 0,\n      total: 0,\n      url: \"\",\n    });\n\n    Promise.allSettled([switchRoom(key)]).then(() => {\n      eventBusManager.loadingBus.emit({ type: \"load:complete\" });\n    });\n  };\n\n  const deactivateRoom = () => {\n    if (!activeRoomKey) return;\n\n    activeRoom?.setDeactive();\n  };\n\n  return {\n    mount: mount,\n    switchRoom: {\n      navigation: () => transitionRooms(\"navigation\"),\n      about: () => transitionRooms(\"about\"),\n      projects: () => transitionRooms(\"projects\"),\n      default: () => deactivateRoom(),\n    },\n    update: update,\n    unmount: unmount,\n  };\n};\n"]}