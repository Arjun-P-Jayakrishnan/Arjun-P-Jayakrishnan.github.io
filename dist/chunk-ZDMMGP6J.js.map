{"version":3,"sources":["../src/gameplay/rooms/navigation/room.ts"],"names":["createNavigationRoom","player","ground","serviceRegistry","getServiceRegistry","logger","storage","eventBusManager","InputManager","contextManager","components","createCameraManager","createPlayer","createGround","state","room","isMounted","Vector3","Euler","deltaTime"],"mappings":"uMA+BO,IAAMA,CAAAA,CAAuB,CAAC,CACnC,MAAA,CAAAC,CAAAA,CACA,MAAA,CAAAC,CACF,IAAiC,CAE/B,IAAMC,GAAAA,CAAkBC,CAAAA,EAAmB,CAErC,CAACC,CAAAA,CAAQC,CAAAA,CAASC,EAAiBC,CAAAA,CAAcC,CAAc,CAAA,CAAI,CACvEN,IAAgB,GAAA,CAAI,QAAQ,CAAA,CAC5BA,GAAAA,CAAgB,IAAI,sBAAsB,CAAA,CAC1CA,GAAAA,CAAgB,GAAA,CAAI,iBAAiB,CAAA,CACrCA,GAAAA,CAAgB,GAAA,CAAI,cAAc,CAAA,CAClCA,GAAAA,CAAgB,GAAA,CAAI,uBAAuB,CAC7C,CAAA,CAGIO,CAAAA,CAAiC,CACnC,MAAA,CAAQC,IAAoB,CAAE,MAAA,CAAQF,CAAAA,CAAe,GAAA,CAAI,QAAQ,CAAG,CAAC,CAAA,CACrE,OAAQG,GAAAA,CAAa,CACnB,SAAA,CAAWX,CAAAA,CACX,aAAcO,CAAAA,CACd,OAAA,CAASF,CACX,CAAC,EACD,MAAA,CAAQO,GAAAA,CAAa,CACnB,MAAA,CAAQJ,CAAAA,CAAe,GAAA,CAAI,QAAQ,CAAA,CACnC,OAAQJ,CAAAA,CACR,UAAA,CAAYH,CAAAA,CACZ,OAAA,CAASI,CACX,CAAC,CAEH,EAGIQ,CAAAA,CAAiC,IAAA,CAIjCC,CAAAA,CAAoC,IAAA,CACpCC,CAAAA,CAAqB,MAsEzB,OAAO,CACL,KAAA,CA/CY,IAAM,CACdA,GAAa,CAACN,CAAAA,GAElBL,CAAAA,CAAO,OAAA,CAAQ,CAAE,MAAA,CAAQ,iBAAkB,CAAC,CAAA,CAC5CS,CAAAA,CAAQ,CACN,MAAA,CAAQ,CACN,SAAU,IAAIG,OAAAA,CAAQ,CAAA,CAAG,CAAA,CAAG,CAAC,CAAA,CAC7B,QAAA,CAAU,IAAIC,KAAAA,CAAM,EAAG,CAAA,CAAG,CAAC,CAAA,CAC3B,aAAA,CAAe,CAAE,GAAA,CAAK,CAAA,CAAG,KAAA,CAAO,CAAE,CACpC,CACF,CAAA,CAGAH,CAAAA,CAAOT,EAAQ,UAAA,CAAW,OAAO,CAAA,CAAE,QAAA,CAASJ,EAAO,SAAS,CAAA,EAAK,IAAA,CAEjEQ,CAAAA,CAAW,MAAA,CAAO,KAAA,EAAM,CACxBA,CAAAA,CAAW,OAAO,KAAA,EAAM,CACxBA,CAAAA,CAAW,MAAA,CAAO,OAAM,CAExBM,CAAAA,CAAY,IAAA,EACd,CAAA,CA4BE,OA1BcG,CAAAA,EAAsB,CAChC,CAACH,CAAAA,EAAa,CAACN,CAAAA,EAAc,CAACI,CAAAA,GAClCL,EAAe,GAAA,CAAI,OAAO,CAAA,CAAG,MAAA,GAC7BK,CAAAA,CAAM,MAAA,CAASJ,CAAAA,CAAW,MAAA,CAAO,OAAOS,CAAS,CAAA,CACjDT,CAAAA,CAAW,MAAA,CAAO,MAAA,CAAO,CACvB,cAAA,CAAgBI,CAAAA,CAAM,OAAO,QAAA,CAC7B,aAAA,CAAeA,CAAAA,CAAM,MAAA,CAAO,aAC9B,CAAC,CAAA,EAGH,CAAA,CAiBE,OAAA,CAfc,IAAM,CAChB,CAACE,CAAAA,EAAa,CAACN,CAAAA,GAEnBL,CAAAA,CAAO,SAAA,CAAU,CAAE,OAAQ,iBAAkB,CAAC,CAAA,CAE9CK,CAAAA,CAAW,OAAO,OAAA,EAAQ,CAC1BA,CAAAA,CAAW,MAAA,CAAO,SAAQ,CAE1BA,CAAAA,CAAa,IAAA,CACbK,CAAAA,CAAO,IAAA,EACT,CAAA,CAME,SAAA,CAxEe,IAAM,CACjB,CAACA,CAAAA,EAAQ,CAACL,CAAAA,GACdK,EAAK,MAAA,CAAO,OAAA,CAAU,IAAA,CACtBN,CAAAA,CAAe,IAAI,OAAO,CAAA,CAAG,OAAA,CAAU,KAAA,CAEvCC,CAAAA,CAAW,MAAA,CAAO,QAAA,EAAS,CAC3BA,EAAW,MAAA,CAAO,QAAA,EAAS,CAC3BA,CAAAA,CAAW,OAAO,QAAA,EAAS,CAE3BL,CAAAA,CAAO,UAAA,CAAW,CAAE,MAAA,CAAQ,iBAAkB,CAAC,CAAA,EACjD,CAAA,CA+DE,WAAA,CA7DiB,IAAM,CACnB,CAACU,CAAAA,EAAQ,CAACL,CAAAA,GACdK,CAAAA,CAAK,OAAO,OAAA,CAAU,KAAA,CAEtBL,CAAAA,CAAW,MAAA,CAAO,YAAW,CAC7BA,CAAAA,CAAW,MAAA,CAAO,UAAA,EAAW,CAC7BA,CAAAA,CAAW,MAAA,CAAO,UAAA,GAClBL,CAAAA,CAAO,YAAA,CAAa,CAAE,MAAA,CAAQ,iBAAkB,CAAC,CAAA,EACnD,CAAA,CAsDE,QAAA,CAAU,KACZ,CACF","file":"chunk-ZDMMGP6J.js","sourcesContent":["import { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { InputManager } from \"engine/managers/InputManager\";\nimport { Euler, Vector3 } from \"three\";\nimport { ModelIdentifier, Room } from \"types/rooms.types\";\nimport { ObjectStorageUnit } from \"types/storage.types\";\nimport { CameraManager, createCameraManager } from \"./camera\";\nimport { createGround, Ground } from \"./ground\";\nimport { createPlayer, Player } from \"./player\";\n\nexport interface NavigationRoomProps {\n  player: ModelIdentifier;\n  ground: ModelIdentifier;\n}\n\ninterface Entities {\n  player: Player;\n  ground: Ground;\n  camera: CameraManager;\n  inputs: InputManager;\n}\n\ninterface InternalState {\n  player: {\n    position: Vector3;\n    rotation: Euler;\n    rotationDelta: { yaw: number; pitch: number };\n  };\n}\n\ninterface TempData {}\n\nexport const createNavigationRoom = ({\n  player,\n  ground,\n}: NavigationRoomProps): Room => {\n  //External dependencies\n  const serviceRegistry = getServiceRegistry();\n\n  const [logger, storage, eventBusManager, InputManager, contextManager] = [\n    serviceRegistry.get(\"Logger\"),\n    serviceRegistry.get(\"GlobalStorageManager\"),\n    serviceRegistry.get(\"EventBusManager\"),\n    serviceRegistry.get(\"InputManager\"),\n    serviceRegistry.get(\"ThreeJSContextManager\"),\n  ];\n\n  //Internal\n  let components: Nullable<Entities> = {\n    camera: createCameraManager({ camera: contextManager.get(\"camera\")! }),\n    player: createPlayer({\n      reference: player,\n      InputManager: InputManager,\n      storage: storage,\n    }),\n    ground: createGround({\n      camera: contextManager.get(\"camera\")!,\n      logger: logger,\n      references: ground,\n      storage: storage,\n    }),\n    inputs: InputManager,\n  };\n\n  //TODO:no idea on what to add yet\n  let state: Nullable<InternalState> = null;\n  //TODO: no idea what temporary data to add yet\n  let tempData: Nullable<TempData> = null;\n\n  let room: Nullable<ObjectStorageUnit> = null;\n  let isMounted: boolean = false;\n\n  const activate = () => {\n    if (!room || !components) return;\n    room.groups.visible = true;\n    contextManager.get(\"orbit\")!.enabled = false;\n\n    components.camera.activate();\n    components.ground.activate();\n    components.player.activate();\n\n    logger.onActivate({ origin: \"Navigation-Room\" });\n  };\n\n  const deactivate = () => {\n    if (!room || !components) return;\n    room.groups.visible = false;\n\n    components.camera.deactivate();\n    components.ground.deactivate();\n    components.player.deactivate();\n    logger.onDeactivate({ origin: \"Navigation-Room\" });\n  };\n\n  const mount = () => {\n    if (isMounted || !components) return;\n\n    logger.onMount({ origin: \"Navigation Room\" });\n    state = {\n      player: {\n        position: new Vector3(0, 0, 0),\n        rotation: new Euler(0, 0, 0),\n        rotationDelta: { yaw: 0, pitch: 0 },\n      },\n    };\n\n    //get base root i.e group so that it can be used to toggle visibility\n    room = storage.getStorage(\"model\").retrieve(ground.storageId) ?? null;\n\n    components.player.mount();\n    components.ground.mount();\n    components.camera.mount();\n\n    isMounted = true;\n  };\n\n  const update = (deltaTime: number) => {\n    if (!isMounted || !components || !state) return;\n    contextManager.get(\"orbit\")!.update();\n    state.player = components.player.update(deltaTime);\n    components.camera.update({\n      playerPosition: state.player.position,\n      rotationDelta: state.player.rotationDelta,\n    });\n\n    //entities.ground.update();\n  };\n\n  const unmount = () => {\n    if (!isMounted || !components) return;\n\n    logger.onUnmount({ origin: \"Navigation Room\" });\n\n    components.player.unmount();\n    components.ground.unmount();\n\n    components = null;\n    room = null;\n  };\n\n  return {\n    mount: mount,\n    update: update,\n    unmount: unmount,\n    setActive: activate,\n    setDeactive: deactivate,\n    isLoaded: false,\n  };\n};\n"]}