{"version":3,"sources":["../src/plugins/loader/hdr_loader.ts"],"names":["createHDRLoader","loadingManager","renderer","scene","pmremGenerator","PMREMGenerator","rgbeLoader","RGBELoader","_loadHDRTexture","metaData","reject","resolve","data","texData","envMap","err","load","assets","promises","asset"],"mappings":"qGAwBO,IAAMA,CAAAA,CAAkB,CAAC,CAC9B,cAAA,CAAAC,CAAAA,CACA,SAAAC,CAAAA,CACA,KAAA,CAAAC,CACF,CAAA,GAA2C,CACzC,IAAMC,CAAAA,CAAiC,IAAIC,cAAAA,CAAeH,CAAQ,CAAA,CAC5DI,CAAAA,CAAyB,IAAIC,UAAAA,CAAWN,CAAc,CAAA,CAMtDO,CAAAA,CAAkB,MACtBC,CAAAA,EAEO,IAAI,OAAA,CAAQ,CAACC,CAAAA,CAAQC,CAAAA,GAAY,CACtC,OAAA,CAAQ,GAAA,CAAI,MAAA,CAAQF,CAAAA,CAAS,IAAI,CAAA,CACjCH,CAAAA,CAAW,IAAA,CACTG,CAAAA,CAAS,IAAA,CACT,CAACG,CAAAA,CAAmBC,CAAAA,GAAoB,CACtC,IAAMC,CAAAA,CAASV,CAAAA,CAAe,mBAAA,CAAoBQ,CAAI,EAAE,OAAA,CACxDA,CAAAA,CAAK,OAAA,EAAQ,CACbT,CAAAA,CAAM,WAAA,CAAcW,CAAAA,CACpBH,CAAAA,GACF,CAAA,CACA,MAAA,CACCI,CAAAA,EAAQ,CACPL,CAAAA,GACF,CACF,EACF,CAAC,CAAA,CAGGM,CAAAA,CAAO,MAAOC,CAAAA,EAAmC,CACrD,IAAMC,CAAAA,CAA4B,EAAC,CAEnCD,CAAAA,CAAO,OAAA,CAAQ,MAAOE,CAAAA,EAAU,CAC9BD,CAAAA,CAAS,IAAA,CAAKV,CAAAA,CAAgBW,CAAK,CAAC,EACtC,CAAC,CAAA,CAED,MAAM,OAAA,CAAQ,UAAA,CAAWD,CAAQ,EACnC,CAAA,CAMA,OAAO,CACL,IAAA,CAAMF,CACR,CACF","file":"chunk-MI6KVUH7.js","sourcesContent":["import { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport {\n  DataTexture,\n  LoadingManager,\n  PMREMGenerator,\n  Scene,\n  WebGLRenderer,\n} from \"three\";\nimport { RGBELoader } from \"three/examples/jsm/loaders/RGBELoader.js\";\nimport { ModelAssetDescriptor } from \"types/loader.types\";\nimport { LoaderPlugin } from \"types/plugin.types\";\n\nexport interface HDRTextureLoaderProps {\n  scene: Scene;\n  renderer: WebGLRenderer;\n  loadingManager: LoadingManager;\n  storageManager: GlobalStorageManager;\n}\n\n/**\n * @description loads .hdr files and illuminates scene\n * @param props hdr loading properties\n * @returns HDR loader plugin\n */\nexport const createHDRLoader = ({\n  loadingManager,\n  renderer,\n  scene,\n}: HDRTextureLoaderProps): LoaderPlugin => {\n  const pmremGenerator: PMREMGenerator = new PMREMGenerator(renderer);\n  const rgbeLoader: RGBELoader = new RGBELoader(loadingManager);\n\n  /**\n   * @description loads a hdr file\n   * @param metaData meta-data for loading hdr\n   */\n  const _loadHDRTexture = async (\n    metaData: ModelAssetDescriptor\n  ): Promise<void> => {\n    return new Promise((reject, resolve) => {\n      console.log(\"path\", metaData.path);\n      rgbeLoader.load(\n        metaData.path,\n        (data: DataTexture, texData: object) => {\n          const envMap = pmremGenerator.fromEquirectangular(data).texture;\n          data.dispose();\n          scene.environment = envMap;\n          resolve();\n        },\n        undefined,\n        (err) => {\n          reject();\n        }\n      );\n    });\n  };\n\n  const load = async (assets: ModelAssetDescriptor[]) => {\n    const promises: Promise<void>[] = [];\n\n    assets.forEach(async (asset) => {\n      promises.push(_loadHDRTexture(asset));\n    });\n\n    await Promise.allSettled(promises);\n  };\n\n  const dispose = () => {\n    pmremGenerator.dispose();\n  };\n\n  return {\n    load: load,\n  };\n};\n"]}