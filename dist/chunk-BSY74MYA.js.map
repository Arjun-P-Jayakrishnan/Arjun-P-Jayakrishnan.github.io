{"version":3,"sources":["../src/engine/managers/ThreeJsManager.ts"],"names":["createThreeJsInstance","props","fov","aspectRatio","near","far","DEFAULT_CAMERA_OPTIONS","scene","Scene","camera","PerspectiveCamera","renderer","WebGLRenderer","orbit","animationCallback","animationFrameId","contextManager","getServiceRegistry","logger","mountRendererToDom","elementId","container","OrbitControls","exposeToContext","queueStep","callback","loop"],"mappings":"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","file":"chunk-BSY74MYA.js","sourcesContent":["import { queueStep } from \"@utils/dsl\";\nimport { DEFAULT_CAMERA_OPTIONS } from \"config/constants\";\nimport { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { PerspectiveCamera, Scene, WebGLRenderer } from \"three\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls.js\";\nimport { Lifecycle } from \"types/lifecycle.types\";\n\nexport interface ThreeJSRenderOptions {\n  /** Dom element id where the render will be mounted */\n  domMountId: string;\n}\n\nexport interface ThreeJsRenderer\n  extends Lifecycle<[], [loop: () => void], [], [], []> {}\n\nexport const createThreeJsInstance = (\n  props: ThreeJSRenderOptions\n): ThreeJsRenderer => {\n  //Local references\n  const { fov, aspectRatio, near, far } = DEFAULT_CAMERA_OPTIONS;\n\n  //=====Core Elements======\n  let scene: Scene = new Scene();\n  let camera: PerspectiveCamera = new PerspectiveCamera(\n    fov,\n    aspectRatio,\n    near,\n    far\n  );\n  let renderer: WebGLRenderer = new WebGLRenderer({ antialias: true });\n  let orbit: OrbitControls;\n\n  // State\n  let animationCallback: Nullable<() => void> = null;\n  let animationFrameId: Nullable<number> = null;\n\n  //External Context Hook\n  const contextManager = getServiceRegistry().get(\"ThreeJSContextManager\");\n  const logger = getServiceRegistry().get(\"Logger\");\n\n  //Internal Methods\n  const mountRendererToDom = (elementId: string): void => {\n    const container = document.getElementById(elementId);\n\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    renderer.setPixelRatio(window.devicePixelRatio);\n\n    if (container) {\n      container.appendChild(renderer.domElement);\n      orbit = new OrbitControls(camera, renderer.domElement);\n    } else {\n      console.warn(`Could not find element with selector tag : ${elementId}`);\n    }\n  };\n\n  /**\n   * Mount the context_manager to allow reference to scene and other props externally\n   */\n  const exposeToContext = (): void => {\n    contextManager.set(\"scene\", scene);\n    contextManager.set(\"camera\", camera);\n    contextManager.set(\"orbit\", orbit);\n    contextManager.set(\"renderer\", renderer);\n  };\n\n  const onLoad = () => {\n    return [\n      queueStep(mountRendererToDom, props.domMountId),\n      queueStep(exposeToContext),\n      queueStep(logger.onLoad, { origin: \"ThreeJs-Manager\" }),\n    ];\n  };\n\n  const onMount = (callback: () => void) => {\n    return [\n      () => {\n        animationCallback = callback;\n      },\n      queueStep(logger.onMount, { origin: \"ThreeJs-Manager\" }),\n    ];\n  };\n\n  const render = () => {\n    if (animationFrameId !== null) return; //prevent multiple render loops\n\n    const loop = () => {\n      //Recursive callback function\n      animationFrameId = requestAnimationFrame(loop);\n      animationCallback?.();\n      renderer.render(scene, camera);\n    };\n\n    loop();\n  };\n\n  const onUnmount = () => {\n    const container = document.getElementById(props.domMountId);\n    if (animationFrameId !== null) {\n      cancelAnimationFrame(animationFrameId);\n      animationFrameId = 0;\n    }\n    if (container && renderer.domElement.parentElement === container) {\n      container.removeChild(renderer.domElement);\n    }\n\n    renderer.dispose();\n    logger.onUnmount({ origin: \"ThreeJs-Manager\" });\n  };\n\n  return {\n    onLoad: onLoad,\n    onMount: onMount,\n    onUpdate: render,\n    onUnmount: onUnmount,\n    onDestroy: () => {},\n  };\n};\n"]}