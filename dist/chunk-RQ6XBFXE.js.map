{"version":3,"sources":["../src/gameplay/rooms/navigation/camera.ts"],"names":["TPV_CONFIG","tempPosition","Vector3","tempOffset","tempLookTarget","clampRotation","yaw","pitch","MathUtils","computeThirdPersonOffset","spherical","lerpVector","from","to","alpha","createCameraManager","camera","state","Spherical","setCamera","mode","mount","activate","updateRotation","delta","clamped","updateThirdPerson","info","updateFirstPerson","playerPos"],"mappings":"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","file":"chunk-RQ6XBFXE.js","sourcesContent":["import { Euler, MathUtils, PerspectiveCamera, Spherical, Vector3 } from \"three\";\nimport { GenericLifeCycle } from \"types/rooms.types\";\n\nexport type CameraMode = \"firstPerson\" | \"thirdPerson\";\n\nexport interface CameraProps {\n  /**Main Camera */\n  camera: PerspectiveCamera;\n}\n\n/** Contains the Updated info about player */\nexport type UpdatedInfo = {\n  playerPosition: Vector3;\n  rotationDelta: { yaw: number; pitch: number };\n};\n\n/** Controls to manage camera */\nexport interface CameraManager extends GenericLifeCycle {\n  /** Updates the camera to look the player */\n  update: (info: UpdatedInfo) => { rotation: Euler };\n\n  /**sets the mode of camera */\n  setMode: (mode: CameraMode) => void;\n}\n\n//Third Person Config\nconst TPV_CONFIG = {\n  DISTANCE: 3,\n  HEIGHT_OFFSET: 2,\n  PITCH_MIN: 0,\n  PITH_MAX: Math.PI / 2,\n  SMOOTHING: 0.1,\n} as const;\n\n//Temporary Variables\n\nlet tempPosition = new Vector3(0, 0, 0);\nlet tempOffset = new Vector3(0, 0, 0);\nlet tempLookTarget = new Vector3(0, 0, 0);\n\n/**\n *\n * @param yaw the yaw angle\n * @param pitch the pitch angle\n * @returns restricted angles\n */\nfunction clampRotation(\n  yaw: number,\n  pitch: number\n): { yaw: number; pitch: number } {\n  return {\n    yaw: MathUtils.euclideanModulo(yaw, Math.PI * 2),\n    pitch: MathUtils.clamp(pitch, TPV_CONFIG.PITCH_MIN, TPV_CONFIG.PITH_MAX),\n  };\n}\n\n/**\n *\n * @param spherical the spherical coordinates\n * @returns the Vector based on spherical coordinates\n */\nfunction computeThirdPersonOffset(spherical: Spherical): Vector3 {\n  tempOffset.set(0, 0, 0);\n  tempOffset.setFromSpherical(spherical);\n  tempOffset.y += TPV_CONFIG.HEIGHT_OFFSET;\n\n  return tempOffset;\n}\n\n/**\n * Smoothly interpolate value between from and to vectors based on alpha\n */\nfunction lerpVector(from: Vector3, to: Vector3, alpha: number) {\n  return from.lerp(to, alpha);\n}\n\ninterface InternalState {\n  mode: CameraMode;\n  rotation: { yaw: number; pitch: number };\n  spherical: Spherical;\n}\n\nexport const createCameraManager = ({ camera }: CameraProps): CameraManager => {\n  let isThirdPerson: boolean = true;\n  let state: InternalState = {\n    mode: \"thirdPerson\",\n    rotation: { pitch: Math.PI / 2, yaw: 0 },\n    spherical: new Spherical(TPV_CONFIG.DISTANCE, Math.PI / 2, 0),\n  };\n\n  const setCamera = (mode: CameraMode) => {\n    state.mode = mode;\n  };\n\n  const mount = () => {};\n\n  const activate = () => {\n    camera.position.set(0, 2, 2);\n    console.log(\"nav camera position activation\", camera.position);\n  };\n\n  /**\n   *\n   * @param yaw\n   * @param pitch\n   */\n  const updateRotation = (delta: { yaw: number; pitch: number }) => {\n    state.rotation.yaw += delta.yaw;\n    state.rotation.pitch += delta.pitch;\n\n    const clamped = clampRotation(state.rotation.yaw, state.rotation.pitch);\n    state.rotation.yaw = clamped.yaw;\n    state.rotation.pitch = clamped.pitch;\n  };\n\n  const updateThirdPerson = (info: UpdatedInfo) => {\n    state.spherical.theta = state.rotation.yaw;\n    state.spherical.phi = state.rotation.pitch;\n\n    //Calculate offset\n    tempOffset.copy(computeThirdPersonOffset(state.spherical));\n\n    //Calculate target position and camera lerp smoothly\n    tempPosition.copy(info.playerPosition).add(tempOffset);\n    camera.position.copy(\n      lerpVector(camera.position, tempPosition, TPV_CONFIG.SMOOTHING)\n    );\n\n    tempLookTarget.copy(info.playerPosition);\n    tempLookTarget.y += TPV_CONFIG.HEIGHT_OFFSET;\n    camera.lookAt(tempLookTarget);\n  };\n\n  const updateFirstPerson = (playerPos: Vector3) => {\n    camera.position.copy(playerPos);\n    camera.rotation.set(state.rotation.pitch, state.rotation.yaw, 0);\n  };\n\n  const update = (info: UpdatedInfo): { rotation: Euler } => {\n    updateRotation(info.rotationDelta);\n\n    if (state.mode === \"thirdPerson\") {\n      updateThirdPerson(info);\n    } else {\n      updateFirstPerson(info.playerPosition);\n    }\n\n    return {\n      rotation: camera.rotation,\n    };\n  };\n\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    setMode: setCamera,\n    update: update,\n    mount: mount,\n    activate: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n"]}