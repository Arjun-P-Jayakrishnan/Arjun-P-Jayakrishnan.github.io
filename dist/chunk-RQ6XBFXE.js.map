{"version":3,"sources":["../src/gameplay/rooms/navigation/camera.ts"],"names":["TPV_CONFIG","tempPosition","Vector3","tempOffset","tempLookTarget","clampRotation","yaw","pitch","MathUtils","computeThirdPersonOffset","spherical","lerpVector","from","to","alpha","createCameraManager","camera","state","Spherical","setCamera","mode","mount","activate","updateRotation","delta","clamped","updateThirdPerson","info","updateFirstPerson","playerPos"],"mappings":"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","file":"chunk-RQ6XBFXE.js","sourcesContent":["import { Euler, MathUtils, PerspectiveCamera, Spherical, Vector3 } from \"three\";\nimport { GenericLifeCycle } from \"types/rooms.types\";\n\nexport type CameraMode = \"firstPerson\" | \"thirdPerson\";\n\nexport interface CameraProps {\n  /**Main Camera */\n  camera: PerspectiveCamera;\n}\n\n/** Contains the Updated info about player */\nexport type UpdatedInfo = {\n  playerPosition: Vector3;\n  rotationDelta: { yaw: number; pitch: number };\n};\n\n/** Controls to manage camera */\nexport interface CameraManager extends GenericLifeCycle {\n  /** Updates the camera to look the player */\n  update: (info: UpdatedInfo) => { rotation: Euler };\n\n  /**sets the mode of camera */\n  setMode: (mode: CameraMode) => void;\n}\n\n//Third Person Config\nconst TPV_CONFIG = {\n  DISTANCE: 3,\n  HEIGHT_OFFSET: 2,\n  PITCH_MIN: 0,\n  PITH_MAX: Math.PI / 2,\n  SMOOTHING: 0.1,\n} as const;\n\n//Temporary Variables\n\nlet tempPosition = new Vector3(0, 0, 0);\nlet tempOffset = new Vector3(0, 0, 0);\nlet tempLookTarget = new Vector3(0, 0, 0);\n\n/**\n *\n * @param yaw the yaw angle\n * @param pitch the pitch angle\n * @returns restricted angles\n */\nfunction clampRotation(\n  yaw: number,\n  pitch: number\n): { yaw: number; pitch: number } {\n  return {\n    yaw: MathUtils.euclideanModulo(yaw, Math.PI * 2),\n    pitch: MathUtils.clamp(pitch, TPV_CONFIG.PITCH_MIN, TPV_CONFIG.PITH_MAX),\n  };\n}\n\n/**\n *\n * @param spherical the spherical coordinates\n * @returns the Vector based on spherical coordinates\n */\nfunction computeThirdPersonOffset(spherical: Spherical): Vector3 {\n  tempOffset.set(0, 0, 0);\n  tempOffset.setFromSpherical(spherical);\n  tempOffset.y += TPV_CONFIG.HEIGHT_OFFSET;\n\n  return tempOffset;\n}\n\n/**\n * Smoothly interpolate value between from and to vectors based on alpha\n */\nfunction lerpVector(from: Vector3, to: Vector3, alpha: number) {\n  return from.lerp(to, alpha);\n}\n\ninterface InternalState {\n  mode: CameraMode;\n  rotation: { yaw: number; pitch: number };\n  spherical: Spherical;\n}\n\nexport const createCameraManager = ({ camera }: CameraProps): CameraManager => {\n  let isThirdPerson: boolean = true;\n  let state: InternalState = {\n    mode: \"thirdPerson\",\n    rotation: { pitch: Math.PI / 2, yaw: 0 },\n    spherical: new Spherical(TPV_CONFIG.DISTANCE, Math.PI / 2, 0),\n  };\n\n  const setCamera = (mode: CameraMode) => {\n    state.mode = mode;\n  };\n\n  const mount = () => {};\n\n  const activate = () => {\n    camera.position.set(0, 2, 2);\n    console.log(\"nav camera position activation\", camera.position);\n  };\n\n  /**\n   *\n   * @param yaw\n   * @param pitch\n   */\n  const updateRotation = (delta: { yaw: number; pitch: number }) => {\n    state.rotation.yaw += delta.yaw;\n    state.rotation.pitch += delta.pitch;\n\n    const clamped = clampRotation(state.rotation.yaw, state.rotation.pitch);\n    state.rotation.yaw = clamped.yaw;\n    state.rotation.pitch = clamped.pitch;\n  };\n\n  const updateThirdPerson = (info: UpdatedInfo) => {\n    state.spherical.theta = state.rotation.yaw;\n    state.spherical.phi = state.rotation.pitch;\n\n    //Calculate offset\n    tempOffset.copy(computeThirdPersonOffset(state.spherical));\n\n    //Calculate target position and camera lerp smoothly\n    tempPosition.copy(info.playerPosition).add(tempOffset);\n    camera.position.copy(\n      lerpVector(camera.position, tempPosition, TPV_CONFIG.SMOOTHING)\n    );\n\n    tempLookTarget.copy(info.playerPosition);\n    tempLookTarget.y += TPV_CONFIG.HEIGHT_OFFSET;\n    camera.lookAt(tempLookTarget);\n  };\n\n  const updateFirstPerson = (playerPos: Vector3) => {\n    camera.position.copy(playerPos);\n    camera.rotation.set(state.rotation.pitch, state.rotation.yaw, 0);\n  };\n\n  const update = (info: UpdatedInfo): { rotation: Euler } => {\n    updateRotation(info.rotationDelta);\n\n    if (state.mode === \"thirdPerson\") {\n      updateThirdPerson(info);\n    } else {\n      updateFirstPerson(info.playerPosition);\n    }\n\n    return {\n      rotation: camera.rotation,\n    };\n  };\n\n  const deactivate = () => {};\n\n  const unmount = () => {};\n\n  return {\n    setMode: setCamera,\n    update: update,\n    mount: mount,\n    activate: activate,\n    deactivate: deactivate,\n    unmount: unmount,\n  };\n};\n"]}