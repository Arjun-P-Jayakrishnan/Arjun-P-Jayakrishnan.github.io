{"version":3,"sources":["../src/gameplay/player/playerAnimationEntity.ts"],"names":["createPlayerAnimationEntity","id","animations","playerObject","params","createAnimationParameters","fsm","AnimationFSM","p","getClipByName","name","c","graph","AnimationGraph","animationUnit","createAnimationUnit","playback","PlaybackManager"],"mappings":"gNAkBO,IAAMA,CAAAA,CAA8B,CAAC,CAC1C,EAAA,CAAAC,EACA,UAAA,CAAAC,CAAAA,CACA,YAAA,CAAAC,CACF,CAAA,GASM,CAKJ,IAAMC,CAAAA,CAASC,CAAAA,CAA0B,CACvC,CAAE,IAAA,CAAM,QAAS,IAAA,CAAM,OAAA,CAAS,YAAA,CAAc,CAAE,CAAA,CAChD,CAAE,KAAM,UAAA,CAAY,IAAA,CAAM,OAAQ,YAAA,CAAc,KAAM,CACxD,CAAC,CAAA,CAOKC,CAAAA,CAAM,IAAIC,GAAAA,CAAa,MAAA,CAAQ,CACnC,CACE,IAAA,CAAM,MAAA,CACN,WAAA,CAAa,CACX,CACE,GAAI,MAAA,CACJ,SAAA,CAAYC,CAAAA,EAAMA,CAAAA,CAAE,GAAA,CAAI,UAAU,IAAM,IAC1C,CACF,CACF,CAAA,CACA,CACE,KAAM,MAAA,CACN,WAAA,CAAa,CACX,CACE,EAAA,CAAI,KAAA,CACJ,UAAYA,CAAAA,EAAMA,CAAAA,CAAE,GAAA,CAAI,WAAW,CAAA,GAAM,IAC3C,EACA,CACE,EAAA,CAAI,MAAA,CACJ,SAAA,CAAYA,CAAAA,EAAMA,CAAAA,CAAE,IAAI,UAAU,CAAA,GAAM,KAC1C,CACF,CACF,EACA,CACE,IAAA,CAAM,KAAA,CACN,WAAA,CAAa,CACX,CACE,GAAI,MAAA,CACJ,SAAA,CAAYA,CAAAA,EAAMA,CAAAA,CAAE,GAAA,CAAI,WAAW,IAAM,KAC3C,CAAA,CACA,CACE,EAAA,CAAI,MAAA,CACJ,SAAA,CAAYA,GAAMA,CAAAA,CAAE,GAAA,CAAI,UAAU,CAAA,GAAM,KAC1C,CACF,CACF,CACF,CAAC,CAAA,CAEKC,CAAAA,CAAiBC,CAAAA,EACrBR,EAAW,IAAA,CAAMS,CAAAA,EAAMA,EAAE,IAAA,CAAK,WAAA,KAAkBD,CAAAA,CAAK,WAAA,EAAa,CAAA,CAO9DE,CAAAA,CAAQ,IAAIC,IAAe,CAC/B,CACE,KAAM,MAAA,CACN,IAAA,CAAMJ,EAAc,MAAM,CAC5B,CAAA,CACA,CACE,IAAA,CAAM,MAAA,CACN,KAAMA,CAAAA,CAAc,MAAM,CAAA,CAC1B,KAAA,CAAQL,CAAAA,EAAW,IAAA,CAAK,IAAKA,CAAAA,CAAO,GAAA,CAAI,OAAO,CAAA,CAAe,EAAA,CAAK,CAAC,CACtE,CAAA,CACA,CACE,KAAM,KAAA,CACN,IAAA,CAAMK,EAAc,KAAK,CAAA,CACzB,KAAA,CAAQL,CAAAA,EACN,IAAA,CAAK,GAAA,CAAA,CAAMA,EAAO,GAAA,CAAI,OAAO,CAAA,CAAe,EAAA,EAAO,EAAA,CAAK,CAAC,CAC7D,CACF,CAAC,CAAA,CAQKU,CAAAA,CAAgBC,GAAAA,CAAoB,CACxC,KAAMZ,CAAAA,CACN,KAAA,CAAOD,EACP,iBAAA,CAAmB,EACrB,CAAC,CAAA,CAMKc,CAAAA,CAAW,IAAIC,GAAAA,CAAgBH,CAAa,CAAA,CAKlD,OAAO,CACL,EAAA,CAAAb,CAAAA,CACA,MAAA,CAAAG,CAAAA,CACA,GAAA,CAAAE,EACA,KAAA,CAAAM,CAAAA,CACA,QAAA,CAAAI,CACF,CACF","file":"chunk-B7RRG4QY.js","sourcesContent":["import { createAnimationUnit } from \"engine/managers/animation/AnimationUnit\";\nimport { AnimationFSM } from \"engine/managers/animation/FSM\";\nimport { AnimationGraph } from \"engine/managers/animation/GraphRuntime\";\nimport { createAnimationParameters } from \"engine/managers/animation/Parameters\";\nimport { PlaybackManager } from \"engine/managers/animation/PlaybackManager\";\nimport { AnimationClip, Group, Object3DEventMap } from \"three\";\n\n/**\n * Creates the animation entity for the player.\n *\n * This entity wires together:\n * - Animation parameters (data)\n * - FSM (state logic)\n * - Animation graph (state → clips / blending)\n * - Playback manager (runtime execution)\n *\n * The orchestrator is responsible for updating this entity.\n */\nexport const createPlayerAnimationEntity = ({\n  id,\n  animations,\n  playerObject,\n}: {\n  /** Unique entity ID (used by the AnimationOrchestrator) */\n  id: string;\n\n  /** Root object that owns the AnimationMixer */\n  playerObject: Group<Object3DEventMap>;\n\n  /** Animation clips loaded with the model */\n  animations: AnimationClip[];\n}) => {\n  /**\n   * Runtime animation parameters.\n   * These are written by gameplay systems and read by FSM / graph logic.\n   */\n  const params = createAnimationParameters([\n    { name: \"speed\", type: \"float\", defaultValue: 0 },\n    { name: \"isMoving\", type: \"bool\", defaultValue: false },\n  ]);\n\n  /**\n   * Finite State Machine controlling high-level animation state.\n   *\n   * The FSM itself is logic-only and does not know about clips or playback.\n   */\n  const fsm = new AnimationFSM(\"idle\", [\n    {\n      name: \"idle\",\n      transitions: [\n        {\n          to: \"walk\",\n          condition: (p) => p.get(\"isMoving\") === true,\n        },\n      ],\n    },\n    {\n      name: \"walk\",\n      transitions: [\n        {\n          to: \"run\",\n          condition: (p) => p.get(\"isRunning\") === true,\n        },\n        {\n          to: \"idle\",\n          condition: (p) => p.get(\"isMoving\") === false,\n        },\n      ],\n    },\n    {\n      name: \"run\",\n      transitions: [\n        {\n          to: \"walk\",\n          condition: (p) => p.get(\"isRunning\") === false,\n        },\n        {\n          to: \"idle\",\n          condition: (p) => p.get(\"isMoving\") === false,\n        },\n      ],\n    },\n  ]);\n\n  const getClipByName = (name: string) =>\n    animations.find((c) => c.name.toLowerCase() === name.toLowerCase())!;\n\n  /**\n   * Animation graph mapping FSM states to animation clips.\n   *\n   * Optional blend functions allow parameter-driven weighting.\n   */\n  const graph = new AnimationGraph([\n    {\n      name: \"idle\",\n      clip: getClipByName(\"Idle\"),\n    },\n    {\n      name: \"walk\",\n      clip: getClipByName(\"Walk\"),\n      blend: (params) => Math.min((params.get(\"speed\") as number) / 0.6, 1),\n    },\n    {\n      name: \"run\",\n      clip: getClipByName(\"Run\"),\n      blend: (params) =>\n        Math.min(((params.get(\"speed\") as number) - 0.6) / 0.4, 1),\n    },\n  ]);\n\n  /**\n   * Animation unit responsible for:\n   * - Owning the AnimationMixer\n   * - Creating AnimationActions from clips\n   * - Crossfading and playback control\n   */\n  const animationUnit = createAnimationUnit({\n    root: playerObject,\n    clips: animations,\n    crossfadeDuration: 0.2,\n  });\n\n  /**\n   * Playback manager bridges:\n   * FSM + Graph → AnimationUnit execution\n   */\n  const playback = new PlaybackManager(animationUnit);\n\n  /**\n   * Final animation entity registered into the AnimationOrchestrator.\n   */\n  return {\n    id,\n    params,\n    fsm,\n    graph,\n    playback,\n  };\n};\n"]}