{"version":3,"sources":["../src/fsm/player.ts"],"names":["Idle","props","player","Walk","Run","createFSMController","animationController","controllers","getControllers","keyboard","idle","walk","run","state","currentState","update","deltaTime","playerFSM","isMoving","isShiftPressed","_getState","newState","changeState","mount"],"mappings":"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","file":"chunk-IPOAFFZV.js","sourcesContent":["import {\n  AnimationController,\n  AnimationControllerProps,\n} from \"controllers/animation\";\nimport { getControllers } from \"graphics/mechanics/controllers/controller\";\n\ntype States = \"Idle\" | \"Walk\" | \"Run\";\n\ninterface PlayerFSM {\n  changeState: (state: States) => void;\n  isMoving: () => boolean;\n  isShiftPressed: () => boolean;\n}\n\ninterface StateProps {\n  animationId: string;\n  animationController: AnimationController;\n}\n\ninterface State {\n  enter: (player: PlayerFSM) => void;\n  execute: (player: PlayerFSM) => void;\n  exit: (player: PlayerFSM) => void;\n}\n\nconst Idle = (props: StateProps): State => {\n  const enter = (player: PlayerFSM) => {\n    console.log(\"enter idle\");\n    props.animationController.play(props.animationId);\n  };\n\n  const execute = (player: PlayerFSM) => {\n    if (player.isMoving()) {\n      if (player.isShiftPressed()) {\n        player.changeState(\"Run\");\n      } else {\n        player.changeState(\"Walk\");\n      }\n    }\n  };\n\n  const exit = (player: PlayerFSM) => {\n    console.log(\"exit idle\");\n  };\n\n  return {\n    enter: enter,\n    execute: execute,\n    exit: exit,\n  };\n};\n\nconst Walk = (props: StateProps): State => {\n  const enter = (player: PlayerFSM) => {\n    console.log(\"enter walk\");\n    props.animationController.play(props.animationId);\n  };\n\n  const execute = (player: PlayerFSM) => {\n    if (!player.isMoving()) {\n      player.changeState(\"Idle\");\n    } else if (player.isShiftPressed()) {\n      player.changeState(\"Run\");\n    }\n  };\n\n  const exit = (player: PlayerFSM) => {\n    console.log(\"exit walk\");\n  };\n\n  return {\n    enter: enter,\n    execute: execute,\n    exit: exit,\n  };\n};\n\nconst Run = (props: StateProps): State => {\n  const enter = (player: PlayerFSM) => {\n    console.log(\"enter run\");\n    props.animationController.play(props.animationId);\n  };\n\n  const execute = (player: PlayerFSM) => {\n    if (!player.isMoving()) {\n      player.changeState(\"Idle\");\n    } else if (!player.isShiftPressed()) {\n      player.changeState(\"Walk\");\n    }\n  };\n\n  const exit = (player: PlayerFSM) => {\n    console.log(\"exit run\");\n  };\n\n  return {\n    enter: enter,\n    execute: execute,\n    exit: exit,\n  };\n};\n\nexport interface FSMOptions {\n  animationController: AnimationController;\n}\n\nexport interface FSMController {\n  mount: () => void;\n  update: (deltaTime: number) => void;\n  unmount: () => void;\n}\n\nexport const createFSMController = ({\n  animationController,\n}: FSMOptions): FSMController => {\n  const controllers = getControllers();\n  const { mouse, keyboard } = {\n    mouse: controllers.getController(\"mouse\"),\n    keyboard: controllers.getController(\"keyboard\"),\n  };\n\n  let shiftPressed: boolean;\n  const { idle, walk, run } = {\n    idle: Idle({\n      animationController: animationController,\n      animationId: \"Idle\",\n    }),\n    walk: Walk({\n      animationController: animationController,\n      animationId: \"Walk\",\n    }),\n    run: Run({\n      animationController: animationController,\n      animationId: \"Run\",\n    }),\n  };\n  let state: State = idle;\n  let currentState: States = \"Idle\";\n\n  const update = (deltaTime: number) => {\n    state.execute(playerFSM);\n    animationController.update(deltaTime);\n  };\n\n  const isMoving = () => {\n    if (\n      keyboard?.isKeyPressed(\"w\") ||\n      keyboard?.isKeyPressed(\"a\") ||\n      keyboard?.isKeyPressed(\"s\") ||\n      keyboard?.isKeyPressed(\"d\")\n    ) {\n      return true;\n    }\n\n    return false;\n  };\n\n  const isShiftPressed = () => {\n    return keyboard?.isKeyPressed(\"shift\") ?? false;\n  };\n\n  const _getState = (newState: States) => {\n    switch (newState) {\n      case \"Idle\":\n        return idle;\n      case \"Walk\":\n        return walk;\n      case \"Run\":\n        return run;\n      default:\n        return idle;\n    }\n  };\n\n  const changeState = (newState: States) => {\n    if (currentState !== newState) {\n      currentState = newState;\n      state.exit(playerFSM);\n      state = _getState(newState);\n      state.enter(playerFSM);\n    }\n  };\n\n  const mount = () => {\n    state.enter(playerFSM);\n  };\n\n  const playerFSM: PlayerFSM = {\n    changeState: changeState,\n    isMoving: isMoving,\n    isShiftPressed: isShiftPressed,\n  };\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    update: update,\n    unmount: unmount,\n  };\n};\n"]}