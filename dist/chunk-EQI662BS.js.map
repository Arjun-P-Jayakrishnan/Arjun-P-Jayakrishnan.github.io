{"version":3,"sources":["../src/graphics/gameplay/player.ts"],"sourcesContent":["import { getGlobalContext } from \"@utils/globalContext\";\r\nimport { AnimationMixer, Object3D, Scene } from \"three\";\r\n\r\nexport interface PlayerProps {\r\n  ids: {\r\n    rootMesh: string;\r\n  };\r\n}\r\n\r\nexport interface PlayerContext {\r\n  scene: Scene;\r\n}\r\n\r\nexport interface Player {\r\n  create: () => void;\r\n  update: (deltaTime: number) => void;\r\n  destroy: () => void;\r\n}\r\n\r\ninterface ObjectReferences {\r\n  playerRoot: Object3D;\r\n}\r\n\r\nexport const createPlayer = (\r\n  props: PlayerProps,\r\n  context: PlayerContext\r\n): Player => {\r\n  const { scene } = context;\r\n  const { eventBusManager, globalState, globalStorage } = getGlobalContext();\r\n  let objects: ObjectReferences;\r\n  let mixer: AnimationMixer | null;\r\n\r\n  const create = () => {\r\n    try {\r\n      const playerRoot = scene.getObjectByName(props.ids.rootMesh) as Object3D;\r\n\r\n      if (!playerRoot) {\r\n        throw new Error(`Player doesn't exist`);\r\n      }\r\n\r\n      mixer = new AnimationMixer(playerRoot);\r\n      const animations = globalStorage\r\n        .getStorage(\"animations\")\r\n        .retrieve(\"Room\");\r\n      //Local References\r\n      objects = {\r\n        playerRoot: playerRoot,\r\n      };\r\n    } catch (err) {\r\n      console.error(`Player mesh cant be obtained :${err}`);\r\n    }\r\n  };\r\n\r\n  const update = (deltaTime: number) => {\r\n    if (mixer) {\r\n      mixer.update(deltaTime);\r\n    }\r\n  };\r\n\r\n  const destroy = () => {\r\n    try {\r\n      objects.playerRoot.clear();\r\n    } catch (err) {\r\n      console.error(`Error while destroy player ${err}`);\r\n    }\r\n  };\r\n\r\n  return {\r\n    create: create,\r\n    update: update,\r\n    destroy: destroy,\r\n  };\r\n};\r\n"],"mappings":";;;;;AACA,SAAS,sBAAuC;AAsBzC,IAAM,eAAe,CAC1B,OACA,YACW;AACX,QAAM,EAAE,MAAM,IAAI;AAClB,QAAM,EAAE,iBAAiB,aAAa,cAAc,IAAI,iBAAiB;AACzE,MAAI;AACJ,MAAI;AAEJ,QAAM,SAAS,MAAM;AACnB,QAAI;AACF,YAAM,aAAa,MAAM,gBAAgB,MAAM,IAAI,QAAQ;AAE3D,UAAI,CAAC,YAAY;AACf,cAAM,IAAI,MAAM,sBAAsB;AAAA,MACxC;AAEA,cAAQ,IAAI,eAAe,UAAU;AACrC,YAAM,aAAa,cAChB,WAAW,YAAY,EACvB,SAAS,MAAM;AAElB,gBAAU;AAAA,QACR;AAAA,MACF;AAAA,IACF,SAAS,KAAK;AACZ,cAAQ,MAAM,iCAAiC,GAAG,EAAE;AAAA,IACtD;AAAA,EACF;AAEA,QAAM,SAAS,CAAC,cAAsB;AACpC,QAAI,OAAO;AACT,YAAM,OAAO,SAAS;AAAA,IACxB;AAAA,EACF;AAEA,QAAM,UAAU,MAAM;AACpB,QAAI;AACF,cAAQ,WAAW,MAAM;AAAA,IAC3B,SAAS,KAAK;AACZ,cAAQ,MAAM,8BAA8B,GAAG,EAAE;AAAA,IACnD;AAAA,EACF;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;","names":[]}