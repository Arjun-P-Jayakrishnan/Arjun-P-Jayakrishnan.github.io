{"version":3,"sources":["../src/engine/managers/animation/AnimationManager.ts"],"names":["createAnimationManager","map","_mountPlayer","storage","inputs","playerAnimations","PLAYER_ASSET","player","mixer","AnimationMixer","playerAnimationUnit","createAnimationUnit","playerFSM","createPlayerFSMController","id","deltaTime"],"mappings":"6JAiBO,IAAMA,EAAyB,IAAwB,CAC5D,IAAMC,CAAAA,CAAoB,CACxB,MAAA,CAAQ,IACV,CAAA,CAEMC,CAAAA,CAAe,CACnBC,GAAAA,CACAC,CAAAA,GACG,CAGH,IAAMC,EACJF,GAAAA,CAAQ,UAAA,CAAW,OAAO,CAAA,CAAE,SAASG,CAAAA,CAAa,EAAE,CAAA,EAAG,UAAA,EAAc,EAAC,CAClEC,CAAAA,CAASJ,GAAAA,CACZ,UAAA,CAAW,OAAO,CAAA,CAClB,QAAA,CAASG,CAAAA,CAAa,EAAE,CAAA,EAAG,MAAA,CAG9B,GAAIC,CAAAA,EAAUF,EAAiB,MAAA,CAAS,CAAA,CAAG,CACzC,IAAMG,EAAQ,IAAIC,cAAAA,CAAeF,CAAM,CAAA,CAEjCG,EAAsBC,GAAAA,CAAmC,CAC7D,OAAA,CAAS,CACP,KAAMH,CAAAA,CAAM,UAAA,CAAWH,CAAAA,CAAiB,CAAC,CAAC,CAAA,CAC1C,IAAA,CAAMG,CAAAA,CAAM,UAAA,CAAWH,EAAiB,CAAC,CAAC,CAAA,CAC1C,GAAA,CAAKG,EAAM,UAAA,CAAWH,CAAAA,CAAiB,CAAC,CAAC,CAC3C,CAAA,CACA,iBAAA,CAAmB,GACrB,CAAC,CAAA,CACKO,CAAAA,CAAYC,GAAAA,CAA0B,CAC1C,OAAAT,CAAAA,CACA,aAAA,CAAeM,CACjB,CAAC,EAEDA,CAAAA,CAAoB,OAAA,CAAQF,CAAK,CAAA,CACjCI,EAAU,KAAA,EAAM,CAEhBX,CAAAA,CAAI,MAAA,CAAS,CACX,aAAA,CAAeS,CAAAA,CACf,GAAA,CAAKE,CACP,EACF,CACF,CAAA,CAuBA,OAAO,CACL,MAtBY,CACZE,CAAAA,CACAX,CAAAA,CACAC,CAAAA,GACG,CACH,GAAQU,CAAAA,GACD,QAAA,CACHZ,EAAaC,CAAAA,CAASC,CAAM,CAAA,CAAA,KAG5B,MAAM,IAAI,KAAA,CAAM,CAAA,0CAAA,EAA6CU,CAAE,CAAA,CAAE,CAEvE,CAAA,CAWE,MAAA,CATcC,CAAAA,EAAsB,CAChCd,EAAI,MAAA,GACNA,CAAAA,CAAI,MAAA,CAAO,aAAA,CAAc,OAAOc,CAAS,CAAA,CACzCd,CAAAA,CAAI,MAAA,CAAO,IAAI,MAAA,CAAOc,CAAAA,CAAY,EAAG,CAAA,EAEzC,CAKA,CACF","file":"chunk-KKD4NLVV.js","sourcesContent":["import { PLAYER_ASSET } from \"config/asset_manifest\";\nimport { createPlayerFSMController } from \"plugins/fsm/player/controller\";\nimport { AnimationMixer } from \"three\";\nimport { AnimationMap, PlayerStateId } from \"types/fsm.types\";\nimport { InputManager } from \"../InputManager\";\nimport { GlobalStorageManager } from \"../storage/storageTypes\";\nimport { createAnimationUnit } from \"./AnimationUnit\";\n\nexport interface AnimationManager {\n  mount: (\n    playerId: keyof AnimationMap,\n    storage: GlobalStorageManager,\n    inputs: InputManager\n  ) => void;\n  update: (deltaTime: number) => void;\n}\n\nexport const createAnimationManager = (): AnimationManager => {\n  const map: AnimationMap = {\n    Player: null,\n  };\n\n  const _mountPlayer = (\n    storage: GlobalStorageManager,\n    inputs: InputManager\n  ) => {\n    /**Retrive Data from strorage */\n\n    const playerAnimations =\n      storage.getStorage(\"model\").retrieve(PLAYER_ASSET.id)?.animations ?? [];\n    const player = storage\n      .getStorage(\"model\")\n      .retrieve(PLAYER_ASSET.id)?.groups;\n\n    /**If both object and animations are there complete */\n    if (player && playerAnimations.length > 0) {\n      const mixer = new AnimationMixer(player);\n\n      const playerAnimationUnit = createAnimationUnit<PlayerStateId>({\n        actions: {\n          Idle: mixer.clipAction(playerAnimations[0]),\n          Walk: mixer.clipAction(playerAnimations[3]),\n          Run: mixer.clipAction(playerAnimations[1]),\n        },\n        crossfadeDuration: 0.03,\n      });\n      const playerFSM = createPlayerFSMController({\n        inputs,\n        animationUnit: playerAnimationUnit,\n      });\n\n      playerAnimationUnit.onMount(mixer);\n      playerFSM.mount();\n\n      map.Player = {\n        animationUnit: playerAnimationUnit,\n        fsm: playerFSM,\n      };\n    }\n  };\n\n  const mount = (\n    id: keyof AnimationMap,\n    storage: GlobalStorageManager,\n    inputs: InputManager\n  ) => {\n    switch (id) {\n      case \"Player\":\n        _mountPlayer(storage, inputs);\n        break;\n      default:\n        throw new Error(`Error : Cant create an animation unit for ${id}`);\n    }\n  };\n\n  const update = (deltaTime: number) => {\n    if (map.Player) {\n      map.Player.animationUnit.update(deltaTime);\n      map.Player.fsm.update(deltaTime * 0.1);\n    }\n  };\n\n  return {\n    mount,\n    update,\n  };\n};\n"]}