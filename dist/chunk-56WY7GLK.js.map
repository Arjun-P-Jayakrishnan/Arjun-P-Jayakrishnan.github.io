{"version":3,"sources":["../src/plugins/loader/glb_loader.ts"],"names":["createGLBLoader","scene","loadingManager","storageManager","gltfLoader","GLTFLoader","dracoLoader","DRACOLoader","_loadMesh","metaData","model","err","assets","promises","asset"],"mappings":"sIAaO,IAAMA,CAAAA,CAAkB,CAAC,CAC9B,KAAA,CAAAC,EACA,cAAA,CAAAC,CAAAA,CACA,cAAA,CAAAC,CACF,CAAA,GAAoC,CAClC,IAAMC,CAAAA,CAAyB,IAAIC,UAAAA,CAAWH,CAAc,CAAA,CACtDI,CAAAA,CAAc,IAAIC,YACxBD,CAAAA,CAAY,cAAA,CAAe,gBAAgB,CAAA,CAC3CF,CAAAA,CAAW,cAAA,CAAeE,CAAW,CAAA,CAMrC,IAAME,CAAAA,CAAY,MAAOC,CAAAA,EAAmC,CAC1D,GAAI,CACF,IAAMC,CAAAA,CAAQ,MAAMN,CAAAA,CAAW,SAAA,CAAUK,CAAAA,CAAS,IAAI,CAAA,CACtDN,CAAAA,CAAe,UAAA,CAAW,OAAO,CAAA,CAAE,KAAA,CAAMM,EAAS,EAAA,CAAI,CACpD,UAAA,CAAYC,CAAAA,CAAM,UAAA,CAClB,MAAA,CAAQA,EAAM,KAChB,CAAC,CAAA,CACDT,CAAAA,CAAM,GAAA,CAAIS,CAAAA,CAAM,KAAK,EACvB,CAAA,MAASC,CAAAA,CAAK,CACZ,MAAM,IAAI,KAAA,CAAM,CAAA,wCAAA,EAA2CA,CAAG,CAAA,CAAE,CAClE,CACF,CAAA,CAWA,OAAO,CACL,IAAA,CAVW,MAAOC,CAAAA,EAAmC,CACrD,IAAMC,CAAAA,CAA4B,EAAC,CACnCD,CAAAA,CAAO,OAAA,CAASE,CAAAA,EAAU,CACxBD,CAAAA,CAAS,KAAKL,CAAAA,CAAUM,CAAK,CAAC,EAChC,CAAC,CAAA,CAED,MAAM,OAAA,CAAQ,UAAA,CAAWD,CAAQ,EACnC,CAIA,CACF","file":"chunk-56WY7GLK.js","sourcesContent":["import { GlobalStorageManager } from \"engine/managers/storage/storageTypes\";\nimport { LoadingManager, Scene } from \"three\";\nimport { DRACOLoader } from \"three/examples/jsm/loaders/DRACOLoader.js\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader.js\";\nimport { ModelAssetDescriptor } from \"types/loader.types\";\nimport { LoaderPlugin } from \"types/plugin.types\";\n\nexport interface GLBLoaderProps {\n  scene: Scene;\n  loadingManager: LoadingManager;\n  storageManager: GlobalStorageManager;\n}\n\nexport const createGLBLoader = ({\n  scene,\n  loadingManager,\n  storageManager,\n}: GLBLoaderProps): LoaderPlugin => {\n  const gltfLoader: GLTFLoader = new GLTFLoader(loadingManager);\n  const dracoLoader = new DRACOLoader();\n  dracoLoader.setDecoderPath(\"/public/draco/\");\n  gltfLoader.setDRACOLoader(dracoLoader);\n\n  /**\n   * @description load the mesh\n   * @param metaData meta-data for loading the mesh\n   */\n  const _loadMesh = async (metaData: ModelAssetDescriptor) => {\n    try {\n      const model = await gltfLoader.loadAsync(metaData.path);\n      storageManager.getStorage(\"model\").store(metaData.id, {\n        animations: model.animations,\n        groups: model.scene,\n      });\n      scene.add(model.scene);\n    } catch (err) {\n      throw new Error(`Errr occuerd while loading a glb file : ${err}`);\n    }\n  };\n\n  const load = async (assets: ModelAssetDescriptor[]) => {\n    const promises: Promise<void>[] = [];\n    assets.forEach((asset) => {\n      promises.push(_loadMesh(asset));\n    });\n\n    await Promise.allSettled(promises);\n  };\n\n  return {\n    load: load,\n  };\n};\n"]}