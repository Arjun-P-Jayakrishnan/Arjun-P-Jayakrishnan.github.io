{"version":3,"sources":["../src/engine/managers/DOMManger.ts"],"names":["_loadJSON","url","loadAboutData","about","data","err","loadProjectData","projectGallery","projects","createDomManager","flags","serviceRegsitry","getServiceRegistry","lifecycleScheduler","logger","eventBusManager","Navbar","LoadingModal","SceneInspector","ProjectGallery","ProjectCard","queueStep","AboutPage","loadingModal","navbar","sceneInspector","selector","element"],"mappings":"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","file":"chunk-UZYTJZBK.js","sourcesContent":["import { AboutPage } from \"@components/about/about\";\nimport { CardMarshall, ProjectCard } from \"@components/gallery/card\";\nimport { ProjectGallery } from \"@components/gallery/gallery\";\nimport { LoadingModal } from \"@components/loading/loading\";\nimport { Navbar } from \"@components/navbar/navbar\";\nimport { SceneInspector } from \"@components/threejs/scene_inspector\";\nimport { queueStep } from \"@utils/dsl\";\nimport { getServiceRegistry } from \"engine/core/ServiceRegistry\";\nimport { Lifecycle } from \"types/lifecycle.types\";\n\ninterface DOMManager extends Lifecycle {\n  onInit: () => void;\n}\n\nconst _loadJSON = async (url: string): Promise<any> => {\n  const res = await fetch(url);\n  const data = await res.json();\n\n  return data;\n};\n\nconst loadAboutData = async () => {\n  const about: AboutPage = document.querySelector(\"about-page\")!;\n  try {\n    const data = await _loadJSON(\"/public/data/about.json\");\n\n    about.updateData = {\n      isError: false,\n      records: data,\n    };\n  } catch (err) {\n    about.updateData = {\n      isError: true,\n      message: `Error getting data ${err}`,\n    };\n    console.error(`Error getting data ${err}`);\n  }\n};\n\nconst loadProjectData = async () => {\n  const projectGallery: ProjectGallery =\n    document.querySelector(\"project-gallery\")!;\n  try {\n    const data = await fetch(\"/public/data/projects.json\");\n    const projects = await data.json();\n\n    projectGallery.updateData = {\n      isError: false,\n      list: projects[\"projects\"] as Array<CardMarshall>,\n    };\n  } catch (err) {\n    projectGallery.updateData = {\n      isError: true,\n      message: `Error getting data ${err}`,\n    };\n    console.error(`Error getting data ${err}`);\n  }\n};\n\nconst createDomManager = (): DOMManager => {\n  let flags = {\n    navbarDefined: false,\n    loadingModalDefined: false,\n    sceneInspectorDefined: false,\n    projectGalleryDefined: false,\n    projectCardDefined: false,\n    aboutPageDefined: false,\n  };\n\n  const serviceRegsitry = getServiceRegistry();\n  const [lifecycleScheduler, logger, eventBusManager] = [\n    serviceRegsitry.get(\"LifecycleScheduler\"),\n    serviceRegsitry.get(\"Logger\"),\n    serviceRegsitry.get(\"EventBusManager\"),\n  ];\n\n  /**\n   * @description definition part\n   */\n  const onInit = () => {\n    // Navbar\n    if (!flags.navbarDefined) {\n      customElements.define(\"nav-bar\", Navbar);\n      flags.navbarDefined = true;\n    }\n    // Loading Modal\n    if (!flags.loadingModalDefined) {\n      customElements.define(\"loading-modal\", LoadingModal);\n      flags.loadingModalDefined = true;\n    }\n    // Scene Inspector\n    if (!flags.sceneInspectorDefined) {\n      customElements.define(\"scene-inspector\", SceneInspector);\n      flags.sceneInspectorDefined = true;\n    }\n\n    // Projects\n    eventBusManager.displayBus.once(\"projects:show\", () => {\n      if (flags.projectGalleryDefined) return;\n      logger.onMount({ origin: \"Projects-Page\" });\n      //Loading\n      eventBusManager.loadingBus.emit({\n        type: \"load:start\",\n        loaded: 0,\n        total: 0,\n        url: \"\",\n      });\n      customElements.define(\"project-gallery\", ProjectGallery);\n      customElements.define(\"project-card\", ProjectCard);\n\n      lifecycleScheduler.schedule(\n        queueStep(() => {\n          try {\n            const projectGallery: ProjectGallery =\n              document.querySelector(\"project-gallery\")!;\n\n            projectGallery.eventBusManager = eventBusManager;\n          } catch (err) {\n            console.error(err);\n          }\n        })\n      );\n\n      lifecycleScheduler.schedule(\n        queueStep(async () => {\n          try {\n            console.log(\"loading data\");\n            await loadProjectData();\n            eventBusManager.loadingBus.emit({ type: \"load:complete\" });\n          } catch (err) {\n            console.log(`Error while loading projects data ${err}`);\n          }\n        })\n      );\n\n      flags.projectGalleryDefined = true;\n    });\n\n    // About Page\n    eventBusManager.displayBus.once(\"about:show\", () => {\n      if (flags.aboutPageDefined) return;\n      logger.onMount({ origin: \"About-Page\" });\n      //Loading\n      eventBusManager.loadingBus.emit({\n        type: \"load:start\",\n        loaded: 0,\n        total: 0,\n        url: \"\",\n      });\n\n      customElements.define(\"about-page\", AboutPage);\n      lifecycleScheduler.schedule(\n        queueStep(async () => {\n          await loadAboutData();\n          eventBusManager.loadingBus.emit({ type: \"load:complete\" });\n        })\n      );\n\n      lifecycleScheduler.schedule(\n        queueStep(() => {\n          try {\n            const about: AboutPage = document.querySelector(\"about-page\")!;\n            about.eventBusManager = eventBusManager;\n          } catch (err) {\n            console.error(err);\n          }\n        })\n      );\n\n      flags.aboutPageDefined = true;\n    });\n  };\n\n  /**\n   * @description data-fetch part\n   */\n  const onLoad = () => {\n    logger.onLoad({ origin: \"DOMManager\" });\n    try {\n      const loadingModal: LoadingModal =\n        document.querySelector(\"loading-modal\")!;\n      loadingModal.eventBusManager = eventBusManager;\n    } catch (err) {\n      console.error(`Missing loading modal element :${err}`);\n    }\n\n    try {\n      const navbar: Navbar = document.querySelector(\"nav-bar\")!;\n      navbar.eventBusManager = eventBusManager;\n    } catch (err) {\n      console.error(`Missing navbar element : ${err}`);\n    }\n\n    try {\n      const sceneInspector: SceneInspector =\n        document.querySelector(\"scene-inspector\")!;\n      sceneInspector.eventBusManager = eventBusManager;\n    } catch (err) {\n      console.error(err);\n    }\n\n    // try {\n    //   const gallery: ProjectGallery =\n    //     document.querySelector(\"project-gallery\")!;\n    //   gallery.eventBusManager = context.eventBusManager;\n    // } catch (err) {\n    //   console.error(`Missing project gallery component : ${err}`);\n    // }\n  };\n\n  /**\n   * @description attach components with data /events\n   */\n  const onMount = () => {\n    logger.onMount({ origin: \"DOMManager\" });\n  };\n\n  const onUpdate = () => {\n    logger.onUpdate(0, { origin: \"DOMManager\" });\n  };\n\n  const onUnmount = () => {\n    const selectors = [\n      \"loading-modal\",\n      \"nav-bar\",\n      \"scene-inspector\",\n      // \"project-gallery\",\n      // \"project-card\",\n\n      // \"about-page\",\n      // \"background-page\",\n    ];\n\n    selectors.forEach((selector) => {\n      const element = document.querySelector(selector);\n      if (element?.parentElement) {\n        //call disconnected  callback for the removal of event listeners\n        element.parentElement.removeChild(element);\n      } else {\n        console.warn(\n          `Could not unmount ${selector} either already removed or not found`\n        );\n      }\n    });\n    logger.onUnmount({ origin: \"DOMManger\" });\n  };\n\n  /**\n   * @deprecated\n   */\n  const onDispose = () => {\n    logger.onDestroy({ origin: \"DOMManager\" });\n  };\n\n  return {\n    onInit: onInit,\n    onLoad: onLoad,\n    onMount: onMount,\n    onUpdate: onUpdate,\n    onUnmount: onUnmount,\n    onDestroy: onDispose,\n  };\n};\n\nexport { createDomManager };\n\nexport type { DOMManager };\n"]}