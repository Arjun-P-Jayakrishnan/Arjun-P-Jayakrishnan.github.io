{"version":3,"sources":["../src/plugins/fsm/player/controller.ts"],"names":["createPlayerFSMController","inputs","animationUnit","keyboard","states","Idle","Walk","Run","state","currentState","update","deltaTime","playerFSM","isMoving","isShiftPressed","_getState","stateId","changeState","newState","mount"],"mappings":"+CA2BA,IAAMA,CAAAA,CAA4B,CAAC,CACjC,MAAA,CAAAC,IACA,aAAA,CAAAC,CACF,CAAA,GAAiC,KACzB,CAAS,QAAA,CAAAC,CAAS,CAAA,CAAI,CAC1B,KAAA,CAAOF,GAAAA,CAAO,cAAc,OAAO,CAAA,CACnC,QAAA,CAAUA,GAAAA,CAAO,cAAc,UAAU,CAC3C,CAAA,CAGMG,EAAgD,CACpD,IAAA,CAAMC,CAAAA,CAAK,CACT,cAAeH,CAAAA,CACf,OAAA,CAAS,MACX,CAAC,EACD,IAAA,CAAMI,GAAAA,CAAK,CACT,aAAA,CAAeJ,EACf,OAAA,CAAS,MACX,CAAC,CAAA,CACD,IAAKK,CAAAA,CAAI,CACP,aAAA,CAAeL,CAAAA,CACf,QAAS,KACX,CAAC,CACH,CAAA,CAEIM,EAAwBJ,CAAAA,CAAO,IAAA,CAC/BK,CAAAA,CAA8B,MAAA,CAE5BC,EAAUC,CAAAA,EAAsB,CACpCH,CAAAA,CAAM,OAAA,CAAQI,CAAS,CAAA,CACvBV,CAAAA,CAAc,MAAA,CAAOS,CAAS,EAChC,CAAA,CAEME,CAAAA,CAAW,IAEb,CAAA,EAAAV,CAAAA,EAAU,YAAA,CAAa,GAAG,CAAA,EAC1BA,GAAU,YAAA,CAAa,GAAG,CAAA,EAC1BA,CAAAA,EAAU,aAAa,GAAG,CAAA,EAC1BA,CAAAA,EAAU,YAAA,CAAa,GAAG,CAAA,CAAA,CAQxBW,CAAAA,CAAiB,IACdX,CAAAA,EAAU,aAAa,OAAO,CAAA,EAAK,KAAA,CAGtCY,CAAAA,CAAaC,GACVZ,CAAAA,CAAOY,CAAO,CAAA,CAGjBC,GAAAA,CAAeC,GAA4B,CAC3CT,CAAAA,GAAiBS,CAAAA,GACnBT,CAAAA,CAAeS,EACfV,CAAAA,CAAM,IAAA,CAAKI,CAAS,CAAA,CACpBJ,EAAQO,CAAAA,CAAUG,CAAQ,CAAA,CAC1BV,CAAAA,CAAM,MAAMI,CAAS,CAAA,EAEzB,CAAA,CAEMO,CAAAA,CAAQ,IAAM,CAClBX,CAAAA,CAAM,KAAA,CAAMI,CAAS,EACvB,CAAA,CAEMA,CAAAA,CAAuB,CAC3B,WAAA,CAAaK,IACb,QAAA,CAAUJ,CAAAA,CACV,cAAA,CAAgBC,CAClB,EAIA,OAAO,CACL,KAAA,CAAOK,CAAAA,CACP,OAAQT,CAAAA,CACR,OAAA,CALc,IAAM,CAAC,CAMvB,CACF","file":"chunk-VYXMJFI3.js","sourcesContent":["import { AnimationUnit } from \"engine/managers/animation/AnimationUnit\";\nimport { InputManager } from \"engine/managers/InputManager\";\nimport { PlayerStateId } from \"types/fsm.types\";\nimport { GenericFSM } from \"types/plugin.types\";\nimport { Idle, PlayerFSMState, Run, Walk } from \"./states\";\n\n/** Maineted internally by fsm controller */\ninterface PlayerFSM extends GenericFSM<PlayerStateId> {\n  /** helper to check if moving or stationary*/\n  isMoving: () => boolean;\n\n  /** helper to check if need to run or be in current state if not running */\n  isShiftPressed: () => boolean;\n}\n\ninterface FSMOptions {\n  inputs: InputManager;\n  animationUnit: AnimationUnit<PlayerStateId>;\n}\n\n/**Controls the animations */\ninterface FSMController {\n  mount: () => void;\n  update: (deltaTime: number) => void;\n  unmount: () => void;\n}\n\nconst createPlayerFSMController = ({\n  inputs,\n  animationUnit,\n}: FSMOptions): FSMController => {\n  const { mouse, keyboard } = {\n    mouse: inputs.getController(\"mouse\"),\n    keyboard: inputs.getController(\"keyboard\"),\n  };\n\n  let shiftPressed: boolean;\n  const states: Record<PlayerStateId, PlayerFSMState> = {\n    Idle: Idle({\n      animationUnit: animationUnit,\n      stateId: \"Idle\",\n    }),\n    Walk: Walk({\n      animationUnit: animationUnit,\n      stateId: \"Walk\",\n    }),\n    Run: Run({\n      animationUnit: animationUnit,\n      stateId: \"Run\",\n    }),\n  };\n\n  let state: PlayerFSMState = states.Idle;\n  let currentState: PlayerStateId = \"Idle\";\n\n  const update = (deltaTime: number) => {\n    state.execute(playerFSM);\n    animationUnit.update(deltaTime);\n  };\n\n  const isMoving = () => {\n    if (\n      keyboard?.isKeyPressed(\"w\") ||\n      keyboard?.isKeyPressed(\"a\") ||\n      keyboard?.isKeyPressed(\"s\") ||\n      keyboard?.isKeyPressed(\"d\")\n    ) {\n      return true;\n    }\n\n    return false;\n  };\n\n  const isShiftPressed = () => {\n    return keyboard?.isKeyPressed(\"shift\") ?? false;\n  };\n\n  const _getState = (stateId: PlayerStateId) => {\n    return states[stateId];\n  };\n\n  const changeState = (newState: PlayerStateId) => {\n    if (currentState !== newState) {\n      currentState = newState;\n      state.exit(playerFSM);\n      state = _getState(newState);\n      state.enter(playerFSM);\n    }\n  };\n\n  const mount = () => {\n    state.enter(playerFSM);\n  };\n\n  const playerFSM: PlayerFSM = {\n    changeState: changeState,\n    isMoving: isMoving,\n    isShiftPressed: isShiftPressed,\n  };\n\n  const unmount = () => {};\n\n  return {\n    mount: mount,\n    update: update,\n    unmount: unmount,\n  };\n};\n\nexport { createPlayerFSMController };\nexport type { FSMController, FSMOptions, PlayerFSM };\n"]}